
应用层
- 网络应用是计算机网络存在的理由，如果我们不能构想出任何有用的应用，也就没有任何必要去设计支持它们的网络协议了。自因特网全面发展以来，的确已开发出众多有用的、有趣的网络应用。这些应用程序已经成为因特网成功的驱动力，激励人们在家庭、学校、政府和商业中利用网络，使因特网成为他们日常活动的密不可分的一部分。
- 因特网应用包括:20 世纪 70年代和80年代开始流行的经典的基于文本的应用，如文本电子邮件、远程访问计算机、文件传输和新闻组;20世纪90年代中期引人的招人喜爱的应用--万维网，包括Web冲浪、搜索和电子商务;20世纪末引人的两个招人喜爱的应用--即时讯息和对等(P2P)文件共享。自 2000 年以来，新型和极其引人人胜的应用持续出现，包括:IP电话(VoIP)、视频会议(如 Skype、Facetime 和Google Hangouts);用户生成的视频(如YouTube)和点播电影(如Netflix);多方在线游戏(如《第二人生》(Second Life) 和《魔兽世界》(World of Wareraft))。在这段时期，我们看到了新一代社交网络应用，如Facebook、Instagram、Twitter 和微信，它们在因特网的网络或路由器和通信链路之上创建了引人人胜的人类网络。近年来，随着智能手机的发展，出现了大量基于位置的移动应用程序，包括流行的签到、约会和道路流量预测应用(如 Yelp、TinderWaz 和Yik Yak)。显然，新型和令人兴奋的因特网应用的步伐并没有减缓。也许本书的一些读者将会创建下一代招人喜爱的因特网应用。
- 在本章中，我们学习有关网络应用的原理和实现方面的知识。我们从定义关键的应用层概念开始，其中包括应用程序所需要的网络服务、客户和服务器、进程和运输层接口。我们详细考察几种网络应用程序，包括Web、电子邮件、DNS、对等文件分发和视频流(第9章关注多媒体应用，包括流式视频和VoIP)。然后我们将涉及开发运行在TCP和UDP上的网络应用程序。特别是，我们学习套接字接口，并浮光掠影地学习用Python语言写的一些简单的客户-服务器应用程序。在本章结尾，我们也将提供几个有趣、有意思的套接字编程作业。
- 应用层是我们学习协议非常好的起点，它最为我们所熟悉。我们熟悉的很多应用就是建立在这些将要学习的协议基础上的。通过对应用层的学习，将有助于我们很好地感受到协议的方方面面，将使我们了解到很多问题，这些问题在我们学习运输层、网络层及数据链路层协议时也同样会碰到。
### 2.1 应用层协议原理
假定你对新型网络应用有了一些想法。也许这种应用将为人类提供一种伟大的服务，或者将使你的教授高兴，或者将带给你大量的财富，或者只是在开发中获得乐趣。无论你的动机是什么，我们现在考察一下如何将你的想法转变为一种真实世界的网络应用。
研发网络应用程序的核心是写出能够运行在不同的端系统和通过网络彼此通信的程序。例如，在 Web 应用程序中，有两个互相通信的不同的程序:一个是运行在用户主机(桌面机、膝上机、平板电脑、智能电话等)上的浏览器程序;另一个是运行在Web服务器主机上的 Web 服务器程序。另一个例子是 P2P 文件共享系统，在参与文件共享的社区中的每台主机中都有一个程序。在这种情况下，在各台主机中的这些程序可能都是类似的或相同的。

因此，当研发新应用程序时，你需要编写将在多台端系统上运行的软件。该软件能够用如 C、Java 或Python 来编写。重要的是，你不需要写在网络核心设备如路由器或链路层交换机上运行的软件。即使你要为网络核心设备写应用程序软件，你也不能做到这一点。如我们在第1 章所知，以及如图1-24 所显示的那样，网络核心设备并不在应用层上起作用，而仅在较低层起作用，特别是在网络层及下面层次起作用。这种基本设计，即将应用软件限制在端系统(如图2-1所示)的方法，促进了大量的网络应用程序的迅速研发和部署。


# 2.1.1 网络应用程序体系结构

从应用程序研发者的角度看，网络体系结构是固定的，并为应用程序提供了特定的服务集合。在另一方面，应用程序体系结构(application architecture)由应用程序研发者设计，规定了如何在各种端系统上组织该应用程序。在选择应用程序体系结构时，应用程序研发者很可能利用现代网络应用程序中所使用的两种主流体系结构之一:客户-服务器体系结构或对等(P2P)体系结构。


在**客户-服务器**体系结构(client-serverarchitecture)中，有一个总是打开的主机称为服务器，它服务于来自许多其他称为客户的主机的请求。一个典型的例子是 Web 应用程序，其中总是打开的Web 服务器服务于来自浏览器(运行在客户主机上)的请求。当Web 服务器接收到来自某客户对某对象的请求时，它向该客户发送所请求的对象作为响应。值得注意的是利用客户-服务器体系结构，客户相互之间不直接通信;例如，在 Web应用中两个浏览器并不直接通信。客户-服务器体系结构的另一个特征是该服务器具有固定的、周知的地址，该地址称为 IP地址(我们将很快讨论它)。因为该服务器具有固定的、周知的地址，并且因为该服务器总是打开的，客户总是能够通过向该服务器的IP 地址发送分组来与其联系。具有客户-服务器体系结构的非常著名的应用程序包括 Web、FTPTelnet和电子邮件。图2-2a中显示了这种客户-服务器体系结构。
![](Pasted%20image%2020250617184651.png)

图2-2客户-服务器体系结构及P2P 体系结构


在一个客户-服务器应用中，常常会出现一台单独的服务器主机跟不上它所有客户请求的情况。例如，一个流行的社交网络站点如果仅有一台服务器来处理所有请求，将很快变得不堪重负。为此，配备大量主机的数据中心(data center)常被用于创建强大的虚拟服务器。如在1.3.3 节中所讨论的那样，谷歌有分布于全世界的30~50个数据中心，这些数据中心共同处理搜索、YouTube、Gmail 和其他服务。一个数据中心能够有数十万台服务器，它们必须要供电和维护。此外，服务提供商必须支付不断出现的互联和带宽费用，以发送和接收到达/来自数据中心的数据。

在一个**P2P体系结构**(P2P architecture)中，对位于数据中心的专用服务器有最小的(或者没有)依赖。相反，**应用程序在间断连接的主机对之间使用直接通信，这些主机对被称为对等方**。这些对等方并不为服务提供商所有，相反却为用户控制的桌面机和膝上机所有，大多数对等方驻留在家庭、大学和办公室。因为这种对等方通信不必通过专门的服务器，该体系结构被称为对等方到对等方的。许多**目前流行的、流量密集型应用都是P2P**体系结构的。这些应用包括**文件共享(例如BitTorrent)、对等方协助下载加速器(例如迅雷)、因特网电话和视频会议(例如Skype)**。图2-2b中显示了P2P 的体系结构。需要提及的是，某些应用具有混合的体系结构，它结合了客户-服务器和 P2P 的元素。例如，对于**许多即时讯息应用而言，服务器被用于跟踪用户的IP 地址，但用户到用户的报文在用户主机之间(无须通过中间服务器)直接发送**。


P2P 体系结构的最引人人胜的特性之一是它们的自扩展性(self-scalability)。例如，在一个 P2P 文件共享应用中，尽管每个对等方都由于请求文件产生工作负载，但每个对等方通过向其他对等方分发文件也为系统增加服务能力。P2P 体系结构也是有成本效率的，因为它们通常不需要庞大的服务器基础设施和服务器带宽(这与具有数据中心的客户-服务器设计形成鲜明对比)。然而，未来 P2P 应用由于高度非集中式结构，面临安全性、性能和可靠性等挑战。