TCP被称为是面向连接的(connection-oriented)，这是因为在一个应用进程可以开始向另一个应用进程发送数据之前，这两个进程必须先相互“握手”​，即它们**必须相互发送某些预备报文段，以建立确保数据传输的参数。**
- 作为TCP连接建立的一部分，连接的双方都将初始化与TCP连接相关的许多**TCP状态变量**(其中的许多状态变量将在本节和3.7节中讨论)。

这种TCP“连接”不是一条像在电路交换网络中的端到端 TDM 或FDM 电路。相反，该“连接”是一条逻辑连接，其共同状态仅保留在两个通信端系统的TCP 程序中。前面讲过，由于TCP 协议只在端系统中运行，而不在中间的网络元素(路由器和链路层交换机)中运行，所以**中间的网络元素不会维持TCP连接状态**。事实上，中间路由器对 TCP连接完全视而不见，它们看到的是数据报，而不是连接台主机上的进程B存在一条TCP连接，那么应用层数据就可在从进程B流向进程A的同时，也从进程A流向进程B。TCP连接也总是点对点(point-to-point) 的，即在单个发送方与单个接收方之间的连接。所谓“多播”(参见本书的在线补充材料)，即在一次发送操作中，从一个发送方将数据传送给多个接收方，这种情况对TCP 来说是不可能的。对于TCP而言，两台主机是一对，而3台主机则太多了!

我们现在来看看TCP连接是怎样建立的。假设运行在某台主机上的一个进程想与另一台主机上的一个进程建立一条连接。前面讲过，发起连接的这个进程被称为客户进程，而另一个进程被称为服务器进程。该客户应用进程首先要通知客户运输层，它想与服务器上的一个进程建立一条连接。2.7.2 节讲过，一个Python 客户程序通过发出下面的命令来实现此目的。
```
elientSocket.connect((serverName,serverPort))
```
- 其中 serverName ddddddddddddddddddddd
- serverPort 标识了服务器上的进程。
### 连接的简化过程
客户首先发送一个特殊的 TCP 报文段，服务器用另一个特殊的TCP 报文段来响应，最后，客户再用第三个特殊报文段作为响应。
- **前两个报文段不承载“有效载荷”**，也就是不包含应用层数据;而第三个报文段可以承载有效载荷。由于在这两台主机之间发送了3个报文段，所以这种连接建立过程常被称为三次握手(three-way handshake)。
- 一旦建立起一条TCP连接，两个应用进程之间就可以相互发送数据了。我们考虑一下从客户进程向服务器进程发送数据的情况。如 2.7 节中所述，客户进程通过套接字(该进程之门)传递数据流。数据一旦通过该门，它就由客户中运行的 TCP 控制了。
- **数据一旦通过该门，它就由客户中运行的 TCP 控制了**。如图 3-28所示，**TCP将这些数据引导到该连接的发送缓存(send buffer)里，发送缓存是发起三次握手期间设置的缓存之一**。接下来 TCP 就会不时从发送缓存里取出一块数据，并将数据传递到网络层。有趣的是，在TCP规范`[RFC 793]` 中却没提及TCP 应何时实际发送缓存里的数据，只是描述为“TCP 应该在它方便的时候以报文段的形式发送数据”​。
最大报文段长度
- TCP 可从缓存中取出并放入报文段中的数据数量受限于最大报文段长度(Maximum Segment Size,MSS)。MSS通常根据最初确定的由本地发送主机发送的最大链路层帧长度(即所谓的最大传输单元(MaximumTransmissionUnitMTU))来设置。
- 设置该MSS要保证一个TCP报文段(当封装在一个IP数据报中)加上TCP/IP首部长度(通常40字节)将适合单个链路层帧。以太网和 PPP 链路层协议都具有1500字节的MTU，因此 MSS 的典型值为1460字节。
- 已经提出了多种发现路径MTU的方法，并基于路径MTU值设置MSS(路径MTU是指能在从源到目的地的所有链路上发送的最大链路层帧`[RFC 1191]`)。注意到**MSS 是指在报文段里应用层数据的最大长度，而不是指包括首部的 TCP 报文段的最大长度。**(该术语很容易混淆，但是我们不得不采用它，因为它已经根深蒂固了。

TCP为每块客户数据配上一个TCP首部，从而形成多个TCP报文段(TCPsegment)。
- 这些报文段被下传给网络层，网络层将其分别封装在网络层 IP 数据报中。然后这些IP 数据报被发送到网络中。当TCP 在另一端接收到一个报文段后，该报文段的数据就被放入该TCP 连接的接收缓存中，如图 3-28 中所示。应用程序从此缓存中读取数据流。该连接的每一端都有各自的发送缓存和接收缓存。
![](Pasted%20image%2020250602181242.png)

从以上讨论中我们可以看出，TCP连接的组成包括:一台主机上的缓存、变量和与进程连接的套接字，以及另一台主机上的另一组缓存、变量和与进程连接的套接字。如前面讲过的那样，在这两台主机之间的网络元素(路由器、交换机和中继器)中，没有为该连接分配任何缓存和变量。
