分层可以类比航线功能
![](Pasted%20image%2020250617154743.png)
①在这层中执行了某些动作(例如，在登机口层，某飞机的乘客登机和离机);
②使用直接下层的服务(例如，在登机口层，使用起飞/着陆层的跑道到跑道的旅客转移服务)。

这种简化本身由于提供模块化而具有很高价值，这使某层所提供的服务实现易于改变。只要该层对其上面的层提供相同的服务，并且使用来自下面层次的相同服务，当某层的实现变化时，该系统的其余部分保持不变。
- 登机口功能实现被改变了，航线的其余部分将保持不变，因为登机口仍然提供相同的功能，它仅是以不同的方式实现了该功能。对于大而复杂且需要不断更新的系统，改变服务的实现而不影响该系统其他组件是分层的另一个重要优点。
### 1.协议分层
网络设计者以分层的方式组织协议以及实现这些协议的网络硬件和软件。
- 服务模型：某层向上一层提供服务，每层通过在该层中执行某些动作或使用直接下层的服务来提供服务
	- 由第n层提供的服务可能包括报文从网络的一边到另一边的可靠交付。这可能是通过使用第n-1层的边缘到边缘的不可靠报文传送服务，加上第n层的检测和重传丢失报文的功能来实现的。
- 一个协议层能够用软件、硬件或两者的结合来实现。
	- 诸如 HTTP 和 SMTP 这样的应用层协议几乎总是在端系统中用软件实现，运输层协议也是如此。
	- 因为物理层和数据链路层负责处理跨越特定链路的通信，它们通常在与给定链路相关联的网络接口卡(例如以太网或WiFi接口卡)中实现。
	- 网络层经常是硬件和软件实现的混合体。
	- 还要注意的是，如同分层的航线体系结构中的功能分布在构成该系统的各机场和飞行控制中心中一样，一个第n层协议也分布在构成该网络的端系统、分组交换机和其他组件中。这就是说，第n层协议的不同部分常常位于这些网络组件的各部分中。
- 协议分层具有概念化和结构化的优点`[RFC 3439]`​。如我们看到的那样，分层提供了**一种结构化方式来讨论系统组件**。模块化使更新系统组件更为容易。然而，需要提及的是，某些研究人员和联网工程师激烈地反对分层`[Wakeman1992]`​。
	- 分层的一个潜在缺点是一层可能冗余较低层的功能。例如，许多协议栈在基于每段链路和基于端到端两种情况下，都提供了差错恢复。
	- 第二种潜在的缺点是某层的功能可能需要仅在其他某层才出现的信息(如时间戳值)，这违反了层次分离的目标。
		- 分层设计强调**信息封装与抽象隔离**，每层只使用相邻层的接口。这样有助于模块独立开发，但也限制了**跨层优化能力**。
		- TCP 想要进行**拥塞控制**时，可能需要获取：
		    - 网络层的**路径 RTT 时间戳**。
		    - 链路层的**链路状态信息**（例如无线链路质量）。
			- 但按分层规范，**TCP 无法直接访问 IP 或链路层的这些细节**，因此可能做出不准确的控制决策。
### (1)应用层
应用层是网络应用程序及它们的应用层协议存留的地方。
- 因特网的应用层包括许多协议，例如HTTP(它提供了Web文档的请求和传送)、SMTP(它提供了电子邮件报文的传输)和FTP(它提供两个端系统之间的文件传送)。我们将看到，某些网络功能，如将像www.ietf.org这样对人友好的端系统名字转换为32比特的网络地址，也是借助于特定的应用层协议即域名系统(DNS)完成的。我们将在第2章中看到，创建并部署我们自己的新应用层协议是非常容易的。
![](Pasted%20image%2020250617155853.png)
图1-23 因特网协议栈和 OSI 参考模型
应用层协议分布在多个端系统上，而一个端系统中的应用程序使用协议与另一个端系统中的应用程序交换信息分组。我们把这种位于应用层的信息分组称为报文(message)。

(2)运输层
因特网的运输层在应用程序端点之间传送应用层报文。在因特网中，有两种运输协议，即 TCP 和UDP，利用其中的任一个都能运输应用层报文。TCP 向它的应用程序提供了面向连接的服务。这种服务包括了应用层报文向目的地的确保传递和流量控制(即发送方/接收方速率匹配)。TCP 也将长报文划分为短报文，并提供拥塞控制机制，因此当网络拥塞时，源抑制其传输速率。UDP 协议向它的应用程序提供无连接服务。这是一种不提供不必要服务的服务，没有可靠性，没有流量控制，也没有拥塞控制。在本书中，我们把运输层的分组称为报文段(segment)。

### (3)网络层
因特网的网络层负责将称为数据报(datagram)的网络层分组从一台主机移动到另一台主机。在一台源主机中的因特网运输层协议(TCP或UDP)向网络层递交运输层报文段和目的地址，就像你通过邮政服务寄信件时提供一个目的地址一样。

因特网的网络层包括著名的网际协议IP，
- 该协议定义了在数据报中的各个字段以及端系统和路由器如何作用于这些字段。
- IP 仅有一个，所有具有网络层的因特网组件必须运行IP。
- 因特网的网络层也包括决定路由的路由选择协议，它根据该路由将数据报从源传输到目的地。因特网具有许多路由选择协议。
- 如我们在1.3 节所见，因特网是一个网络的网络，并且在一个网络中，其网络管理者能够运行所希望的任何路由选择协议。尽管网络层包括了网际协议和一些路由选择协议，但通常把它简单地称为IP 层，这反映了IP是将因特网连接在一起的黏合剂这样的事实。

### (4)链路层
因特网的网络层通过源和目的地之间的一系列路由器路由数据报。为了将分组从一个节点(主机或路由器)移动到路径上的下一个节点，网络层必须依靠该链路层的服务。特别是在每个节点，网络层将数据报下传给链路层，链路层沿着路径将数据报传递给下一个节点。在该下一个节点，链路层将数据报上传给网络层。

由链路层提供的服务取决于应用于该链路的特定链路层协议。例如，某些协议基于链路提供可靠传递，从传输节点跨越一条链路到接收节点。值得注意的是，这种可靠的传递服务不同于TCP的可靠传递服务，TCP提供从一个端系统到另一个端系统的可靠交付。链路层的例子包括以太网、WiFi和电缆接入网的DOCSIS协议。因为数据报从源到目的地传送通常需要经过几条链路，一个数据报可能被沿途不同链路上的不同链路层协议处理。例如，一个数据报可能被一段链路上的以太网和下一段链路上的PPP所处理。网络层将受到来自每个不同的链路层协议的不同服务。在本书中，我们把链路层分组称为帧(frame)。

### (5)物理层
虽然链路层的任务是将整个帧从一个网络元素移动到邻近的网络元素，而物理层的任务是将该帧中的一个个比特从一个节点移动到下一个节点。在这层中的协议仍然是链路相关的，并且进一步与该链路(例如，双绞铜线、单模光纤)的实际传输媒体相关。例如，以太网具有许多物理层协议:一个是关于双绞铜线的，另一个是关于同轴电缆的，还有一个是关于光纤的，等等。在每种场合中，跨越这些链路移动一个比特是以不同的方式进行的。