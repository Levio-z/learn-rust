---
tags:
  - note
---
### 1. 什么是跨域？
当一个资源（例如网页中的 JavaScript 代码）尝试从一个**与自身来源（Origin）不同**的另一个来源请求资源时，就发生了跨域请求。
**“来源 (Origin)”** 是由三个要素共同决定的：
1. **协议 (Protocol)**：例如 `http` 或 `https`。
2. **域名 (Domain/Host)**：例如 `www.example.com`。
3. **端口 (Port)**：例如 `80` 或 `443`。
如果请求方和被请求方的**任意一个要素不同**，浏览器就会认为这是一个**跨域请求**。

| 请求方 URL (Origin A)         | 目标 URL (Origin B)         | 跨域原因                          |
| -------------------------- | ------------------------- | ----------------------------- |
| `http://example.com/`      | `https://example.com/`    | **协议不同** (`http` vs `https`)  |
| `http://example.com:8080/` | `http://example.com/`     | **端口不同** (`8080` vs 默认 `80`)  |
| `http://api.example.com/`  | `http://www.example.com/` | **域名不同** (`api` vs `www` 子域名) |

### 2. 同源策略 (Same-Origin Policy, SOP)

这是 Web 浏览器的一项核心安全机制。它的目的是**防止恶意网站从其他网站窃取数据**。
- **限制：** SOP 限制了来自一个源的脚本如何与另一个源的资源进行交互。
- **对于跨域请求的默认行为：** **浏览器会发出请求，但如果服务器没有明确授权，浏览器会拦截响应，不让客户端 JavaScript 代码访问它。** (这是一个常见的误解，请求发出去了，只是响应被拦截了)。
    

### 3. 如何实现跨域请求（解决方案）

由于现代 Web 应用（尤其是前后端分离的应用）需要大量跨域通信，标准定义了多种机制来绕过或放宽 SOP 的限制：

#### A. CORS (Cross-Origin Resource Sharing, 跨域资源共享)

这是官方推荐的标准解决方案，它依赖于服务器发送特殊的 **HTTP 响应头**来告诉浏览器允许跨域访问。
- **简单请求 (Simple Request):** 浏览器直接发送请求。服务器在响应中添加 `Access-Control-Allow-Origin` 头部，如果值与请求来源匹配，则允许访问。
- **复杂请求 (Complex Request):** 对于 POST/PUT/DELETE 等方法或带有自定义头部的请求，浏览器会先发送一个 **OPTIONS 预检请求 (Preflight Request)**，以确认服务器是否允许实际的请求。
#### B. JSONP (JSON with Padding)
一种历史悠久的、利用 `<script>` 标签没有跨域限制的漏洞的解决方案。它依赖于服务器返回一个包裹在函数调用中的 JSON 数据。
- **缺点：** 仅支持 GET 请求，安全性较差，已被 CORS 大部分取代。
#### C. 代理 (Proxy)
让客户端向**同源**的代理服务器发起请求，然后由代理服务器（在后端）转发请求到目标服务器。由于服务器到服务器的通信不受 SOP 限制，因此这种方法是有效的。
- **原理：** 浏览器认为它是同源请求，然后服务器替浏览器完成了跨域访问。
    

#### D. WebSocket

WebSocket 协议在建立连接时也遵循同源策略，但一旦连接建立后，它不再受 SOP 的限制，可以进行双向通信。