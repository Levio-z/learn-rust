---
tags:
  - note
---

### 1. CONNECT 方法的核心目的：建立隧道
- **用途：** `CONNECT` 方法专门用于**代理服务器**，要求代理服务器在客户端和目标服务器之间建立一条**双向的、端到端的网络隧道**。
- **通信协议：** 一旦隧道建立，客户端就可以通过这条隧道使用**非 HTTP 协议**进行通信。
### 2. 主要应用场景：加密通信（HTTPS）
- **SSL/TLS 加密：** `CONNECT` 方法最主要的应用就是处理 **HTTPS (HTTP over TLS/SSL)** 请求。
- **工作原理：**
    1. 客户端向代理服务器发送一个 `CONNECT` 请求，请求 URI 只包含目标服务器的**主机名和端口号**（例如：`CONNECT www.example.com:443 HTTP/1.1`）。
    2. 代理服务器建立与目标服务器的 TCP 连接。
    3. 如果连接成功，代理服务器返回 `200 Connection Established` 响应。
    4. 从这一刻起，代理服务器不再解析 HTTP 报文，而是简单地将客户端发送的所有数据流（现在是**加密的 TLS 数据**）**原样转发**给目标服务器，并将目标服务器的响应原样转发回客户端。
    5. 客户端随后在隧道内与目标服务器进行 **TLS 握手**，完成加密通信。
### 3. 为什么需要 CONNECT？
如果客户端直接向代理发送加密数据，代理服务器将无法读取数据，也就不知道目标服务器是谁，无法转发请求。
`CONNECT` 方法的作用就是：
- **告诉代理：** “我的下一个请求将是加密的，请你先帮我建立到目标主机的连接。”
- **绕过解析：** 建立隧道后，代理只需要进行**字节级转发**，不需要知道通信的具体内容（保护了用户的加密通信隐私）。
### 4. CONNECT 方法的格式
标准的请求行格式如下：
HTTP
```
CONNECT Hostname:Port HTTP/版本号
```
**示例：**
HTTP
```
CONNECT www.google.com:443 HTTP/1.1
Host: www.google.com:443
```
_其中，`www.google.com:443` 就是请求 URI，格式就是我们之前讨论的**Authority 格式**。_


![](../asserts/Pasted%20image%2020251014190915.png)


### CONNECT 方法之所以成为处理 HTTPS (HTTP over TLS/SSL) 请求最主要的手段，根本原因是 代理服务器无法解密用户的加密数据。

**数据加密转发：** 一旦隧道建立，代理服务器就**不再尝试解析**后续的数据。客户端立即开始与 `www.example.com` 进行 **TLS/SSL 握手**（加密过程）。代理只是简单地将客户端发送的所有**加密字节流**转发给目标服务器，并将目标服务器的**加密响应字节流**原样转发回客户端。

在 TLS/SSL 握手开始之前，先用一个明文的 HTTP 请求告诉代理：“请为我打开一个通往 `<目标主机:端口>` 的 TCP 管道。” 管道打开后，所有数据在其中都是加密的，代理只负责转发字节，从而保护了加密通信的端到端安全和隐私。