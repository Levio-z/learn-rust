- _递归类型_的值可以将另一个相同类型的值作为其自身的一部分。
- **递归类型会带来问题，因为在编译时 Rust 需要知道类型占用了多少空间。但是，递归类型的值的嵌套理论上可以无限继续，因此 Rust 无法知道该值需要多少空间**。由于框的大小已知，我们可以通过在递归类型定义中插入框来启用递归类型。
### 递归类型示例：cons 列表
- cons 列表是一种数据结构，源自 Lisp 编程语言及其方言，由嵌套对组成，是 Lisp 版本的链表。它的名称来自 Lisp 中的cons函数（“构造函数”的缩写），该函数从其两个参数构造一个新的对。通过对由一个值和另一个对组成的对调用cons ，我们可以构造由递归对组成的 cons 列表。
- 例如，下面是 cons 列表的伪代码表示，其中包含列表 1、2、3，每对都放在括号中：
    - cons 列表中的每个项目包含两个元素：当前项目的值和下一个项目。
    - 列表中的最后一项仅包含一个名为`Nil`的值 没有下一个项目。
    - cons 列表是通过递归调用`cons`生成的 函数。
    - 表示递归基本情况的规范名称是`Nil` 。请注意，这与第 6 章中的“null”或“nil”概念不同，后者表示无效或缺失的值。
```rust

use crate::List::{Cons, Nil};
enum List {
    Cons(i32, List),
    Nil,
}
fn main() {
    let list = Cons(1, Cons(2, Cons(3, Nil)));
}}
```
- 错误显示此类型“具有无限大小”。原因是我们定义了 具有递归变体的List ：它直接保存其自身的另一个值。因此，Rust 无法确定需要多少空间来存储 List值。让我们分析一下为什么会出现此错误。首先，我们来看看 Rust 如何决定存储非递归类型的值所需的空间。
#### Rust怎么确定空间大小
- 为了确定为`Message`值分配多少空间，Rust 会检查每个变体，看看哪个变体需要最多的空间。Rust 发现`Message::Quit`不需要任何空间， `Message::Move`需要足够的空间来存储两个`i32`值，等等。因为只使用一个变体，所以`Message`值所需的最大空间是存储其最大变体所需的空间。
- 这与 Rust 尝试确定递归类型（如示例 15-2 中的`List`枚举）需要多少空间时发生的情况形成对比。编译器首先查看`Cons`变量，它保存一个`i32`类型的值和一个`List`类型的值。因此， `Cons`需要的空间量等于`i32`的大小加上`List`的大小。要确定`List`需要多少内存 类型需要时，编译器会查看变体，从`Cons`开始 变体。Cons `Cons`体保存`i32`类型的值和 `List` ，这个过程无限地继续，如图15-1所示。
- ![](Pasted%20image%2020250604202437.png)
#### 如何获取具有已知大小的递归类型
- 改变数据结构，通过存储指向该值的指针来间接存储值。
- 因为`Box<T>`是一个指针，所以 Rust 总是知道`Box<T>`有多少空间 需求：**指针的大小不会根据其数据量而改变指向**
- 这意味着我们可以将Box<\T>放入Cons变量中，而不是直接放入另一个List值。Box Box<\T>将指向下一个List 值将位于堆上，而不是Cons变量内。从概念上讲，我们仍然有一个列表，它由包含其他列表的列表创建，但此实现现在更像是将项目彼此相邻放置，而不是彼此嵌套。
```rust
enum List {
    Cons(i32, Box<List>),
    Nil,
}

use crate::List::{Cons, Nil};

fn main() {
    let list = Cons(1, Box::new(Cons(2, Box::new(Cons(3, Box::new(Nil))))));
}
```
- `Cons`变量需要`i32`的大小加上存储框指针数据的空间。Nil `Nil`不存储任何值，因此它所需的空间比`Cons`变量要小。我们现在知道，任何`List`值都将占用`i32`的大小加上框指针数据的大小。通过使用框，我们打破了无限递归链，因此编译器可以计算出存储`List`值所需的大小。图 15-2 显示了`Cons`变量现在的样子。
![](Pasted%20image%2020250604202804.png)




### 参考链接
- [使用 Boxes 启用递归类型](https://rust-book.cs.brown.edu/ch15-01-box.html#enabling-recursive-types-with-boxes)
- [1.链表刷题中的Option相关设计](1.链表刷题中的Option相关设计.md)