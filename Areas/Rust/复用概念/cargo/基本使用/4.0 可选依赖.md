## ğŸ§© ç¤ºä¾‹ï¼šæ·»åŠ å¯é€‰ä¾èµ–

### æ­¥éª¤ 1ï¼šæ·»åŠ  `foo` ä¸ºå¯é€‰ä¾èµ–

```bash
cargo add foo --optional
```

åœ¨ `Cargo.toml` ä¸­ä¼šç”Ÿæˆï¼š

```toml
[dependencies]
foo = { version = "x.y.z", optional = true }
```

æ­¤æ—¶ï¼Œå³ä½¿ä½ è¿è¡Œ `cargo build`ï¼Œ**ä¹Ÿä¸ä¼šç¼–è¯‘ `foo`**ï¼Œå› ä¸ºå®ƒæ²¡æœ‰è¢«å¯ç”¨ã€‚

---

### æ­¥éª¤ 2ï¼šé€šè¿‡ features æ˜¾å¼å¯ç”¨

```toml
[features]
default = []         # é»˜è®¤ä¸å¯ç”¨ä»»ä½•å¯é€‰åŠŸèƒ½
use_foo = ["foo"]    # æ–°å¢ä¸€ä¸ª featureï¼Œå¯ç”¨ foo
```

ä½ å¯ä»¥è¿™æ ·æ„å»ºé¡¹ç›®å¹¶å¯ç”¨ `foo`ï¼š

```bash
cargo build --features use_foo
```

è¿™æ—¶å€™ `foo` æ‰ä¼šè¢«çœŸæ­£åŠ å…¥ç¼–è¯‘ä¾èµ–å›¾ä¸­ã€‚

---

## ğŸ” ä½¿ç”¨åœºæ™¯ç¤ºæ„

ä¾‹å¦‚ä½ æœ‰ä¸€ä¸ªåº“ `my-lib`ï¼Œé»˜è®¤æä¾›æ ¸å¿ƒåŠŸèƒ½ï¼Œä½†å¦‚æœç”¨æˆ·å¯ç”¨äº† `serde`ï¼Œå°±å¯ä»¥è®©ç»“æ„ä½“æ”¯æŒåºåˆ—åŒ–ï¼š

```toml
[dependencies]
serde = { version = "1.0", optional = true, features = ["derive"] }

[features]
default = []
with-serde = ["serde"]
```

```rust
#[cfg(feature = "with-serde")]
use serde::{Serialize, Deserialize};

#[cfg_attr(feature = "with-serde", derive(Serialize, Deserialize))]
pub struct Config {
    pub id: u32,
}
```

---

## ğŸ¯ æ€»ç»“

| å¯é€‰ä¾èµ– | è¯´æ˜ |
| --- | --- |
| `optional = true` | è¡¨ç¤ºä¸ä¼šè‡ªåŠ¨å¯ç”¨ï¼Œå¿…é¡»é€šè¿‡ `features` æ˜¾å¼å¼€å¯ |
| ä½œç”¨ | é™ä½é»˜è®¤ç¼–è¯‘æˆæœ¬ï¼Œæå‡çµæ´»æ€§ï¼›é€‚åˆç”¨äºæ’ä»¶åŒ–ã€å¹³å°å·®å¼‚æ”¯æŒç­‰ |
| é…å¥—æœºåˆ¶ | `features` æœºåˆ¶ä¸€èµ·ä½¿ç”¨ |

---