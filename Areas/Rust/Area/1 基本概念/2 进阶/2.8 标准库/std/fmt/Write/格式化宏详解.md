在 Rust 中，`core::fmt` 模块提供了实现格式化输出所需的类型和特性。`fmt::Write` 是该模块中的一个特性（trait），它为自定义类型实现了字符串写入功能。在格式化输出过程中，`fmt::Write` 与格式化宏（如 `format!`、`println!` 等）紧密合作，负责将格式化后的字符串输出到某个目标（例如标准输出、文件或自定义缓冲区）。
#### 1. `fmt::Write` 特性

`fmt::Write` 特性为类型提供了一个必要的方法 `write_str`，用于将一个字符串写入到实现此特性的类型中。这个方法的签名是：

```rust
fn write_str(&mut self, s: &str) -> fmt::Result;
```

- **参数**：
    - `&mut self`：该方法修改实现了 `fmt::Write` 特性的对象。
    - `s: &str`：要写入的字符串。
- **返回值**：`fmt::Result`，通常为 `Ok(())` 或 `Err(fmt::Error)`，表示写入操作的结果。

#### 2. `Writer` 类型和 `write_str` 方法

假设我们有一个自定义的 `Writer` 类型，该类型实现了 `fmt::Write` 特性：

#### 3. 格式化宏的实现

Rust 提供了几个格式化宏，例如 `println!`、`format!` 和 `write!`，它们都依赖于 `fmt::Write` 特性来实现输出。以下是一些例子：
```rust
let mut writer = Writer { buffer: String::new() };
write!(&mut writer, "Hello, {}!", "world").unwrap();
println!("{}", writer.buffer);  // 输出: Hello, world!
```
在上面的例子中，`write!` 会将格式化字符串 `"Hello, world!"` 写入到 `writer` 对象中（它是一个实现了 `fmt::Write` 特性的类型）。注意，`write!` 的第一个参数是一个实现了 `fmt::Write` 特性的对象，格式化后的字符串就会被写入这个对象。

`println!` 会将格式化的字符串写入到标准输出，内部调用了 `write!` 宏。`write!` 宏的目标通常是实现了 `fmt::Write` 特性的对象。例如：

3.2 `format!`3.2 `格式！`

`format!` 宏返回一个格式化后的字符串，而不是直接输出它。它内部也会使用 `fmt::Write` 来将格式化后的内容写入到一个 `String` 中：
```rust
let s = format!("Hello, {}!", "world");
println!("{}", s);  // 输出: Hello, world!
```