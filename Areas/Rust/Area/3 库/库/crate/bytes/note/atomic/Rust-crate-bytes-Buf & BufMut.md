---
tags:
  - note
---
## 1. 核心观点  
### Ⅰ. 概念层
这两个特性提供了对缓冲区的读写访问
#### `Bytes`：**不可变、可共享、零拷贝字节序列**
- [Rust-crate-bytes-struct-bytes](note/atomic/Rust-crate-bytes-struct-bytes.md)
#### `BytesMut`：**可变、可增长的字节缓冲区**
- [绝对可靠](#绝对可靠)
- [Rust-crate-bytes-优点-语义化的写入和访问接口](Rust-crate-bytes-优点-语义化的写入和访问接口.md)

### Ⅱ. 应用层
- [如何与read和write协同工作的？](#如何与read和write协同工作的？)

### Ⅲ. 实现层

### **IV**.原理层

## 2. 背景/出处  
- 来源：
	- https://docs.rs/bytes/1.11.0/bytes/
- 引文/摘要：  
  - …  
  - …  

## 3. 展开说明  



#### `Buf` / `BufMut`：**面向 IO 的顺序读写抽象 trait**
这两个特性提供了对缓冲区的读写访问。底层存储可能位于连续内存中 `Buf` 也可能不位于连续内存中。例如， `Bytes` 缓冲区保证了连续内存，而 [rope](https://en.wikipedia.org/wiki/Rope_\(data_structure\)) 缓冲区则将字节存储在不连续的块中。Buf 和 `BufMut` 维护着用于跟踪底层字节存储中当前位置的游标。当读取或写入字节时，游标会前进。
##### 绝对可靠
- **`Read/Write` 是“不可靠”的**： 当你调用 `file.read(&mut buf)` 或 `socket.write(data)` 时，代码会跨越用户态进入**内核态**，甚至通过网卡或硬盘去操作物理硬件。这个过程可能因为网线断了、磁盘满了、或者对方拒绝连接而失败。因此，它们的返回值永远是 `Result`。
    
- **`Buf/BufMut` 是“绝对可靠”的**： 它们的操作对象是**内存（RAM）**。当你从 `BytesMut` 中读取一个 `u16` 或者往里放一个字节时，它只是在内存里移动指针或修改字节。除非你的电脑内存条坏了，否则这种纯内存操作**不会失败**。

- [Rust-crate-bytes-优点-语义化的写入和访问接口](Rust-crate-bytes-优点-语义化的写入和访问接口.md)
#### 如何与read和write协同工作的？

在实际开发中，你通常会将它们结合使用。典型的流程如下：

1. **准备容器**：创建一个 `BytesMut`（实现 `BufMut`）。
    
2. **执行系统调用**：调用 `stream.read(&mut buf).await?`（使用 `Read`）。此时数据从网络进入了容器。
    
3. **可靠地处理**：现在数据已经在内存里了，你使用 `buf.get_u32()` 等方法（使用 `Buf`）来解析数据。**由于数据已经在本地内存中，解析过程不需要再处理 IO 错误。**

| **特性**   | **Read / Write**              | **Buf / BufMut**            |
| -------- | ----------------------------- | --------------------------- |
| **操作对象** | 外部设备（文件、套接字、管道）               | **本地内存**                    |
| **核心风险** | 系统调用失败、网络中断（`std::io::Error`） | **无风险**（除非内存越界导致 Panic）     |
| **执行开销** | 高（涉及上下文切换和系统内核）               | **极低**（仅 CPU 寄存器和内存操作）      |
| **返回类型** | `Result<usize, Error>`        | 通常直接返回数值 (如 `u32`)          |
| **异步支持** | 必须有异步版本 (AsyncRead)           | **天然支持**（纯内存操作不需要 `.await`） |
## 4. 与其他卡片的关联  
- 前置卡片：
	- [Rust-crate-tokio-基本概念](../../../tokio/Rust-crate-tokio-基本概念.md)
- 后续卡片：
- 相似主题：

## 5. 应用/启发  
- 可以如何应用在工作、学习、生活中  
- 引发的思考与问题  

## 6. 待办/进一步探索  
 
  
