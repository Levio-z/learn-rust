---
tags:
  - permanent
---
## 1. 核心观点  

协商式决策指的是两个独立的个体通过交流信息，然后根据规则进行决策，**最常用的协商式决策就是主备决策**。

## 2. 背景/出处  

## 3. 展开说明  

![](asserts/Pasted%20image%2020251114150044.png)

这个架构的基本协商规则可以设计成：

- 2 台服务器启动时都是备机。
- 2 台服务器建立连接。
- 2 台服务器交换状态信息。
- 某 1 台服务器做出决策，成为主机；另一台服务器继续保持备机身份。

协商式决策的架构不复杂，规则也不复杂，其难点在于，如果两者的信息交换出现问题（比如主备连接中断），此时状态决策应该怎么做。

- 如果备机在连接中断的情况下认为主机故障，那么备机需要升级为主机，但实际上此时主机并没有故障，那么系统就出现了两个主机，这与设计初衷（1 主 1 备）是不符合的。

![](https://static001.geekbang.org/resource/image/09/6f/0919428efccf7fde2e02f92b89f1626f.png)

- 如果备机在连接中断的情况下不认为主机故障，则此时如果主机真的发生故障，那么系统就没有主机了，这同样与设计初衷（1 主 1 备）是不符合的。

![](https://static001.geekbang.org/resource/image/2a/52/2a3e013ab1e2e5086679becba0308652.png)

- 如果为了规避连接中断对状态决策带来的影响，可以增加更多的连接。例如，双连接、三连接。这样虽然能够降低连接中断对状态带来的影响（注意：只能降低，不能彻底解决），但同时又引入了这几条连接之间信息取舍的问题，即如果不同连接传递的信息不同，应该以哪个连接为准？实际上这也是一个无解的答案，无论以哪个连接为准，在特定场景下都可能存在问题。

![](https://static001.geekbang.org/resource/image/28/32/28a95c98954c47b70d7f1d8f826c2932.png)

综合分析，协商式状态决策在某些场景总是存在一些问题的。

## 4. 与其他卡片的关联  
- 前置卡片：
	- [架构设计-高可用-基本概念](架构设计-高可用-基本概念.md)
- 后续卡片：
	- 
- 相似主题：

## 5. 应用/启发  
- 可以如何应用在工作、学习、生活中  
- 引发的思考与问题  

## 6. 待办/进一步探索  
 
  
