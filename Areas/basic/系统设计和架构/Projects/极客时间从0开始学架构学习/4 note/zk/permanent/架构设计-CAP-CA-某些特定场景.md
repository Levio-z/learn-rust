---
tags:
  - permanent
---
## 1. 核心观点  

- [业务上要求一致性，只能单点写入，其他节点备份，无法做到分布式情况下多点写入](架构设计-CAP-CA-某些特定场景.md#业务上要求一致性，只能单点写入，其他节点备份，无法做到分布式情况下多点写入)
	- 实际架构： [整个系统应用分布式架构，单个数据做不了分布式](#整个系统应用分布式架构，单个数据做不了分布式)
- [CA的实现也不一样](架构设计-CAP-CA-某些特定场景.md#CA的实现也不一样)
## 2. 背景/出处  

## 3. 展开说明  
### 实际场景中有些场景只能CA，比如金融

#### **业务上要求一致性，只能单点写入，其他节点备份，无法做到分布式情况下多点写入**
- 不要小看了这几毫秒或者几十毫秒的不一致，对于某些严苛的业务场景，例如和金钱相关的用户余额，或者和抢购相关的商品库存，技术上是无法做到分布式场景下完美的一致性的。而业务上必须要求一致性，因此单个用户的余额、单个商品的库存，**理论上要求选择CP而实际上CP都做不到，只能选择CA。也就是说，只能单点写入，其他节点做备份，无法做到分布式情况下多点写入。**

#### 整个系统应用分布式架构，单个数据做不了分布式
- 需要注意的是，这并不意味着这类系统无法应用分布式架构，只是说“**单个用户余额、单个商品库存”无法做分布式**，但系统整体还是可以应用分布式架构的。例如，下面的架构图是常见的将用户分区的分布式架构。
![](asserts/Pasted%20image%2020251220163144.png)


我们可以将用户id为0 ~ 100的数据存储在Node 1，将用户id为101 ~ 200的数据存储在Node 2，Client根据用户id来决定访问哪个Node。对于单个用户来说，读写操作都只能在某个节点上进行；对所有用户来说，有一部分用户的读写操作在Node 1上，有一部分用户的读写操作在Node 2上。

##### **降低故障受影响的范围**
这样的设计有一个很明显的问题就是某个节点故障时，这个节点上的用户就无法进行读写操作了，但站在整体上来看，这种设计可以降低节点故障时受影响的用户的数量和范围，毕竟只影响20%的用户肯定要比影响所有用户要好。这也是为什么挖掘机挖断光缆后，支付宝只有一部分用户会出现业务异常，而不是所有用户业务异常的原因。

正常运行情况下，不存在CP和AP的选择，可以同时满足CA。

### CA的实现也不一样

同样以用户管理系统为例，即使是实现CA，不同的数据实现方式也可能不一样：用户账号数据可以采用“消息队列”的方式来实现CA，因为消息队列可以比较好地控制实时性，但实现起来就复杂一些；而用户信息数据可以采用“数据库同步”的方式来实现CA，因为数据库的方式虽然在某些场景下可能延迟较高，但使用起来简单。

 在分布式系统中，即便选择 **CA（Consistency + Availability）** 模式，不同类型的数据也可能采用不同的实现策略，原因在于数据的访问特性、实时性要求和实现复杂度不同。以用户管理系统为例：

#### 1. 用户账号数据采用消息队列实现 CA
- **特点**：
    - 用户账号涉及 **登录、注册、权限管理** 等操作，对 **实时性** 要求高。
    - 消息队列可以在多个节点间 **异步广播更新**，保证各节点最终状态一致。
    - 可以通过顺序保证或事务机制，保证消息的 **有序性和可靠性**。
- **实现优势**：
    - 高可用：节点宕机不会丢失消息，可在恢复后重放。
    - 一致性较好：消息按顺序处理，保证账户状态一致。
- **实现复杂度**：
    - 需要额外的消息队列基础设施（如 Kafka、RabbitMQ）。
    - 处理消息幂等性、顺序保证等问题较复杂。
#### 2. 用户信息数据采用数据库同步实现 CA
- **特点**：
    - 用户信息（姓名、头像、联系方式等）更新频率低，对实时性要求不高。
    - 可以通过 **主从同步、分布式数据库复制** 等方式保证各节点数据一致。
- **实现优势**：
    - 简单直接：直接依赖数据库的同步机制即可。
    - 易于维护和扩展：无需额外消息系统。
- **局限性**：
    - 在高并发更新下可能出现短暂延迟，实时性略低。
    - 节点间同步延迟可能导致短时间内的数据不一致，但整体仍满足 CA。


## 4. 与其他卡片的关联  
- 前置卡片：
- 后续卡片：
	- [架构设计-高可用-计算高可用](架构设计-高可用-计算高可用.md)
	- [架构设计-高可用-存储高可用](架构设计-高可用-存储高可用.md)
	- [架构设计-高可用-高可用状态决策](架构设计-高可用-高可用状态决策.md)
		- [架构设计-高可用-高可用状态决策-独裁式](架构设计-高可用-高可用状态决策-独裁式.md)
		- [架构设计-高可用-高可用状态决策-协商式](架构设计-高可用-高可用状态决策-协商式.md)
		- [架构设计-高可用-高可用状态决策-民主式](架构设计-高可用-高可用状态决策-民主式.md)
			- [架构设计-高可用-高可用状态决策-民主式-脑裂](架构设计-高可用-高可用状态决策-民主式-脑裂.md)
- 相似主题：

## 5. 应用/启发  
- 可以如何应用在工作、学习、生活中  
- 引发的思考与问题  

## 6. 待办/进一步探索  
 
  
