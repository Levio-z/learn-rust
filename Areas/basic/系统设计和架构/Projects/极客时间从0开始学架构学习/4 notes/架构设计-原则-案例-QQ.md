---
tags:
  - permanent
---
## 1. 核心观点  
- 功能安全是一个逐步完善的过程，而且**往往都是在问题出现后才能有针对性的提出解决方案，我们永远无法预测系统下一个漏洞在哪里**，也不敢说自己的系统肯定没有任何问题。
- 互联网系统的架构安全目前并没有太好的设计手段来实现，更**多地是依靠运营商或者云服务商强大的带宽和流量清洗的能力，较少自己来设计和实现**。

## 2. 背景/出处  

- https://book.douban.com/subject/30335935/

## 3. 展开说明  

1.十万级IM 1.X最开始的手机QQ后台是这样的，可以说是简单得不能再简单、普通得不能再普通的一个架构了，因为当时业务刚开始，架构设计遵循的是“合适原则”和“简单原则”​。
![](asserts/Pasted%20image%2020251204163241.png)

2.百万级IM 2.X

随着业务发展到2001年，QQ同时在线人数也突破了一百万。

- 第一代架构很简单，明显不可能支撑百万级的用户规模，主要的问题有：以接入服务器的内存为例，单个在线用户的存储量约为2KB，索引和在线状态为50字节，好友表400个好友 × 5字节/好友 =2000字节，大致来说，2GB内存只能支持一百万在线用户。CPU/网卡包量和流量/交换机流量等瓶颈。单台服务器支撑不下所有在线用户/注册用户。于是针对这些问题做架构改造，按照“演化原则”的指导进行了重构，重构的方案相比现在来说也还是简单得多，因此当时做架构设计时也遵循了“合适原则”和“简单原则”​。IM 2.X的最终架构如图所示。
![](asserts/Pasted%20image%2020251204163314.png)

3.千万级IM 3.X

                                                                                      
| 问题          | 原因                          | 影响                   |
| ----------- | --------------------------- | -------------------- |
| 同步流量太大      | 所有在线用户状态变化都需广播              | 网络压力大，延迟高            |
| 状态同步服务器单机瓶颈 | 单台服务器内存/CPU有限，无法存储/处理所有用户状态 | 状态更新延迟，用户看到好友在线状态不准确 |
| 接入服务器负载过大   | 每台服务器需要管理大量用户状态             | 内存占用高，可能导致连接中断或掉线    |
![](asserts/Pasted%20image%2020251204164714.png)



## 4. 与其他卡片的关联  
- 前置卡片：

- 后续卡片：
	- 
- 相似主题：

## 5. 应用/启发  
- 可以如何应用在工作、学习、生活中  
- 引发的思考与问题  

## 6. 待办/进一步探索  
- [ ] 深入阅读 xxx  
- [ ] 验证这个观点的边界条件  
