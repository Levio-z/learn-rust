运行一个 Alpine 容器并执行 `ls -a` 命令

| 部分           | 含义                                      |
| ------------ | --------------------------------------- |
| `docker run` | 启动一个容器                                  |
| `alpine`     | 使用的镜像，表示从本地或远程拉取 `alpine:latest` 镜像     |
| `ls -a`      | 容器启动后要执行的命令：列出所有文件，包括隐藏文件（如 `.profile`） |
## ✅ 1. 定义与作用

```bash
docker run [OPTIONS] IMAGE [COMMAND] [ARG...]
```

- `OPTIONS`: docker 自身运行容器时的选项，例如 `-it`、`--rm`、`-v` 等。
- `IMAGE`: 指定的镜像名，比如 `ubuntu`、`nginx:1.25`。
- `[COMMAND]`：**容器启动后要运行的命令**（可选项）
	- 这个部分会**覆盖镜像默认设置的命令**（也就是 `Dockerfile` 中的 `CMD` 或 `ENTRYPOINT` 指令）。
- `[ARG...]`传递给容器内可执行程序的参数
**作用**：**基于指定镜像创建并启动一个新的容器实例**。  
这个命令是 Docker 中最核心的操作之一，实现了“镜像到运行容器”的转变。

---

## 🧩 2. 工作流程简述

-   检查本地是否已有指定镜像，没有则自动执行 `docker pull` 拉取镜像
    
-   创建一个新的容器文件系统（基于镜像只读层叠加可写层）
    
-   分配容器网络、存储、PID 等资源
    
-   根据指定的命令（或镜像默认入口）启动容器进程
    
-   返回容器的运行 ID
    

---

## 🧪 3. 常用选项详解

| 选项                   | 说明                                          |
| -------------------- | ------------------------------------------- |
| `-d`, `--detach`     | 后台运行容器，返回容器 ID，不附着到当前终端                     |
| `-it`                | `-i` 保持标准输入，`-t` 分配伪终端，适合交互式容器              |
| `--name`             | 指定容器名称                                      |
| `-p`, `--publish`    | 宿主机的 端口映射到容器的端口，格式 `hostPort:containerPort` |
| `-v`, `--volume`     | 挂载数据卷，实现宿主机目录与容器目录的绑定                       |
| `--rm`               | 容器退出后自动删除                                   |
| `--env`, `-e`        | 设置环境变量                                      |
| `--network`          | 指定容器网络                                      |
| `--restart`          | 容器退出时自动重启策略（`no`、`on-failure`、`always` 等）   |
| `--cpus`, `--memory` | 限制容器使用的 CPU 和内存资源                           |
| -P                   | 随机端口映射                                      |
用法：
- `-it` 常用于**前台交互式容器**，例如启动一个 bash shell，可以实时操作容器。
- `-d` 用于**后台运行容器**，不占用当前终端。
	- Docker容器后台启动，必须有一个前台进程，容器的命令如果不是一直挂起的命令就会退出
- -p 指定端口映射
	- [5-3-2 端口映射方式](5-3-2%20端口映射方式.md)
	- ip：hostport
	- 基本格式：`-p [host_ip:]host_port:container_port[/protocol]`
		- `host_ip`（可选）：绑定宿主机的具体 IP，默认绑定所有接口 `0.0.0.0`
		- `host_port`：宿主机端口
		- `container_port`：容器内部端口
		- `protocol`（可选）：协议，默认 TCP，可指定为 `udp`
---

## 🔍 4. 基本示例

### 1️⃣ 运行一个交互式 Ubuntu 容器

```bash
docker run -it ubuntu /bin/bash
```

启动 Ubuntu 镜像并进入交互式 Bash shell。

---

### 2️⃣ 后台运行一个 nginx 服务，映射 80 端口

```bash
docker run -d -p 8080:80 nginx
```

容器内 80 端口映射到宿主机 8080 端口，后台运行。

---

### 3️⃣ 运行后自动删除容器（短生命周期任务）

```bash
docker run --rm busybox echo "Hello Docker"
```

容器执行完命令自动销毁。

---

## ⚙️ 5. 底层机制简要

-   **镜像层叠加**  
    容器文件系统由镜像只读层和容器可写层组成，`run` 时创建写层。
    
-   **命名空间（Namespace）隔离**  
    进程、网络、IPC、挂载等资源在容器内独立，隔离于宿主机。
    
-   **控制组（cgroup）资源限制**  
    对 CPU、内存、IO 等资源进行限制，保证宿主机稳定。
    
-   **容器网络**  
    默认使用桥接网络（bridge），支持自定义网络。
    

---

## 🧰 6. 进阶用法与场景

| 功能 | 示例命令 | 说明 |
| --- | --- | --- |
| 使用自定义命令运行 | `docker run ubuntu echo "Hi"` | 覆盖镜像默认命令，执行指定命令后退出 |
| 挂载宿主机目录 | `docker run -v /host/data:/container/data busybox` | 数据持久化和共享 |
| 设置环境变量 | `docker run -e ENV=prod myapp` | 传递配置参数 |
| 限制资源使用 | `docker run --memory=512m --cpus=1 nginx` | 防止容器占用过多资源 |
| 容器重启策略 | `docker run --restart=always myservice` | 容器异常退出自动重启 |
| 使用网络模式 | `docker run --network=host nginx` | 共享宿主机网络栈，性能更好，但隔离降低 |

---

## ⚠️ 7. 常见问题与注意事项

-   **交互式容器会话断开后容器是否退出？**  
    取决于是否使用 `-it` 以及容器内运行的进程是否持续。比如 `bash` 关闭后容器退出。
    
-   **端口映射与防火墙冲突**  
    映射宿主机端口时需确保端口未被占用，且防火墙允许访问。
    
-   **卷挂载权限问题**  
    宿主机目录权限影响容器读写，需合理设置。
    
-   **资源限制不当导致容器卡顿**  
    资源分配要结合应用需求，防止过紧限制。
    

---

## 🧱 8. 相关知识点拓展

| 知识点 | 说明 |
| --- | --- |
| Docker 容器生命周期 | run -> start -> stop -> rm |
| 容器与虚拟机区别 | 容器轻量，资源共享，启动快 |
| OCI 标准 | 容器镜像和运行时的开放标准 |
| 多阶段构建 | 通过 Dockerfile 优化镜像层，减小体积 |
| 容器日志管理 | 默认输出到宿主机，支持日志驱动配置 |

---

## 🧾 总结表

| 命令结构 | 说明 |
| --- | --- |
| `docker run IMAGE` | 基础命令，启动镜像 |
| `docker run -d` | 后台运行 |
| `docker run -it` | 交互式终端 |
| `docker run -p` | 端口映射 |
| `docker run -v` | 卷挂载 |
| `docker run --rm` | 退出后自动删除容器 |

---