### 1. 尝试使用docker compose 运行
```
➜  /workspace git:(main) docker compose up -d --build
env file /workspace/.env not found: stat /workspace/.env: no such file or directory
```
结果：
- 表示某个进程（可能是 Docker、某个 shell 脚本或构建工具）尝试加载路径为 `/workspace/.env` 的环境变量文件，但系统找不到该文件。
### 2.注册后
创建聊天
```
Request URL https://kjhc6retjs-80.cnb.run/api/chat Request Method POST Status Code 307 Temporary Redirect Referrer Policy strict-origin-when-cross-origin
```

- HTTP 状态码 307 表示临时重定向，告诉客户端“请求需要重定向到另一个 URL”，但**请求方法和请求体保持不变**。
	- 这通常用在服务端告诉客户端“换一个 URL 去请求”，比如从 HTTP 重定向到 HTTPS，或者从裸域重定向到带 www 域名等。
	- 你的前端请求已经是 `https://kjhc6retjs-80.cnb.run/api/chat`（HTTPS）。
	- 服务器响应 307 重定向，但重定向地址可能不正确或浏览器未跟进导致请求失败。
	- 这很可能是服务器（或反向代理）配置了某种跳转逻辑，导致请求被重定向。
### 3.日志
```
backend-1   | [chain/error] [chain:RunnableParallel<answer>] [58.79s] Chain run errored with error:
backend-1   | 2025-07-28 05:13:32,231 - asyncio - ERROR - Task exception was never retrieved
backend-1   | future: <Task finished name='Task-514' coro=<py_anext.<locals>.anext_impl() done, defined at /usr/local/lib/python3.11/site-packages/langchain_core/utils/aiter.py:71> exception=KeyError('context')>
backend-1   | Traceback (most recent call last):
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/utils/aiter.py", line 78, in anext_impl
backend-1   |     return await __anext__(iterator)
backend-1   |            ^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 3962, in atransform
backend-1   |     async for chunk in self._atransform_stream_with_config(
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 2321, in _atransform_stream_with_config
backend-1   |     chunk = await coro_with_context(py_anext(iterator), context)
backend-1   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 3948, in _atransform
backend-1   |     chunk = AddableDict({step_name: task.result()})
backend-1   |                                     ^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 3931, in get_next_chunk
backend-1   |     return await py_anext(generator)
backend-1   |            ^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5663, in atransform
backend-1   |     async for item in self.bound.atransform(
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 3446, in atransform
backend-1   |     async for chunk in self._atransform_stream_with_config(
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 2321, in _atransform_stream_with_config
backend-1   |     chunk = await coro_with_context(py_anext(iterator), context)
backend-1   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 3413, in _atransform
backend-1   |     async for output in final_pipeline:
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/output_parsers/transform.py", line 95, in atransform
backend-1   |     async for chunk in self._atransform_stream_with_config(
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 2281, in _atransform_stream_with_config
backend-1   |     final_input: Optional[Input] = await py_anext(input_for_tracing, None)
backend-1   |                                    ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/utils/aiter.py", line 78, in anext_impl
backend-1   |     return await __anext__(iterator)
backend-1   |            ^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/utils/aiter.py", line 133, in tee_peer
backend-1   |     item = await iterator.__anext__()
backend-1   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 1470, in atransform
backend-1   |     async for ichunk in input:
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 1470, in atransform
backend-1   |     async for ichunk in input:
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5663, in atransform
backend-1   |     async for item in self.bound.atransform(
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/passthrough.py", line 647, in atransform
backend-1   |     async for chunk in self._atransform_stream_with_config(
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 2321, in _atransform_stream_with_config
backend-1   |     chunk = await coro_with_context(py_anext(iterator), context)
backend-1   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/passthrough.py", line 636, in _atransform
backend-1   |     yield await first_map_chunk_task
backend-1   |           ^^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/utils/aiter.py", line 78, in anext_impl
backend-1   |     return await __anext__(iterator)
backend-1   |            ^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 3962, in atransform
backend-1   |     async for chunk in self._atransform_stream_with_config(
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 2321, in _atransform_stream_with_config
backend-1   |     chunk = await coro_with_context(py_anext(iterator), context)
backend-1   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 3948, in _atransform
backend-1   |     chunk = AddableDict({step_name: task.result()})
backend-1   |                                     ^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 3931, in get_next_chunk
backend-1   |     return await py_anext(generator)
backend-1   |            ^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 5006, in atransform
backend-1   |     async for output in self._atransform_stream_with_config(
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 2321, in _atransform_stream_with_config
backend-1   |     chunk = await coro_with_context(py_anext(iterator), context)
backend-1   |             ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 4970, in _atransform
backend-1   |     output = await acall_func_with_variable_args(
backend-1   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 4945, in f
backend-1   |     return await run_in_executor(config, func, *args, **kwargs)
backend-1   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/config.py", line 617, in run_in_executor
backend-1   |     return await asyncio.get_running_loop().run_in_executor(
backend-1   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/concurrent/futures/thread.py", line 58, in run
backend-1   |     result = self.fn(*self.args, **self.kwargs)
backend-1   |              ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/config.py", line 608, in wrapper
backend-1   |     return func(*args, **kwargs)
backend-1   |            ^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/base.py", line 4939, in func
backend-1   |     return call_func_with_variable_args(
backend-1   |            ^^^^^^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain_core/runnables/config.py", line 429, in call_func_with_variable_args
backend-1   |     return func(input, **kwargs)  # type: ignore[call-arg]
backend-1   |            ^^^^^^^^^^^^^^^^^^^^^
backend-1   |   File "/usr/local/lib/python3.11/site-packages/langchain/chains/combine_documents/stuff.py", line 86, in format_docs
backend-1   |     for doc in inputs[document_variable_name]
backend-1   |                ~~~~~~^^^^^^^^^^^^^^^^^^^^^^^^
backend-1   | KeyError: 'context'
```

### 遇到的问题
- 容器无法访问主机端口
	-  `"host.docker.internal"` 是 _容器内_ 访问 _宿主机_ 的主机名（类似一个域名别名）。
	- `"host-gateway"` 是一个特殊关键字，从 Docker 20.10.0 开始支持，表示当前宿主机的默认网关 IP（即容器访问宿主机的真实网络路径）。
- 使用容器部署大模型性能很低，改为使用本机部署
### 4. 403 路由路径问题
一个有@router.post("/", response_model=ChatResponse) 一个没有“/”，没有的正常？
### 5.配置CI

```
main:

  push:

    - services:

        - docker

      stages:

        - name: docker login

          script: docker login -u ${CNB_TOKEN_USER_NAME} -p "${CNB_TOKEN}" ${CNB_DOCKER_REGISTRY}

        - name: docker build backend image

          script: docker build -t ${CNB_DOCKER_REGISTRY}/${CNB_REPO_SLUG_LOWERCASE}/backend:${CNB_COMMIT} ./backend

        - name: docker push backend image

          script: docker push ${CNB_DOCKER_REGISTRY}/${CNB_REPO_SLUG_LOWERCASE}/backend:${CNB_COMMIT}

        - name: docker build frontend image

          script: docker build -t ${CNB_DOCKER_REGISTRY}/${CNB_REPO_SLUG_LOWERCASE}/frontend:${CNB_COMMIT} ./frontend

        - name: docker push frontend image

          script: docker push ${CNB_DOCKER_REGISTRY}/${CNB_REPO_SLUG_LOWERCASE}/frontend:${CNB_COMMIT}
```