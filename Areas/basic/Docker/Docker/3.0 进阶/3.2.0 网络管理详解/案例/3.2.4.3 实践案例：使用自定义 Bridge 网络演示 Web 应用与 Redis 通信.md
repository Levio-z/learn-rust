  

这个案例展示了在实际应用中如何使用自定义 bridge 网络：

  

首先，创建一个简单的 Web 应用：

  

```shell

  

# 构建web-app镜像

docker build -t web-app web-app

```

  

然后创建网络并运行容器：

  

```shell

# 创建自定义 bridge 网络

docker network create my-bridge-network

  

# 启动 Redis 容器

docker run -d \

    --name redis-server \

    --network my-bridge-network \

    redis:alpine

  

# 启动 Web 应用容器

docker run -d \

    --name web-app \

    --network my-bridge-network \

    -p 5000:5000 \

    web-app

```

  

现在可以测试应用了：

  

```shell

# 访问应用

curl http://localhost:5000

  

# 多次访问，观察计数器增加

curl http://localhost:5000

curl http://localhost:5000

  

# 查看 Redis 中的数据

docker exec -it redis-server redis-cli get hits

```

  

清理环境：

  

```shell

# 删除用到 my-bridge-network 网络的容器

docker rm -f web-app redis-server

docker rm -f custom-container1

docker rm -f custom-container2

# 删除自定义网络

docker network rm my-bridge-network

# 删除镜像

docker rmi web-app redis:alpine

```

### 文件内容
web-app 文件夹
#### app.py
```
from flask import Flask

import redis

import socket

  

app = Flask(__name__)

redis_client = redis.Redis(host='redis-server', port=6379)

  

@app.route('/')

def hello():

    count = redis_client.incr('hits')

    hostname = socket.gethostname()

    return f'Hello! I have been seen {count} times.\nHostname: {hostname}\n'

  

if __name__ == "__main__":

    app.run(host="0.0.0.0", port=5000)
```
#### Dockerfile
```
FROM python:3.9-alpine

  

WORKDIR /app

COPY app.py requirements.txt ./

  

RUN pip install -r requirements.txt

  

EXPOSE 5000

CMD ["python", "app.py"]
```
#### requirements.txt
```
flask==2.0.1

werkzeug==2.0.1

redis==5.0.1
```