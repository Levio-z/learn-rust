---
tags:
  - permanent
---

## 1. 核心观点  
### Ⅰ. 概念层



### Ⅱ. 实现层



### Ⅲ. 原理层

## 2. 背景/出处  
- 来源：
- 引文/摘要：  
  - …  
  - …  

## 3. 展开说明  
### 什么是安全点（Safe Point）

安全点是指**程序执行到一个“上下文完整、状态一致、可安全暂停或切换”的位置**。  
在这个位置，运行时、调度器或 GC 可以确定：

- 栈帧结构完整
- 局部变量状态稳定
- 调用链没有被破坏
- 寄存器内容符合 ABI 要求
- 不会在半条指令或未完成的内存写入中断

因此，在安全点暂停任务、切换任务或执行 GC 是**绝对安全**的。
### 什么需要安全点

现代语言的运行时必须避免以下危险情况：

- 指令只执行了一半（处于中间状态）
    
- 栈指针处于半构造/半销毁状态
    
- 局部变量尚未写入内存
    
- ABI prologue/epilogue 未完成
    
- 内存复制、算术指令、中断敏感区刚开始未结束
    

如果在这些地方暂停，将导致：

- 栈损坏
    
- 寄存器非法
    
- 内存内容不一致
    
- 恢复执行时崩溃
    

**因此，暂停必须发生在“安全点”。**
### 协作式任务为什么天然处于安全点

因为协作式任务**只能**在你显式写 `yield()` 或 `await` 的地方暂停，而编译器/ABI 会保证：

- 到达 `yield/await` 之前所有指令都执行完毕
    
- 局部变量已经写入对应的内存槽位
    
- 调用栈的结构稳定且合法
    
- 所有可能破坏上下文的操作已结束
    
- 调用指令即将返回，此时寄存器布局符合 ABI
    

因此协作式切换点 **天然是 Safe Point**。

**这就是为什么协作式可以共享栈的本质原因。**




## 4. 与其他卡片的关联  
- 前置卡片：
- 后续卡片：
- 相似主题：

## 5. 应用/启发  
- 可以如何应用在工作、学习、生活中  
- 引发的思考与问题  

## 6. 待办/进一步探索  
 
  
