传输控制协议（TCP）旨在用作分组交换计算机通信网络中的主机之间以及这种网络的互连系统中的高度可靠的主机到主机协议。

本文件描述了传输控制协议执行的功能、实现该协议的程序及其与需要其服务的程序或用户的接口。

### 1.1 动机
计算机通信系统在军事、政府和民用环境中发挥着越来越重要的作用。本文件主要关注军事计算机通信要求，特别是通信不可靠时的鲁棒性和拥塞时的可用性，但这些问题中的许多问题也存在于民用和政府部门。

 随着战略和战术计算机通信网络的开发和部署，提供互连它们的方法和提供能够支持广泛应用的标准进程间通信协议是必不可少的。由于预期需要这样的标准，负责研究和工程的国防部副部长已经宣布这里描述的传输控制协议（TCP）是 DoD 范围内进程间通信协议标准化的基础。
 
 TCP 是一种**面向连接、端到端的可靠协议，它被设计成适合于支持多网络应用的分层协议体系。**
 TCP 提供附接到不同但互连的计算机通信网络的主机计算机中的进程对之间的可靠进程间通信。对于 TCP 层以下的通信协议的可靠性，几乎没有做任何假设。TCP 假定它可以从较低级别的协议获得简单的、可能不可靠的数据报服务。原则上，TCP 应该能够在从硬连线连接到分组交换或电路交换网络的广泛通信系统上操作。
 
TCP 基于 Cerf 和 Kahn 在[[1](https://www.rfc-editor.org/rfc/rfc793.html#ref-1 "\"A Protocol for Packet Network Intercommunication\"")]中首次描述的概念。TCP 适合于基本互联网协议之上的分层协议架构[[2](https://www.rfc-editor.org/rfc/rfc793.html#ref-2 "\"Internet Protocol - DARPA Internet Program Protocol Specification\"")]，该架构为 TCP 提供了一种**发送和接收封装在互联网数据报“信封”中的可变长度信息段的方法。**
互联网数据报提供了一种在不同网络中寻址源 TCP 和目的 TCP 的方法。互联网协议还处理通过多个网络和互连网关实现传输和交付所需的 TCP 段的任何碎片或重组。互联网协议还携带有关 TCP 段的优先级，安全分类和划分的信息，因此这些信息可以在多个网络中进行端到端通信。

  
                           Protocol Layering   协议分层  
  
                        +---------------------+
                        |     higher-level    |
                        +---------------------+
                        |        TCP          |
                        +---------------------+
                        |  internet protocol  |
                        +---------------------+
                        |communication network|
                        +---------------------+
 本文档的大部分内容是在 TCP 实现的上下文中编写的，TCP 实现与主机计算机中的更高级别协议共存。一些计算机系统将通过包含 TCP 和互联网协议层以及网络特定软件的前端计算机连接到网络。TCP 规范描述了到更高级别协议的接口，只要实现了合适的主机到前端协议，该接口即使对于前端情况也似乎是可实现的。
 
 应用程序进程和 TCP 之间的接口被合理地详细说明。该接口由一组调用组成，这与操作系统为操作文件而提供给应用程序进程的调用非常相似。例如，有打开和关闭连接以及在已建立的连接上发送和接收数据的调用。还期望 TCP 能够与应用程序异步通信。尽管允许 TCP 实现者有相当大的自由来设计适合于特定操作系统环境的接口，但是对于任何有效的实现，在 TCP/用户接口处需要最小的功能。
 
TCP 和较低层协议之间的接口本质上是未指定的，除了假设存在一种机制，由此两个层可以异步地相互传递信息。通常，人们期望较低级别的协议指定此接口。TCP 被设计为在互连网络的非常一般的环境中工作。在整个文档中假设的较低层协议是 Internet 协议[[2](https://www.rfc-editor.org/rfc/rfc793.html#ref-2 "\"Internet Protocol - DARPA Internet Program Protocol Specification\"")]。

### 操作
如上所述，TCP 的主要目的是在**成对的进程之间提供可靠的、安全的逻辑电路或连接服务**。在不太可靠的互联网通信系统上提供这项服务需要以下方面的设施：
- 基本数据传输
- 可靠性
- 流量控制
- 多路复用连接
- 优先级和安全性
 以下段落描述了 TCP 在每个领域的基本操作。
#### 基本数据传输

TCP 能够通过将一定数量的八位字节打包成段以用于通过因特网系统传输来在其用户之间的每个方向上传输连续的八位字节流。
- **定义与作用**：TCP 是面向连接的、可靠的字节流传输协议。它将用户数据分割成“段（segment）”，在网络中传输。
- **原理**：TCP 通过“分段”机制，把上层连续的字节流切割成适合网络传输的包（通常与网络最大传输单元 MTU 相关）。
- **注意**：TCP 传输的是字节流，没有消息边界的概念，确保数据完整有序到达。

一般来说，TCP 决定何时阻止和转发数据。
- **定义与作用**：TCP 拥有**流量控制**和**拥塞控制**机制，根据网络状况和接收方能力，决定数据何时发送或等待。
- **原理**：
    - **流量控制**通过滑动窗口，防止发送方淹没接收方。
    - **拥塞控制**如慢启动、拥塞避免，避免网络拥塞。
- **效果**：这保证了网络资源合理利用和端到端数据可靠交付。


有时用户需要确保他们提交给 TCP 的所有数据都已传输。为此，定义了一个 push标志位。为了确保提交给 TCP 的数据实际上被传输，发送用户指示它应该被推送到接收用户。推送使 TCP 迅速转发并将数据传递到接收方。
- **定义**：TCP 中的 PSH 标志位，用于告诉 TCP 层，“请尽快发送这部分数据，别再缓冲等待更多数据”。
- **作用**：触发 TCP 立即将数据段发送出去，不用等缓冲区满或定时器触发。
- **发送者视角**：用户调用带 PSH 的写操作，表示要“推送”数据。

确切的推送点可能对接收用户不可见，并且推送功能不提供记录边界标记。
- PSH 不是消息边界标志，接收方无法区分哪些字节是一次推送的。
- 接收方应用层依然看到的是字节流，没有明确的“推送边界”。


#### 可靠性
TCP 必须从互联网通信系统损坏、丢失、复制或乱序传输的数据中恢复。这是通过为**传输的每个八位字节分配一个序列号，并要求接收 TCP 提供肯定确认（ACK）来实现的**。
- 超时重传=>丢失：如果在超时间隔内未接收到 ACK，则重传数据。
- 序列号=>复制或乱序传输：在接收机处，序列号用于**正确地对可能乱序接收的段进行排序并消除重复**。
- 校验和=>损坏：损坏的处理方法是在发送的每个数据段上添加校验和，在接收端进行检查，然后丢弃损坏的数据段。
 只要 TCP 继续正常工作，并且互联网系统没有完全分区，就不会有传输错误影响数据的正确传输。TCP 从 Internet 通信系统错误中恢复。
#### 流量控制：
  TCP 为接收方提供了一种**控制发送方发送的数据量的方法**。这是通过返回一个“**窗口**”来实现的，其中每个 ACK 指示成功接收的最后一个段之外的可接受序列号的范围。该窗口指示发送方在接收到进一步许可之前可以发送的八位字节的允许数量。
##### 作用
- 避免接收方缓冲区溢出（Buffer Overflow）
- 保护接收方内存和处理资源
- 平稳高效地传输数据，而不是盲目推送导致重传或数据丢失

##### 原理与机制
核心在于：**窗口大小（Window Size）**。**接收方窗口（Receive Window，rwnd）**

- 每个 TCP 报文段的头部有一个 **Window 字段**（16 位）。
- 它告诉发送方：  
    “我还能接收多少字节的数据。”
##### 滑动窗口
滑动窗口是一种动态调整的范围，用来管理哪些数据是
- 已发送且已确认（左侧区域）
- 已发送但未确认（中间区域）
- 尚未发送（右侧区域）

随着 ACK 到来，窗口“滑动”：
- 窗口前沿前进 → 表示接收方有更多空间。
- 窗口缩小 → 表示接收方已满，必须等到处理完部分数据。

#####  **零窗口（Zero Window）**

如果接收方缓冲区已满，它会把窗口大小设置为 0，通知发送方：  
“暂时别发了，等我清理完再说。”

发送方此时进入**零窗口探测（Zero Window Probe）**，定期发送小探测包，检查接收方是否恢复可用。

# 参考资料
- https://www.rfc-editor.org/rfc/rfc793.html#section-3.3