---
tags:
  - note
---
## 1. 核心观点  
| **术语**           | **定义**                                         | **作用**                      |
| ---------------- | ---------------------------------------------- | --------------------------- |
| **套接字 (Socket)** | 操作系统提供的网络通信**端点（Endpoint）**的软件抽象。              | 应用程序与网络协议栈之间的**编程接口（API）**。 |
| **套接字地址**        | $(\text{协议}, \text{IP 地址}, \text{端口号})$ 的唯一组合。 | 唯一标识网络中的一个进程及其通信通道。         |
| **端口号 (Port)**   | $0$ 到 $65535$ 的数字。                             | 标识一台主机上的**特定应用程序进程**。       |

- domain 参数用来指定协议族，比如 AF_INET 用于 IPV4、AF_INET6 用于 IPV6、AF_LOCAL/AF_UNIX 用于本机；
- type 参数用来指定通信特性，比如 SOCK_STREAM 表示的是字节流，对应 TCP、SOCK_DGRAM 表示的是数据报，对应 UDP、SOCK_RAW 表示的是原始套接字；
- protocal 参数原本是用来指定通信协议的，但现在基本废弃。因为协议已经通过前面两个参数指定完成，protocol 目前一般写成 0 即可；

根据创建 socket 类型的不同，通信的方式也就不同：

- 实现 TCP 字节流通信： socket 类型是 AF_INET 和 SOCK_STREAM；
- 实现 UDP 数据报通信：socket 类型是 AF_INET 和 SOCK_DGRAM；
- 实现本地进程间通信： 「本地字节流 socket 」类型是 AF_LOCAL 和 SOCK_STREAM，「本地数据报 socket 」类型是 AF_LOCAL 和 SOCK_DGRAM。另外，AF_UNIX 和 AF_LOCAL 是等价的，所以 AF_UNIX 也属于本地 socket；

## 2. 展开说明  
### 套接字类型 (Socket Types)

|**类型**|**常规协议**|**特性**|**适用场景**|
|---|---|---|---|
|**流套接字** (`SOCK_STREAM`)|**TCP**|**可靠**、**有序**、**面向连接**、**字节流**。|Web (HTTP/HTTPS)、文件传输 (FTP)、邮件 (SMTP)。|
|**数据报套接字** (`SOCK_DGRAM`)|**UDP**|**不可靠**、**无序**、**无连接**、**基于报文**。|DNS 查询、实时音视频、网络管理 (SNMP)。|
|**原始套接字** (`SOCK_RAW`)|IP/ICMP/IGMP|允许直接访问 IP 层数据包。|网络诊断工具 (Ping, Traceroute)。|
服务器端编程流程 (TCP)

| **阶段**    | **关键 API 函数**       | **描述**                                                 |
| --------- | ------------------- | ------------------------------------------------------ |
| **1. 创建** | `socket()`          | 创建一个套接字文件描述符，指定地址族（如 $AF\_INET$）和类型（如 $SOCK\_STREAM$）。 |
| **2. 绑定** | `bind()`            | 将套接字与本地的 **IP 地址和端口号**绑定（给服务器套接字命名）。                   |
| **3. 监听** | `listen()`          | 将套接字标记为**被动模式**，开始监听传入的连接请求。设置连接队列大小。                  |
| **4. 接受** | `accept()`          | **阻塞**等待客户端连接。连接建立后，返回一个新的**已连接套接字**供通信使用。             |
| **5. 通信** | `send()` / `recv()` | 通过**已连接套接字**进行双向数据交换。                                  |
| **6. 关闭** | `close()`           | 关闭套接字连接，释放资源。                                          |
💻 客户端编程流程 (TCP)

| **阶段**    | **关键 API 函数**       | **描述**                       |
| --------- | ------------------- | ---------------------------- |
| **1. 创建** | `socket()`          | 创建一个套接字文件描述符。                |
| **2. 连接** | `connect()`         | 向指定服务器的 **IP 地址和端口号**发起连接请求。 |
| **3. 通信** | `send()` / `recv()` | 连接成功后，通过该套接字进行双向数据交换。        |
| **4. 关闭** | `close()`           | 关闭套接字连接。                     |
### 🚨 编程要点 (原子知识点)

1. **阻塞 vs. 非阻塞:** 默认情况下，`accept()`、`recv()` 和 `connect()` 是**阻塞**的。可以通过配置套接字选项或使用 `select/poll/epoll` 实现**非阻塞 I/O**。
    
2. **`send`/`recv` 的原子性:** 使用 `SOCK_STREAM` (TCP) 时，`send()` 和 `recv()` **不保证**一次调用就能处理完所有期望的字节数。它们可能只处理了一部分。程序员必须在循环中反复调用这些函数，直到所有数据发送/接收完毕。
    
3. **关闭连接:** 当 `recv()` 返回 $0$ 字节时，表示**对端已经关闭了连接**（收到 $FIN$ 包）。
    
4. **`SO_REUSEADDR`:** 重要的套接字选项。允许在服务器程序崩溃或关闭后，快速重启并重新绑定到同一个端口，避免 $TIME\_WAIT$ 状态的端口占用问题。
    
5. **多播 (Multicast):** 通常使用 **UDP** (`SOCK_DGRAM`) 实现。通过 `setsockopt` 选项（如 `IP_ADD_MEMBERSHIP`）来加入或退出多播组。

## 3. 与其他卡片的关联  
- 前置卡片：
- 后续卡片：
- 相似主题：

## 4. 背景/出处  
- 来源：
- 引文/摘要：  
  - …  
  - …  

## 5. 应用/启发  
- 可以如何应用在工作、学习、生活中  
- 引发的思考与问题  

## 6. 待办/进一步探索  
- [ ] 深入阅读 xxx  
- [ ] 验证这个观点的边界条件  
