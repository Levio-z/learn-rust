---
tags:
  - reference
---

在 Linux 系统中，管道的**最大可配置容量（Max Capacity）**受到一个系统级参数的限制。

这个限制主要通过内核参数进行控制：

### Linux 管道的最大可配置容量

1. **默认容量 (Default Capacity)**
    
    - 在现代 Linux 系统中，默认的管道容量通常是 **16 个系统页（pages）**，即 $\mathbf{65,536}$ 字节（$\mathbf{64 KB}$）（假设一个系统页大小为 4096 字节）。
        
2. **单个管道的最大容量限制**
    
    - 单个管道的最大容量由一个名为 `/proc/sys/fs/pipe-max-size` 的内核参数控制。
        
    - **默认值：** 该参数的默认值通常是 $\mathbf{1048576}$ 字节，即 $\mathbf{1 MB}$。
        
    - **可配置性：** **非特权用户**（Unprivileged user）可以使用 `fcntl(2)` 系统调用的 `F_SETPIPE_SZ` 操作来增加其创建的管道的容量，但不能超过 `/proc/sys/fs/pipe-max-size` 所设定的值。
        
    - **特权用户：** 拥有 `CAP_SYS_RESOURCE` 特权的进程（通常是 `root` 用户或具有相应能力的程序）可以**覆盖**这个限制，将单个管道的容量设置得更高，但仍受系统可用内存的限制。
        
3. **系统的绝对限制**
    
    - 尽管 `root` 用户可以设置超过 1MB 的容量，但实际上，系统通常会有一个**硬限制（Hard Limit）**。在早期 Linux 内核版本中，这个值是硬编码的，但现在，`/proc/sys/fs/pipe-max-size` 允许管理员对其进行配置。
        
    - **理论上，最大值可以非常大，但必须是系统页大小的整数倍，并且受到系统内存的严格限制。**
        

### 总结要点：

|**参数/限制**|**默认值 (以 4KB 页为基础)**|**调整方式**|**适用对象**|
|---|---|---|---|
|**单个管道的默认容量**|16 页 ($\approx 64 \text{ KB}$)|`fcntl(2)` 的 `F_SETPIPE_SZ`|所有用户创建的新管道|
|**单个管道的最大可设容量**|$\mathbf{1048576}$ 字节 ($\mathbf{1 \text{ MB}}$)|内核参数 `/proc/sys/fs/pipe-max-size`|非特权用户|

因此，对于大多数普通用户和应用来说，一个管道的最大容量限制在 $\mathbf{1 \text{ MB}}$。如果你需要更大的缓冲区，你需要使用特权（`root`）身份去修改 `/proc/sys/fs/pipe-max-size` 这个系统参数。