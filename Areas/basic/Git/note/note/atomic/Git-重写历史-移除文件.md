---
tags:
  - fleeting
---
## 1. 核心观点  
### Ⅰ. 概念层

### Ⅱ. 应用层
- 步骤
	- [检查版本与安装](Git-重写历史-移除文件.md#检查版本与安装)
	- [2. 标准操作命令](Git-重写历史-移除文件.md#2.%20标准操作命令)
	- [A. 远程仓库引用会被删除](#A.%20远程仓库引用会被删除)
	- [5. 后续清理](Git-重写历史-移除文件.md#5.%20后续清理)



### Ⅲ. 实现层

### **IV**.原理层


## 2. 背景/出处  
- 来源：
- 引文/摘要：  
  - …  
  - …  

## 3. 展开说明  


### 1. 核心工具介绍

**`git filter-repo`** 是官方推荐用于重写历史的工具，旨在替代陈旧且低效的 `git filter-branch` 和 `BFG Repo-Cleaner`。

#### 检查版本与安装
```
git-filter-repo --version
```

```
ipx install git-filter-repo
```

### 2. 标准操作命令

如果你需要删除历史提交中的某个具体文件（例如 `measurements.txt`），使用以下命令：

```
git filter-repo --path <文件路径> --invert-paths --force
```
- **`--path`**: 指定要处理的文件或目录。
- **`--invert-paths`**: 反转选择。配合 `--path` 使用时，表示“除了这个路径，保留其他所有内容”，即**删除**该路径。
- **`--force`**: 强制执行。`git filter-repo` 默认要求在全新的 `clone` 仓库中操作以防数据丢失，在现有仓库操作需加此参数。
    

### 3. 关键行为与风险提示

#### A. 远程仓库引用会被删除

执行后，Git 会自动删除名为 **`origin`** 的远程仓库链接。

- **原因**：重写历史后，本地的 Commit ID（Hash 值）会全部改变。为了防止你误操作直接 `push` 到原仓库导致历史错乱，工具强制要求你手动重新关联远程地址。
    
- **恢复方法**：
    
    Bash
    
    ```
    git remote add origin <远程仓库地址>
    ```
    

#### B. 协作冲击

- **破坏性操作**：该操作会改变所有受影响提交的 Hash 值。
    
- **同步成本**：如果其他团队成员已经拉取了旧代码，他们不能直接 `pull`，必须备份工作分支后重新 `clone` 或进行极其复杂的 `rebase`。
    

---

### 4. 操作流程图示

---

### 5. 后续清理

完成过滤后，为了彻底减小本地仓库体积，可以执行：

Bash

```
git gc --prune=now --aggressive
```

### 解释
彻底减小本地仓库体积，可以执行：
```
git gc --prune=now --aggressive
```
- **`prune` 的含义**：指删除那些**游离（unreachable）**的对象。这些对象没有被任何分支（branch）或标签（tag）指向。

- **默认机制**：为了防止误删，Git 默认只清理 **2 周以前** 的游离对象。
    
- **`=now` 的作用**：强制 Git 放弃等待期。它告诉 Git：“不需要等 14 天，**现在、立刻**把所有游离对象全部物理删除。”
    
- **后果**：执行后，你将无法通过 `reflog` 找回之前被删除或覆盖的提交。

#### `--aggressive` (积极/深度压缩)

这个参数决定了清理的**深度和强度**。

- **普通 `gc`**：只是简单地把对象打包，不做过多的运算。
    
- **`--aggressive` 的作用**：
    
    - **重新寻找增量（Delta）**：Git 会花更多的时间去重新扫描所有文件，计算它们之间的差异，尽可能以“增量”方式存储。
        
    - **优化窗口大小**：它会增加计算窗口（Window size），虽然非常消耗 CPU 和内存，但能显著减小 `.git` 文件夹的体积。
        
    - **适用场景**：在执行了 `git filter-repo` 或删除了仓库中巨大的二进制文件后，必须配合这个参数才能实现最大的“瘦身”效果。

最后，推送修改到远程（需要强推）：

Bash

```
git push origin --force --all
```

---

**需要我帮你写一个自动重新关联远程仓库并清理冗余数据的脚本吗？**

## 4. 与其他卡片的关联  
- 前置卡片：
- 后续卡片：
- 相似主题：

## 5. 应用/启发  
- 可以如何应用在工作、学习、生活中  
- 引发的思考与问题  

## 6. 待办/进一步探索  
 
  
