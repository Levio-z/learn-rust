
## ✅ `.gitignore` 语法规范详解

### 1\. `#` 开头为注释，空行被忽略

```gitignore
# 忽略所有日志文件
*.log

# 这是一条注释
```

-   **作用**：提高可读性，方便团队合作中解释规则。
    

---

### 2\. 支持标准的 **glob 模式**

Glob 是 shell 文件名匹配通配符的规则。

| 语法   | 说明                  | 示例                                   |
| ---- | ------------------- | ------------------------------------ |
| `*`  | 匹配任意字符（不含 `/`）      | `*.log` 匹配所有 `.log` 文件               |
| `?`  | 匹配一个任意字符（不含 `/`）    | `?.txt` 匹配 `a.txt` 但不匹配 `ab.txt`     |
| `[]` | 匹配指定字符中的一个          | `[abc].txt` 匹配 `a.txt`、`b.txt` 等     |
| `**` | 递归匹配目录（Git 2.0+ 支持） | `foo/**/bar` 匹配 foo 目录下任意深度的 bar 子目录 |

---

### 3\. 以 `/` 开头表示从 **项目根目录** 开始匹配，避免递归

```gitignore
/node_modules/   # 只忽略根目录下的 node_modules
```

-   **如果没有 `/` 前缀**，比如 `node_modules/`，会匹配任意路径下的 node\_modules。
    

```gitignore
node_modules/    # 忽略所有路径下的 node_modules 目录
```

---

### 4\. 以 `/` 结尾表示只匹配 **目录**

```gitignore
logs/           # 忽略 logs 目录，不忽略 logs.txt 文件
```

-   如果写 `logs` 而没有 `/`，则 logs 文件或目录都会被忽略。
    

---

### 5\. 使用 `!` 前缀取反，表示“不过滤该文件”

```gitignore
*.log           # 忽略所有 .log 文件
!important.log  # 但保留 important.log
```

-   取反有**前提条件**：前面必须已经有一条规则将文件排除了，`!` 才有“恢复”的效果。
    
-   想取反的文件必须**在之前已被忽略的范围之内**。
    

---

## 🛠️ 实用案例

### 案例 1：忽略编译产物、缓存、中间文件

```gitignore
# 编译中间文件
*.o
*.a
*.so

# 缓存目录
.cache/
build/
dist/

# 编辑器临时文件
*.swp
*~
```

---

### 案例 2：Node 项目常见 `.gitignore`

```gitignore
# 忽略 node_modules 和打包输出
/node_modules/
/dist

# 环境变量和日志
.env
*.log

# 忽略 vscode 编辑器配置
.vscode/
```

---

### 案例 3：只忽略某路径下的特定文件

```gitignore
# 忽略 lib/ 目录下所有 .txt 文件
/lib/*.txt

# 但保留 lib/keep.txt
!/lib/keep.txt
```

---

## 📜 源码层原理简述

-   Git 内部会根据 `.gitignore` 文件构建一个 ignore 匹配规则树（基于 `core/exclude.c` 模块），匹配时从 `.gitignore`、`.git/info/exclude`、`global excludes`（如 `~/.gitignore_global`）依次查找。
    
-   匹配规则由底层的 `fnmatch()`（类 POSIX） 实现 glob 匹配，结合 Git 自己的路径规范逻辑处理递归目录。
    