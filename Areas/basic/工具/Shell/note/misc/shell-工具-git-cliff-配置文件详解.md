---
tags:
  - misc
---
## 1. 核心观点  
### Ⅰ. 概念层

### Ⅱ. 应用层
- https://github.com/learn-rust-projects/template/blob/master/cliff.toml



### Ⅲ. 实现层

### **IV**.原理层


## 2. 背景/出处  
- 来源：
- 引文/摘要：  
  - …  
  - …  

## 3. 展开说明  

### git-cliff 配置文件中文翻译

#### `[changelog] — 更新日志配置`

- **header** — 更新日志头部
    
    ```toml
    header = """
    # 更新日志\n
    本项目的所有重要变更都会记录在此文件中。请参见 [conventional commits](https://www.conventionalcommits.org/) 获取提交规范指南。\n
    """
    ```
    
    说明：定义整个 changelog 文件开头内容，包括标题和说明。
    
- **body** — changelog 主体模板
    
    ```toml
    body = """
    ---
    {% if version %}\
        {% if previous.version %}\
            ## [{{ version | trim_start_matches(pat="v") }}]($REPO/compare/{{ previous.version }}..{{ version }}) - {{ timestamp | date(format="%Y-%m-%d") }}
        {% else %}\
            ## [{{ version | trim_start_matches(pat="v") }}] - {{ timestamp | date(format="%Y-%m-%d") }}
        {% endif %}\
    {% else %}\
        ## [未发布]
    {% endif %}\
    {% for group, commits in commits | group_by(attribute="group") %}
        ### {{ group | striptags | trim | upper_first }}
        {% for commit in commits
        | filter(attribute="scope")
        | sort(attribute="scope") %}
            - **({{commit.scope}})**{% if commit.breaking %} [**breaking**]{% endif %} \
                {{ commit.message|trim }} - ([{{ commit.id | truncate(length=7, end="") }}]($REPO/commit/{{ commit.id }})) - {{ commit.author.name }}
        {%- endfor -%}
        {% raw %}\n{% endraw %}\
        {%- for commit in commits %}
            {%- if commit.scope -%}
            {% else -%}
                - {% if commit.breaking %} [**breaking**]{% endif %}\
                    {{ commit.message|trim }} - ([{{ commit.id | truncate(length=7, end="") }}]($REPO/commit/{{ commit.id }})) - {{ commit.author.name }}
            {% endif -%}
        {% endfor -%}
    {% endfor %}\n
    """
    ```
    
    说明：定义每个版本的 changelog 内容，包括：
    - 版本号和发布时间
		- 判断是否有版本号 (`version`)：
	    - 如果有，生成 `## [版本号]` 标题
	        - 如果存在上一个版本 (`previous.version`)，则生成对比链接：
	            `[v1.2.0](compare/v1.1.0..v1.2.0)`
	        - 否则只显示版本号和日期：
	            `[v1.2.0] - 2026-01-20`
	- 如果没有版本号（即未发布的提交），显示：
		- `## [unreleased]`
    
    `## [unreleased]`
    - 按 group（类别）分组列出提交
		- `{% for group, commits in commits | group_by(attribute="group") %}     ### {{ group | striptags | trim | upper_first }}`
		- 将所有提交按 `group` 分类（如 Features、Bug Fixes、Documentation 等）
		- 生成二级标题：
		    `### Features ### Bug Fixes`
    - 显示 scope、breaking change 标记、提交消息、提交 ID、作者
	    - 遍历每个 group 内带 `scope` 的提交
		- 排序按 `scope`
		- 输出格式：
		    - 未指定 scope 的提交也会显示
		- ` **(scope)** [**breaking**] 提交信息 - ([commit_id](commit_url)) - 作者`
- **footer** — 更新日志尾部
    
    ```toml
    footer = """
    <!-- generated by git-cliff -->
    """
    ```
    说明：模板底部固定文本，可标记自动生成信息。
- **trim** — 去掉模板头尾空白
    
    ```toml
    trim = true
    ```
- **postprocessors** — 后处理规则
    ```toml
    postprocessors = [
        { pattern = '\$REPO', replace = "https://github.com/Levio-z/rcli" }, # 替换仓库 URL
    ]
    ```
    

---

#### `[git]` — Git 提交解析配置

- **conventional_commits** — 启用 Conventional Commits 解析
    
    ```toml
    conventional_commits = true
    ```
    - 具体行为：
    1. 自动识别提交类型（`feat`, `fix`, `chore`, `docs` 等）
    2. 自动检测 **破坏性变更**（`!` 或 `BREAKING CHANGE:`）
    3. 可以根据类型自动分组到 changelog 的 Features、Bug Fixes 等类别
- 如果设为 `false`：
    - git-cliff 就不会尝试解析提交类型
    - 所有提交只会按默认分组或你自定义的 `commit_parsers` 处理
    
- **filter_unconventional** — 是否过滤不符合规范的提交
    
    ```toml
    filter_unconventional = false
    ```
    
- **split_commits** — 是否按每行拆分 commit
    
    ```toml
    split_commits = false
    ```
  - **作用**：控制工具在生成 changelog 或解析 commit 信息时，是否把 **一条提交信息的多行内容** 当作多个独立 commit 来处理。
    
- **细节说明**：
    
    - `false`（默认）：
        
        - 整条 commit 信息作为一个整体处理。
            
        - 适合普通提交，保证描述完整。
            
    - `true`：
        
        - 会按每行拆分处理：
            
            `feat: 新增登录功能 - 支持邮箱登录 - 支持手机号登录`
            
            拆分后可能生成 changelog：
            
            `- feat: 新增登录功能 - 支持邮箱登录 - 支持手机号登录`
            
        - 适合 commit 写得非常详细，每行都想在 changelog 中显示为独立条目。
            
- **使用场景**：
    
    - `false` → 常规项目，保持 commit 描述完整
        
    - `true` → 想让 changelog 显示每行详细改动，便于用户阅读
- **commit_preprocessors** — 提交预处理规则（可替换文本或链接）
    
    ```toml
    commit_preprocessors = [
        # 可以处理 issue 链接等
    ]
    ```
- **作用**：在生成 changelog 或分析 commit 前，对 commit 消息做 **文本处理或替换**。
    
- **常见用途**：
    
    1. **替换 issue 链接**
        
        `commit_preprocessors = [   { pattern = "#(\\d+)", replace = "https://github.com/user/repo/issues/$1" } ]`
        
        - 把 `#123` 自动替换为完整 issue 链接。
            
    2. **清理多余标记**
        
        - 移除 `[skip ci]` 或不需要显示在 changelog 的标记。
            
    3. **统一格式**
        
        - 将 “bugfix” 替换为 “fix”，统一 commit type。
            
- **原理**：
    
    - 遍历每条 commit，依次应用预处理规则（正则替换或函数处理）。
        
    - 处理完成后再生成 changelog 或分类。
- **commit_parsers** — 提交解析规则
    
    ```toml
    commit_parsers = [
        { message = "\\[skip", skip = true },       # 跳过含 "[skip" 的提交
        { message = "\\p{Han}", skip = true },      # 跳过包含汉字的提交
        { message = "^feat", group = "Features" },  # 功能类
        { message = "^fix", group = "Bug Fixes" },  # Bug 修复
        { message = "^doc", group = "Documentation" }, # 文档
        { message = "^perf", group = "Performance" },  # 性能优化
        { message = "^refactor", group = "Refactoring" }, # 重构
        { message = "^style", group = "Style" },        # 风格调整
        { message = "^revert", group = "Revert" },      # 回退
        { message = "^test", group = "Tests" },         # 测试
        { message = "^chore\\(version\\):", skip = true }, # 跳过版本提交
        { message = "^chore", group = "Miscellaneous Chores" }, # 其他杂项
        { message = ".*", group = "Other" },            # 其他
        { body = ".*security", group = "Security" },    # 安全相关
    ]
    ```
- `skip = true` 表示这类提交不参与统计或分组。
- 正则说明：
    - `"\\[skip"`：匹配包含 `[skip ...]` 的提交信息（常用于自动跳过 CI/CHANGELOG）。
    - `"\\p{Han}"`：匹配包含 **汉字** 的提交信息（可能用于排除中文提交）。
    - `"^chore\\(version\\):"`：匹配版本更新的 chore 提交。

| **提交信息示例**                              | **说明**              |
| --------------------------------------- | ------------------- |
| `chore(version): 1.0.0`                 | **最标准**的用法，标记版本号更新。 |
| `chore(version): release v2.3.4-beta`   | 包含版本前缀和预发布标签。       |
| `chore(version): update to v1.5.0`      | 包含额外描述文字的匹配。        |
| `chore(version): bump version to 0.1.2` | 常用于自动触发的“版本提升”脚本。   |
|                                         |                     |
正则说明：

- `"^feat"`：以 `feat` 开头 → 功能新增。
    
- `"^fix"`：以 `fix` 开头 → Bug 修复。
    
- `"^doc"`：文档修改。
    
- `"^perf"`：性能优化。
    
- `"^refactor"`：代码重构。
    
- `"^style"`：代码风格、格式化。
    
- `"^revert"`：版本回退。
    
- `"^test"`：测试相关。
    
- `"^chore"`：其他杂项。
    
- `".*"`：兜底匹配，其他未分类提交归为 `Other`。
- **protect_breaking_commits** — 是否保护 breaking change 提交不被跳过
    
    ```toml
    protect_breaking_commits = false
    ```
#### 1. 配置作用

- **保护破坏性变更提交不被忽略**
    
- 具体来说：
    
    - 自动生成 changelog 或分析 commit 时，通常会有 **跳过规则（skipping commit parser）**，比如：
        
        - `[skip ci]`
            
        - `[skip changelog]`
            
        - 或匹配特定正则的提交信息
            
    - 如果某条 commit **同时被标记为破坏性变更**（`!` 或 `BREAKING CHANGE:`），启用 `protect_breaking_commits = true` 就会 **强制保留** 这条 commit，即使它本来符合跳过规则。
        

---

#### 2. 默认值解释

- `false`（默认）：
    
    - 破坏性变更提交 **仍然可能被跳过**，如果 commit 匹配跳过规则。
        
    - 可能导致生成的 changelog **漏掉重要破坏性更新**。
        
- `true`：
    
    - 即使 commit 符合跳过条件，也会 **强制包含到 changelog 或版本分析**。
- **filter_commits** — 是否过滤不匹配的提交
    
    ```toml
    filter_commits = false
    ```
- **控制是否过滤掉不匹配规则的 commit**
    
- 在自动生成 changelog 或分析提交时：
    
    - 工具通常会有 **解析规则（commit parser）**，只识别符合规范的 commit（如 `feat: xxx`、`fix: xxx`）
        
    - `filter_commits = true` → **只保留符合规则的 commit**
        
    - `filter_commits = false` → **保留所有 commit**，即使不符合规则，也会显示在 changelog 或版本分析中
- **tag_pattern** — 匹配 Git 标签
    
    ```toml
    tag_pattern = "v[0-9].*"
    ```
- **作用**：指定哪些 Git 标签会被工具识别并用于生成 changelog 或版本分析
    
- **正则解析**：
    
    - `v[0-9].*`
        
        - `v` → 标签前缀（常用语义化版本前缀，例如 `v1.0.0`）
            
        - `[0-9]` → 标签的主版本号至少一个数字
            
        - `.*` → 后续任意字符（允许 1.0.0、1.2.3-beta 等变体）
            
- **使用场景**：
    
    - 只匹配符合语义化版本规则的标签，忽略其他非版本标签
        
    - 例如：
        
        `v1.0.0  ✅ 匹配 v2.3.4-beta  ✅ 匹配 release-2026  ❌ 不匹配`
- **skip_tags** — 跳过的标签
    
    ```toml
    skip_tags = "v0.1.0-beta.1"
    ```
  - **作用**：即使某些标签符合 `tag_pattern`，也会被忽略
    
- **使用场景**：
    
    - 跳过 alpha / beta / 测试版本
        
    - 防止生成 changelog 或版本分析时包含临时或不稳定版本
        
- **举例**：
    
    `Git 标签列表： v0.1.0-beta.1  ❌ 跳过 v0.1.0         ✅ 生成 changelog v1.0.0         ✅ 生成 changelog`
    
- **原理**：
    
    - 工具先按 `tag_pattern` 筛选所有标签
        
    - 再检查 `skip_tags` 列表，匹配则跳过不处理
- **ignore_tags** — 忽略的标签
    
    ```toml
    ignore_tags = ""
    ```
- **作用**：与 `skip_tags` 类似，用于在生成 changelog 时完全 **忽略指定标签**
    
- **区别**：
    
    - `skip_tags` 是在匹配 `tag_pattern` 后再排除
        
    - `ignore_tags` 可以直接指定任意标签，不受 `tag_pattern` 限制
        
- **示例**：
    
    `ignore_tags = "v0.1.0,v0.2.0-beta"`
    
    - 生成 changelog 时，`v0.1.0` 和 `v0.2.0-beta` 标签对应的 commit 都会被跳过
- **topo_order** — 是否按拓扑排序标签
    
    ```toml
    topo_order = false
    ```
  - **作用**：控制生成 changelog 时标签的顺序
    
- **解释**：
    
    - `false` → 按时间顺序或字典顺序显示标签
        
    - `true` → 按 Git **拓扑顺序**排序（考虑分支、合并关系）
        
        - 对于多分支开发，拓扑顺序更能体现 commit 的先后依赖关系
            
- **示例**：
    
    - `false`：
        
        `v1.0.0 v1.1.0 v2.0.0`
        
    - `true`（拓扑顺序）：
        
        `v1.0.0 v2.0.0  # 可能先合并了 v1.1.0 的分支 v1.1.0`
- **sort_commits** — commit 内排序方式（oldest = 旧到新）
    
    ```toml
    sort_commits = "oldest"
    ```
- **作用**：控制同一类别下的 commit 在 changelog 中显示顺序
    
- **可选值**：
    
    - `"oldest"` → 按 commit 时间由早到晚
        
    - `"newest"` → 按 commit 时间由晚到早
        
- **示例**：
    
    `## Features - feat: 新增用户注册 - feat: 新增用户登录`
    
    - `"oldest"` → 先注册后登录
        
    - `"newest"` → 先登录后注册
- **limit_commits** — 限制 changelog 中的提交数
    
    ```toml
    # limit_commits = 42
    ```
 - **作用**：生成 changelog 时，限制最大 commit 数量
    
- **使用场景**：
    
    - changelog 太长时，保留最近 N 条提交
        
    - 适合发布日志简化展示
        
- **注意**：
    
    - 默认未启用（注释状态） → 包含全部 commit
        
    - 可以与 `sort_commits` 搭配使用，只保留最新或最旧的 N 条

---

### 总结与学习方法论

1. **核心价值点**：
    
    - `commit_parsers` 决定了 changelog 分类和可读性
        
    - `body` 模板定义了输出样式，掌握 Tera 模板语法很关键
        
    - `postprocessors` 可以实现仓库特定链接自动化
        
2. **学习方法**：
    
    - 阅读 git-cliff 官方文档，重点理解 `commit_parsers` 与 Tera 模板
        
    - 尝试在测试仓库生成不同格式的 changelog，观察效果
        
    - 练习写自定义 postprocessors 和模板
        
3. **习题**：
    
    - 修改配置，将 `fix` 分为 `Critical Bug` 和 `Minor Bug`
        
    - 为 `Security` 类提交生成专门标记 `[SECURITY]`
        
    - 实现 changelog 中每个 commit 旁增加 PR 链接
        
4. **重点关注**：
    
    - Conventional Commits 与 commit_parsers 的配合
        
    - 模板语法中对 version、scope、breaking 的处理
        
    - postprocessors 实现自动化 URL 替换
        

这套配置能实现自动生成结构化、规范化、带超链接的更新日志，掌握后可极大提升项目文档质量和维护效率。
## 4. 与其他卡片的关联  
- 前置卡片：
- 后续卡片：
- 相似主题：

## 5. 应用/启发  
- 可以如何应用在工作、学习、生活中  
- 引发的思考与问题  

## 6. 待办/进一步探索  
 
  
