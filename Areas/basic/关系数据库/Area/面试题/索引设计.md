---
tags:
  - note
---
# 索引设计面试题
## 题目
已知订单有三种属性：订单ID、订单日期（精确到天）、订单完成状态（完成、未完成）。请设计出表示订单的数据库表，为其指定主键，并为以下查询建立索引： 
1. 查找某一ID的订单内容； 
2. 查找近一周的所有订单；)
3. 查找所有未完成的订单；  
4. 查找近一个月内所有已完成的订单。

## 回答
### 表定义
```rust
CREATE TABLE orders (
    order_id BIGINT PRIMARY KEY,               -- 唯一标识订单
    order_date DATE NOT NULL,                  -- 订单日期，精确到天
    order_status ENUM('完成', '未完成') NOT NULL,  -- 订单状态
    INDEX idx_order_date (order_date),         -- 按日期查询
    INDEX idx_status (order_status)            -- 按状态查询
);
```

1. 查找某一ID的订单内容； 
	- id本身就是效率最高的聚簇索引
2. 查找近一周的所有订单；  
	- 为日期创建索引，[索引的原理](../note/索引的原理.md)
3. 查找所有未完成的订单；  
	- 不需要，为什么
		- [某个字段取值不均匀的时候，普通索引失效](../note/某个字段取值不均匀的时候，普通索引失效.md)
4. 查找近一个月内所有已完成的订单。
	- 因为先按日期过滤，再按状态筛选。，CREATE INDEX idx_date_status ON orders(order_date, order_status);
	- 查询可走联合索引范围扫描（如果索引就是要查询的数据，可以避免回表）

