# 第 28 章 形式化建模与验证总结

## 一、核心概念与整体定位

形式化建模与验证主要围绕**净室软件工程**和**形式化方法**展开，二者具有以下共性与定位：

  

1. **共性要求**：均需采用专门的规格说明方法，且各自对应独特的验证手段，流程严谨性高。
2. **应用现状**：在软件工程领域的普及度较低，未被广泛采用。
3. **核心目标**：用于开发 “无缺陷（bullet-proof）软件”，确保软件具备极高的可靠性与正确性。

## 二、净室策略（28.1）

净室策略采用**增量式开发模式**，每个增量（Increment #1 至 Increment #n）均遵循统一的标准化流程，核心环节及作用如下：

  

|环节|核心内容|
|---|---|
|增量规划|确立增量式开发思路，明确各增量的范围与目标|
|需求收集|定义每个增量对应的用户级需求描述|
|盒式结构规格说明|对软件的功能规格进行详细描述，为后续设计奠定基础|
|形式化设计|将 “黑盒” 形式的规格说明逐步细化为 “状态盒”（对应架构设计）和 “清晰盒”（对应过程设计）|
|正确性验证|从最高层级的盒式结构（规格说明）入手，逐步向设计细节与代码层推进；先通过 “正确性问题” 验证，若无法证明规格正确性，则采用更严谨的数学方法|
|代码生成、审查与验证|将专用语言表示的盒式结构规格说明转换为对应编程语言的代码，并开展代码审查与验证|
|统计测试规划|设计一套测试用例集，覆盖软件 “使用概率分布” 场景|
|统计使用测试|从目标用户群体的所有可能程序执行场景中，基于统计抽样（即前述概率分布）执行一系列测试|
|认证|完成验证、审查与使用测试且修正所有错误后，认证该增量可用于集成|

## 三、功能规格说明（28.2）

以 “盒式结构” 为核心，通过不同类型的 “盒” 描述软件功能，核心要素包括：

  

1. **三类核心盒结构**：
    - **黑盒（black box）**：聚焦输入（S）与输出（R）的映射关系（函数 f：S*→R），不关注内部逻辑。
    - **状态盒（state box）**：在黑盒基础上增加 “状态（T）” 维度，通过函数 g 关联输入、状态与输出，体现状态对功能的影响。
    - **清晰盒（clear box）**：进一步细化内部逻辑，明确实现功能的具体操作步骤（如 g11、g12、g13 等子函数及条件 c）。
2. **核心要素**：输入集（S）、输出集（R）、状态（T）及函数映射关系（f、g 等），共同构成功能规格的基础框架。

## 四、净室设计（28.3）

### 1. 设计细化规则

针对函数的不同细化方式，明确对应的正确性验证条件：

  

- **序列细化**：若函数 f 拆分为序列 g 和 h，需验证 “g 执行后再执行 h 是否等同于执行 f”（对所有输入均成立）。
- **条件细化（if-then-else）**：若 f 细化为条件逻辑，需验证 “条件<c>为真时，g 是否等同于 f；条件<c>为假时，h 是否等同于 f”。
- **循环细化**：若 f 细化为循环逻辑，需验证两个条件：①循环是否保证终止；②条件<c>为真时，“g 执行后再执行 f 是否等同于 f”，且<c>为假时，“跳过循环是否仍等同于 f”。

### 2. 设计验证优势

- 将验证转化为有限过程，可操作性强；
- 支持净室团队验证每一行设计与代码；
- 能实现接近零缺陷的效果；
- 具备良好的可扩展性；
- 产出的代码质量优于单元测试的结果。

## 五、净室测试（28.4）

### 1. 统计使用测试

- **核心逻辑**：基于软件的实际使用场景开展测试，关键是确定 “使用概率分布”。
- **实施步骤**：①分析规格说明，识别触发软件行为变化的 “刺激因素”；②创建使用场景；③为每个刺激因素分配使用概率；④根据使用概率分布为每个刺激因素生成测试用例并执行。

### 2. 认证流程与模型

#### （1）基础认证步骤

- 构建使用场景→明确使用剖面→基于剖面生成测试用例→执行测试并记录、分析故障数据→计算可靠性并完成认证。

#### （2）三类核心认证模型

- **抽样模型**：执行 m 个随机测试用例，若未出现故障或故障数符合指定标准，则通过认证；m 的取值通过数学计算确定，以确保达到所需可靠性。
- **组件模型**：针对由 n 个组件构成的系统，分析每个组件（i）在完成任务前发生故障的概率，为系统认证提供组件层面依据。
- **认证模型**：预测并认证系统的整体可靠性。

## 六、形式化方法（28.5-28.6）

### 1. 定义与价值

- **定义**：基于数学的系统属性描述技术，提供系统化（非随机）的系统规格说明、开发与验证框架（引用自《软件工程百科全书》[Mar01]）。
- **解决的问题**：弥补传统规格说明的缺陷，包括矛盾性、歧义性、模糊性、不完整性及抽象层级混乱。

### 2. 形式化规格说明

- **核心目标**：实现规格说明的一致性、完整性与无歧义性。
- **关键优势**：
    - 规格说明语言的形式化语法确保需求 / 设计仅有一种解释，消除自然语言或图形符号的歧义；
    - 集合论与逻辑符号的描述能力可清晰表述需求事实；
    - 通过数学证明（利用推理规则将初始事实映射到后续陈述）确保规格说明的一致性。

### 3. 核心概念

|概念|定义|
|---|---|
|数据不变式|包含数据集的系统在整个执行过程中始终成立的条件|
|状态|不同形式化语言定义略有差异：OCL（附录 3）将其定义为 “系统可处于的、外部可观察的行为模式”；Z 语言（附录 3）将其定义为 “系统访问和修改的存储数据”|
|操作|系统中发生的、对状态数据进行读或写的动作，包含两个关键条件：  <br>- 前置条件：某一操作合法执行的前提条件  <br>- 后置条件：操作完成后产生的结果或状态变化|