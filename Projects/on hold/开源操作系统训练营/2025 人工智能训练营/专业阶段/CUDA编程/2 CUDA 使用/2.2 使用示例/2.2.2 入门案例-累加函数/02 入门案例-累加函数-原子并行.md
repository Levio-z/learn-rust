sum_gpu_01_atomic_add.cu
### 测试
数据大小：const size_t SIZE = 1 << 20; // 元素总数 half个数
```
nvcc sum_gpu/sum_gpu_01_atomic_add.cu -o target/sum_gpu_01_atomic_add

nsys profile -t cuda,nvtx,osrt -o target/sum_gpu_01_atomic_add -f true target/sum_gpu_01_atomic_add

nsys stats target/sum_gpu_01_atomic_add.nsys-rep

./target/sum_gpu_01_atomic_add

```

结果：
```
Kernel execution time: 2 ms
GPU result (via warp reduce): 524286
CPU result (for verification): 524282
```

```
 ** CUDA API Summary (cuda_api_sum):

 Time (%)  Total Time (ns)  Num Calls   Avg (ns)     Med (ns)    Min (ns)  Max (ns)   StdDev (ns)           Name         
 --------  ---------------  ---------  -----------  -----------  --------  ---------  -----------  ----------------------
     97.5        252283413          2  126141706.5  126141706.5    455312  251828101  177747403.7  cudaMalloc            
      1.1          2726623          1    2726623.0    2726623.0   2726623    2726623          0.0  cuLibraryLoadData     
      0.9          2327738          3     775912.7     890833.0     75165    1361740     650940.7  cudaMemcpy            
      0.3           817298          2     408649.0     408649.0    349760     467538      83281.6  cudaFree              
      0.3           722146          1     722146.0     722146.0    722146     722146          0.0  cudaLaunchKernel      
      0.0             1110          1       1110.0       1110.0      1110       1110          0.0  cuModuleGetLoadingMode
      0.0              870          1        870.0        870.0       870        870          0.0  cuLibraryGetKernel    
      0.0              583          1        583.0        583.0       583        583          0.0  cuKernelGetName       
```

### 观察
![](../../../asserts/Pasted%20image%2020250813111711.png)
◆ 将原来的加法换成原子累加操作 
◆ atomicAdd(): CUDA 支持的原子累加操作
◆ 答案对了！但… 
◆ 运行时间增加了很多，比原来在这个情况下慢了两百多倍！
疑问：为什么慢？ 

◆ 看看 ncu
![](asserts/Pasted%20image%2020250820082905.png)
◆ 计算与内存吞吐/利用率都低到离谱…
◆ 很多线程都在闲置 → 原子操作导致线程之间完全串行！
→ 回第一节课 → 看起来在并行但其实并没有在并行！
- 浮点数 **加法不满足交换律和结合律**，即 `(a+b)+c != a+(b+c)` 在计算机浮点数上可能成立。