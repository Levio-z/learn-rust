
## ğŸ” ä»£ç å›é¡¾

```cpp
#include <iostream>

struct S
{
    S() : m{42} {}
    S(int a) : m{a} {}
    int m;
};

int main()
{
    S s;
    // 1ï¸âƒ£ S{} æ˜¯ prvalueï¼Œç”¨äºèµ‹å€¼
    s = S{};
    std::cout << s.m << '\n';

    // 2ï¸âƒ£ S{} = S{7} è¡¨è¾¾å¼ä¹Ÿåˆæ³•
    std::cout << (S{} = S{7}).m << '\n';
}
```

---

# âœ³ï¸ ç¬¬ä¸€æ­¥ï¼šåŸºæœ¬è¯­ä¹‰åˆ†æ

### âœ… `S s;`

-   åˆ›å»ºå¯¹è±¡ `s`ï¼Œè°ƒç”¨é»˜è®¤æ„é€ å‡½æ•° â†’ `s.m = 42`ã€‚
    

### âœ… `s = S{};`

-   è¡¨è¾¾å¼ `S{}` æ˜¯ä¸€ä¸ª **prvalueï¼ˆçº¯å³å€¼ï¼‰**ï¼Œä¸´æ—¶æ„é€ äº†ä¸€ä¸ª `S` å¯¹è±¡ï¼ˆé»˜è®¤æ„é€ ï¼Œ`m = 42`ï¼‰
-   å®ƒä½œä¸ºèµ‹å€¼å³è¾¹ï¼Œæ˜¯åˆæ³•çš„ã€‚
-   `s = S{}` è°ƒç”¨ `S` çš„ **èµ‹å€¼è¿ç®—ç¬¦**ï¼ˆéšå¼ç”Ÿæˆï¼‰ï¼Œå°†ä¸´æ—¶å¯¹è±¡çš„å€¼èµ‹ç»™ `s`
-   æ‰€ä»¥ `s.m == 42`

---

## â“å…³é”®ç‚¹ï¼š`(S{} = S{7}).m` ä¸ºä½•åˆæ³•ï¼Ÿ

è¿™æ˜¯ç¬¬äºŒå¥ä»£ç çš„ç²¾åï¼š

```cpp
std::cout << (S{} = S{7}).m << '\n';
```

---

### ğŸ”§ è¡¨è¾¾å¼æ‹†è§£

-   `S{}` åˆ›å»ºä¸€ä¸ª **ä¸´æ—¶å¯¹è±¡ï¼ˆprvalueï¼‰**
    
-   `S{7}` åˆ›å»ºå¦ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼Œ`m == 7`
    
-   ç„¶åæ‰§è¡Œ `operator=`ï¼šå°† `S{7}` çš„å€¼èµ‹ç»™ `S{}`
    

### â—ç–‘é—®ï¼šS{} æ˜¯ä¸€ä¸ªä¸´æ—¶å€¼ï¼ˆprvalueï¼‰ï¼Œæˆ‘ä»¬å±…ç„¶èƒ½å¯¹å®ƒèµ‹å€¼ï¼Ÿ

è¿™åœ¨ **C++17** ä¹‹å‰æ˜¯éæ³•çš„ï¼ä½†åœ¨ **C++17 ä¹‹åæ˜¯åˆæ³•çš„**ï¼Œå› ä¸ºï¼š

---

## ğŸš€ C++17 çš„é‡å¤§æ”¹å˜ï¼š**prvalue çš„å…·ä½“åŒ–ï¼ˆtemporary materializationï¼‰è¯­ä¹‰å¢å¼º**

åœ¨ C++17 ä¸­ï¼Œæ‰€æœ‰ **class ç±»å‹çš„ prvalue** è¡¨è¾¾å¼ä¼š**è‡ªåŠ¨å…·ä½“åŒ–ä¸ºä¸€ä¸ªä¸´æ—¶å¯¹è±¡**ï¼Œä»è€Œï¼š

-   æ‹¥æœ‰å¯¹è±¡èº«ä»½ï¼ˆåœ°å€ï¼‰
-   å¯ä»¥ä½œä¸ºèµ‹å€¼è¡¨è¾¾å¼çš„å·¦å€¼ï¼

âœ… å› æ­¤ï¼š

```cpp
(S{} = S{7}).m
```

æ˜¯å®Œå…¨åˆæ³•çš„è¡¨è¾¾å¼ã€‚

---

## âš™ï¸ æ­¥éª¤è§£æï¼ˆC++17+ è¯­ä¹‰ï¼‰

1.  `S{}` â†’ prvalue â†’ è‡ªåŠ¨\*\*ç‰©åŒ–ï¼ˆmaterializeï¼‰\*\*ä¸ºä¸´æ—¶å¯¹è±¡ï¼ˆæ‹¥æœ‰åœ°å€ï¼‰
    
2.  `S{7}` â†’ prvalue â†’ åˆå§‹åŒ–å¦ä¸€ä¸ªä¸´æ—¶å¯¹è±¡ï¼Œå…¶ `m = 7`
    
3.  è°ƒç”¨ä¸´æ—¶å¯¹è±¡çš„èµ‹å€¼è¿ç®—ç¬¦ï¼š
    
    ```cpp
    temp1.operator=(temp2);
    ```
    
4.  è¿”å› `temp1`ï¼ˆèµ‹å€¼ç»“æœï¼‰ï¼Œè®¿é—® `.m`ï¼Œè¾“å‡ºå€¼ 7
    

---

## ğŸ’¡ ä¸ºä»€ä¹ˆèƒ½â€œå·¦å€¼åŒ–â€ä¸€ä¸ª prvalueï¼Ÿ

å› ä¸º **class ç±»å‹çš„ prvalue**ï¼Œåœ¨æŸäº›ä¸Šä¸‹æ–‡ä¸‹ä¼šè‡ªåŠ¨ materialize æˆå¯¹è±¡ã€‚è¿™äº›ä¸Šä¸‹æ–‡åŒ…æ‹¬ï¼š

-   æˆä¸ºèµ‹å€¼è¡¨è¾¾å¼çš„å·¦å€¼
-   ç»‘å®šåˆ°å¼•ç”¨
-   è®¿é—®å…¶æˆå‘˜ï¼ˆå¦‚ `.m`ï¼‰
    

> ç®€è¨€ä¹‹ï¼š**åªè¦ä½ â€œæƒ³ç”¨ prvalue åƒå¯¹è±¡ä¸€æ ·â€ï¼ŒC++17 å°±ä¼šè®©å®ƒâ€œä¸´æ—¶å˜æˆå¯¹è±¡â€ç»™ä½ ç”¨ï¼**

---

## ğŸ”š è¾“å‡ºç»“æœåˆ†æ

```cpp
s = S{};
std::cout << s.m << '\n';          // è¾“å‡º 42
std::cout << (S{} = S{7}).m << '\n'; // è¾“å‡º 7
```

---

## ğŸ§  æ€»ç»“æ ¸å¿ƒç‚¹

| è¡Œä¸º | åœ¨ C++17 ä¹‹å‰ | åœ¨ C++17 åŠä¹‹å |
| --- | --- | --- |
| `prvalue = ...` ä¸´æ—¶å¯¹è±¡èµ‹å€¼ | âŒ éæ³• | âœ… åˆæ³• |
| prvalue å¯è®¿é—®æˆå‘˜ã€å¯å–åœ°å€ç­‰ | âŒ é™åˆ¶ | âœ… è‡ªåŠ¨ materialize |
| `S{} = S{7}` æ˜¯åˆæ³•è¡¨è¾¾å¼ | âŒ ç¼–è¯‘é”™è¯¯ | âœ… åˆæ³•ä¸´æ—¶å¯¹è±¡èµ‹å€¼ |

---

## ğŸ“ å»¶ä¼¸é˜…è¯»å»ºè®®

å¦‚æœä½ å¯¹è¿™ä¸ªå˜åŒ–æ„Ÿå…´è¶£ï¼Œå¯æ·±å…¥äº†è§£ï¼š

-   C++17 temporary materialization rules
    
-   C++17 æ ‡å‡†è‰æ¡ˆä¸­çš„ prvalue â†’ xvalue è½¬æ¢ä¼˜åŒ–é€»è¾‘ï¼ˆP0135R1 proposalï¼‰
    

---