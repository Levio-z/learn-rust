```cpp
#include <type_traits>
#include <utility>
Â 
template <class T> struct is_prvalue : [std::true_type](https://en.cppreference.com/w/cpp/types/integral_constant.html) {};
template <class T> struct is_prvalue<T&> : [std::false_type](https://en.cppreference.com/w/cpp/types/integral_constant.html) {};
template <class T> struct is_prvalue<T&&> : [std::false_type](https://en.cppreference.com/w/cpp/types/integral_constant.html) {};
Â 
template <class T> struct is_lvalue : [std::false_type](https://en.cppreference.com/w/cpp/types/integral_constant.html) {};
template <class T> struct is_lvalue<T&> : [std::true_type](https://en.cppreference.com/w/cpp/types/integral_constant.html) {};
template <class T> struct is_lvalue<T&&> : [std::false_type](https://en.cppreference.com/w/cpp/types/integral_constant.html) {};
Â 
template <class T> struct is_xvalue : [std::false_type](https://en.cppreference.com/w/cpp/types/integral_constant.html) {};
template <class T> struct is_xvalue<T&> : [std::false_type](https://en.cppreference.com/w/cpp/types/integral_constant.html) {};
template <class T> struct is_xvalue<T&&> : [std::true_type](https://en.cppreference.com/w/cpp/types/integral_constant.html) {};
Â 
int main()
{
    int a{42};
    int& b{a};
    int&& r{std::move(a)};
Â 
    // Expression `42` is prvalue
    static_assert(is_prvalue<decltype((42))>::value);
Â 
    // Expression `a` is lvalue
    static_assert(is_lvalue<decltype((a))>::value);
Â 
    // Expression `b` is lvalue
    static_assert(is_lvalue<decltype((b))>::value);
Â 
    // Expression `std::move(a)` is xvalue
    static_assert(is_xvalue<decltype((std::move(a)))>::value);
Â 
    // Type of variable `r` is rvalue reference
    static_assert([std::is_rvalue_reference](https://en.cppreference.com/w/cpp/types/is_rvalue_reference.html)<decltype(r)>::value);
Â 
    // Type of variable `b` is lvalue reference
    static_assert([std::is_lvalue_reference](https://en.cppreference.com/w/cpp/types/is_lvalue_reference.html)<decltype(b)>::value);
Â 
    // Expression `r` is lvalue
    static_assert(is_lvalue<decltype((r))>::value);
```

è¿™æ®µä»£ç ç”¨äº**åŒºåˆ†ç±»çš„å€¼ç±»åˆ«ï¼ˆvalue categoriesï¼‰**ï¼Œæ˜¯æ·±å…¥ç†è§£ C++ è¡¨è¾¾å¼ä¸ç±»å‹ç³»ç»Ÿçš„é‡è¦èŒƒä¾‹ã€‚æˆ‘ä»¬ä»å¤šä¸ªç»´åº¦è¯¦ç»†è§£é‡Šè¿™æ®µä»£ç çš„å®šä¹‰ã€åŸç†ã€ä½¿ç”¨åœºæ™¯ä¸æ‰©å±•ç†è§£ã€‚

---

## âœ… ä¸€ã€å€¼ç±»åˆ«åŸºç¡€

åœ¨ C++ ä¸­ï¼Œä¸€ä¸ª\*\*è¡¨è¾¾å¼ï¼ˆexpressionï¼‰**çš„**å€¼ç±»åˆ«ï¼ˆvalue categoryï¼‰\*\*æœ‰ä»¥ä¸‹ä¸‰ç§ä¸»è¦åˆ†ç±»ï¼š

| å€¼ç±»åˆ«         | å«ä¹‰                              | ç¤ºä¾‹             |
| ----------- | ------------------------------- | -------------- |
| **lvalue**  | æœ‰åå­—ã€å¯å¯»å€ã€å¯æŒç»­å­˜åœ¨çš„å¯¹è±¡                | `a`, `b`, `r`  |
| **xvalue**  | eXpiring valueï¼ˆå³å°†è¿‡æœŸçš„å€¼ï¼‰ï¼Œæœ‰èµ„æºä½†å¯è¢«ç§»åŠ¨ | `std::move(a)` |
| **prvalue** | pure rvalueï¼Œçº¯å³å€¼ï¼Œä¸ç»‘å®šå†…å­˜ï¼Œä¸´æ—¶å€¼       | `42`, `a + b`  |


è¿™äº›åˆ†ç±»å½±å“å‡½æ•°é‡è½½é€‰æ‹©ã€æ¨¡æ¿æ¨å¯¼ã€ç§»åŠ¨è¯­ä¹‰ä¸å®Œç¾è½¬å‘ç­‰è¡Œä¸ºã€‚

---

## âœ… äºŒã€ä»£ç è®²è§£

### 1\. å€¼ç±»åˆ«è¾…åŠ©æ¨¡æ¿

```cpp
template <class T> struct is_prvalue : std::true_type {};
template <class T> struct is_prvalue<T&> : std::false_type {};
template <class T> struct is_prvalue<T&&> : std::false_type {};
```

-   **æ„å›¾**ï¼šåˆ¤æ–­ä¸€ä¸ªè¡¨è¾¾å¼çš„ç±»å‹æ˜¯å¦æ˜¯ prvalueã€‚
    
-   **åŸç†**ï¼š
    -   é»˜è®¤ï¼šè®¤ä¸º `T` æ˜¯ prvalueï¼ˆçœŸï¼‰ã€‚
    -   ç‰¹åŒ–ç‰ˆæœ¬ï¼š
        -   `T&` è¡¨ç¤ºæ˜¯å·¦å€¼å¼•ç”¨ï¼Œå¿…ä¸æ˜¯ prvalueã€‚
        -   `T&&` æ˜¯å³å€¼å¼•ç”¨ï¼ˆæ³¨æ„ï¼šæ˜¯ç±»å‹å±‚é¢çš„å³å€¼å¼•ç”¨ï¼Œå¹¶ä¸ç­‰ä»·äºè¡¨è¾¾å¼æ˜¯ prvalueï¼ï¼‰

âš ï¸ æ³¨æ„ï¼š`decltype((expr))` æ˜¯**è¡¨è¾¾å¼ç±»åˆ«æ¨å¯¼**ï¼ŒåŠ ä¸Š `()` å–å€¼è¡¨è¾¾å¼å½¢å¼ï¼Œç”¨äºç²¾ç¡®è·å–**è¡¨è¾¾å¼çš„å€¼ç±»åˆ«æ¨å¯¼ç±»å‹**ã€‚

---

### 2\. è¡¨è¾¾å¼åˆ†æ

```cpp
int a{42};
int& b{a};
int&& r{std::move(a)};
```

å«ä¹‰å¦‚ä¸‹ï¼š

| å˜é‡å            | ç±»å‹             | å€¼ç±»åˆ«è¡¨è¾¾å¼å½¢å¼                   | æ¨å¯¼ç»“æœ         |
| -------------- | -------------- | -------------------------- | ------------ |
| `a`            | `int`          | `decltype((a))`            | lvalue       |
| `b`            | `int&`         | `decltype((b))`            | lvalue       |
| `r`            | `int&&`        | `decltype((r))`            | lvalueï¼ˆå…·åå˜é‡ï¼‰ |
| `std::move(a)` | `int&&`        | `decltype((std::move(a)))` | xvalue       |
| `42`           | `int`ï¼ˆliteralï¼‰ | `decltype((42))`           | prvalue      |

```cpp
static_assert(is_prvalue<decltype((42))>::value);
```

-   `42` æ˜¯å­—é¢å€¼å¸¸é‡ï¼Œå±äº **prvalue**ï¼Œæ–­è¨€æˆç«‹ã€‚
    

```cpp
static_assert(is_lvalue<decltype((a))>::value);
static_assert(is_lvalue<decltype((b))>::value);
```

-   `a` å’Œ `b` éƒ½æ˜¯å…·åå˜é‡ï¼Œæ˜¯ **lvalue**ã€‚
    

```cpp
static_assert(is_xvalue<decltype((std::move(a)))>::value);
```

-   `std::move(a)` æ˜¯ä¸ª**xvalue**ï¼Œå…·å¤‡å¯ç§»åŠ¨è¯­ä¹‰ï¼Œæ–­è¨€æˆç«‹ã€‚
    

```cpp
static_assert(std::is_rvalue_reference<decltype(r)>::value);
```

-   å˜é‡ `r` ç±»å‹æ˜¯ `int&&`ï¼Œç¡®å®æ˜¯å³å€¼å¼•ç”¨ç±»å‹ã€‚

```cpp
static_assert(is_lvalue<decltype((r))>::value);
```

âš ï¸**æ³¨æ„**ï¼šè™½ç„¶ `r` çš„ç±»å‹æ˜¯ `int&&`ï¼Œä½†è¡¨è¾¾å¼ `r` æ˜¯ **lvalue**ï¼Œå› ä¸ºå®ƒæ˜¯å…·åå˜é‡ã€‚å€¼ç±»åˆ«å’Œå˜é‡ç±»å‹ä¸åŒï¼š

> **å…·åå˜é‡å§‹ç»ˆæ˜¯ lvalue è¡¨è¾¾å¼**ï¼Œæ— è®ºå…¶å£°æ˜ç±»å‹æ˜¯å¦ä¸º `T&&`ã€‚

---

## âœ… ä¸‰ã€ä¸ºä»€ä¹ˆåŒºåˆ†è¿™äº›å€¼ç±»åˆ«é‡è¦ï¼Ÿ

### ğŸ“Œ 1. å®Œç¾è½¬å‘ï¼ˆstd::forwardï¼‰

```cpp
template<typename T>
void wrapper(T&& arg) {
    target(std::forward<T>(arg)); // ä¿ç•™å€¼ç±»åˆ«
}
```

å¦‚æœä¸æ­£ç¡®åŒºåˆ† `T&`ã€`T&&`ï¼Œå¯èƒ½ä¼šé”™è¯¯è½¬å‘å¯¼è‡´æ€§èƒ½æˆ–è¯­ä¹‰é—®é¢˜ã€‚

---

### ğŸ“Œ 2. ç§»åŠ¨è¯­ä¹‰ä¸é‡è½½å†³ç­–

```cpp
void set_value(const std::string& s); // lvalue
void set_value(std::string&& s);      // xvalue
```

è°ƒç”¨ `set_value(std::move(s))` æ—¶ï¼ŒåŒ¹é…çš„æ˜¯ `&&` ç‰ˆæœ¬ï¼Œå¿…é¡»å€ŸåŠ©å€¼ç±»åˆ«æ¨å¯¼ã€‚

---

### ğŸ“Œ 3. ç±»å‹æ¨å¯¼ä¸æ¨¡æ¿å…ƒç¼–ç¨‹

åœ¨ `decltype((expr))` æ¨å¯¼çš„ç»“æœä¸Šå†è¿›è¡Œ `is_lvalue_reference`ã€`is_rvalue_reference` ç­‰ç±»å‹èƒå–ï¼Œæ˜¯ç²¾ç¡®å®šåˆ¶æ¨¡æ¿é€»è¾‘çš„å¸¸è§åšæ³•ã€‚

---

## âœ… å››ã€è¡¥å……æ‰©å±•çŸ¥è¯†ç‚¹

### âœ… `decltype(expr)` vs `decltype((expr))`

| è¡¨è¾¾å¼å½¢å¼ | è¯´æ˜ |
| --- | --- |
| `decltype(expr)` | ä¸åŠ æ‹¬å·ï¼šè·å–å˜é‡çš„**å£°æ˜ç±»å‹** |
| `decltype((expr))` | åŠ æ‹¬å·ï¼šè·å–è¡¨è¾¾å¼çš„**å€¼ç±»åˆ«ç±»å‹** |

ä¾‹å¦‚ï¼š

```cpp
int x = 1;
decltype(x)       => int
decltype((x))     => int&   // lvalue expression!
```

### âœ… `std::is_lvalue_reference<T>` æ˜¯ç±»å‹åˆ¤æ–­ï¼Œéè¡¨è¾¾å¼åˆ¤æ–­ã€‚

è€Œ `is_lvalue<T>`ï¼ˆè‡ªå®šä¹‰ï¼‰ç”¨äºåŸºäºè¡¨è¾¾å¼çš„å€¼ç±»åˆ«åˆ¤æ–­ã€‚

---

## âœ… æ€»ç»“

| æ£€æŸ¥é¡¹ | ç”¨äº |
| --- | --- |
| `std::is_lvalue_reference<T>` | åˆ¤æ–­ç±»å‹æ˜¯å¦æ˜¯ `T&` |
| `std::is_rvalue_reference<T>` | åˆ¤æ–­ç±»å‹æ˜¯å¦æ˜¯ `T&&` |
| è‡ªå®šä¹‰ `is_lvalue<T>` | åˆ¤æ–­è¡¨è¾¾å¼å€¼ç±»åˆ«æ˜¯å¦ä¸º lvalue |
| è‡ªå®šä¹‰ `is_xvalue<T>` | åˆ¤æ–­è¡¨è¾¾å¼æ˜¯å¦æ˜¯ xvalue |
| è‡ªå®šä¹‰ `is_prvalue<T>` | åˆ¤æ–­è¡¨è¾¾å¼æ˜¯å¦æ˜¯ prvalue |
| `decltype((expr))` | è·å–è¡¨è¾¾å¼å€¼ç±»åˆ«æ¨å¯¼ç±»å‹ |