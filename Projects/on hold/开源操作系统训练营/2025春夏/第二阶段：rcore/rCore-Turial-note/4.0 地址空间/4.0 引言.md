### 基本解释
#### 物理内存是有限资源
计算机的物理内存（RAM）是操作系统管理的核心资源之一，因为它有限，不能无限制地给每个程序使用。
#### 操作系统的作用
操作系统（OS）需要负责分配和管理内存，让多个程序可以同时运行，确保每个程序有它需要的内存，同时防止不同程序互相干扰。
#### 应用的视角
在大多数应用（也就是应用开发者）的视角中，它们会独占一整个 CPU 和特定（连续或不连续）的内存空间，可以得到想要的任意多内存。
#### 操作系统的视角
每个应用被局限在分配给它的物理内存空间中运行，无法读写其它应用和操作系统所在的内存空间。
#### 理想目标
文中提到的“让程序随时得到想要的任意多内存”其实是一种抽象的理想目标。在现实中，物理内存有限，操作系统通常通过 **虚拟内存机制** 来实现这一目标：
- 每个程序看到的是一个 **独立的连续内存空间**（虚拟地址空间），感觉像是拥有无限内存。
- 操作系统在后台把这些虚拟地址映射到有限的物理内存面置换、swap 等或者磁盘（通过页技术）。
#### 为了实现目标引入以下机制

| **目标**              | **对应机制**         | **实现效果**                                                                |
| ------------------- | ---------------- | ----------------------------------------------------------------------- |
| 方便-简化程序开发、提供连续地址空间  | **虚拟内存 + 页表映射**  | 程序可以使**用连续的虚拟地址**，编译器无需关心物理内存布局，虚拟地址空间可以超过物理内存容量，缺页时操作系统从磁盘加载页，实现“无限”感知 |
| 安全-保证应用程序间及应用与内核间安全 | **虚拟内存隔离（页表映射）** | 每个**进程独立虚拟地址空间**，防止非法访问或越界，增强系统安全                                       |
| 高效-提高物理内存动态使用效率     | **动态内存分配**       | 应用程序**无需预先分配全部内存，按需申请**，减少内存浪费，提高利用率                                    |
| 高效-提高内存利用率（理论）      | **空分复用（提出但未实现）** | 虚拟地址空间**允许多个程序共享相同物理页**，提高潜在利用率                                         |
#### 当前现状直接访问物理内存
- 在内存访问方面，所有的应用都直接通过物理地址访问物理内存，这使得应用开发者需要了解繁琐的物理地址空间布局，访问内存也很不方便。在上一章中，出于任务切换的需要，所有的应用都在初始化阶段被加载到内存中并同时驻留下去直到它们全部运行结束。而且，所有的应用都直接通过物理地址访问物理内存。
##### 直接访问会带来以下问题
- 不方便：
	- 首先，**内核提供给应用的内存访问接口不够透明**，也不好用。由于应用直接访问物理内存，这需要它在构建的时候就清楚所运行计算机的物理内存空间布局，还需规划自己需要被加载到哪个地址运行。为了避免冲突可能还需要应用的开发者们对此进行协商，这显然是一件在今天看来不够通用且极端麻烦的事情。
- 不安全
	- 其次，**内核并没有对应用的访存行为进行任何保护措施**，每个应用都有计算机系统中整个物理内存的读写权力。即使应用被限制在 U 特权级下运行，它还是能够造成很多麻烦：比如它可以读写其他应用的数据来窃取信息或者破坏其它应用的正常运行；甚至它还可以修改内核的代码段来替换掉原本的 `trap_handler` 函数，来挟持内核执行恶意代码。总之，这造成系统既不安全、也不稳定。
- 不高效
	- 再次，目前应用的内存使用空间在其运行前已经限定死了，内核不能灵活地给应用程序提供的运行时动态可用内存空间。比如一个应用结束后，这个应用所占的空间就被释放了，但这块空间无法动态地给其它还在运行的应用使用。

