#### 一、工欲善其事必先利其器

00:05
##### 1. template项目内容介绍01:20

###### 1）安装Rust
02:08
- 安装方法：使用命令curl -proto '=https' -tlsv1.2 -sSf https://sh.rustup.rs | sh进行安装
- 版本选择：安装时会询问安装版本，建议选择普通版本或全量版本（根据个人需求）
- 安装过程：rustup会下载并设置Rust工具链，包括编译器(cargo)和包管理器
###### 2）安装VSCode插件
02:42
- 推荐插件：
    - crates：用于Rust依赖管理
    - Even Better TOML：提供TOML文件支持
    - Better Comments：优化注释显示效果
    - Error Lens：增强错误提示功能
    - GitLens：Git版本控制增强
    - Github Copilot：AI代码提示（付费但高效）
    - indent-rainbow：缩进可视化
    - Prettier-Code formatter：代码格式化
    - REST client：REST API调试工具
    - Rust Test lens：Rust测试支持
    - Rust Test Explorer：测试概览面板
    - TODO Highlight：TODO标记高亮
    - vscode-icons：文件图标优化
    - YAML：YAML文件支持
- 安装方法：在VSCode扩展市场中搜索并安装
- 注意事项：Github Copilot是付费工具，但能显著提高编码效率；若无资源可使用基础版本

###### 3）安装cargo generate
04:40
- 功能：项目模板生成工具，可使用GitHub仓库作为模板
- 安装命令：cargo install cargo-generate
- 课程用途：**将使用tyr-rust-bootcamp/template模板生成项目代码**
- 工作原理：下载源代码并在本地编译，生成二进制文件到特定目录
- ![](https://thumbnail0.baidupcs.com/thumbnail/b75dbba84r0d1f6b956fee3480d8d2f3?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586350527271486651&expires=8h&fid=4118282674-250528-419032397485305&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-AHoHNN4daPRKRelwkpnEKfm83MA%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- 使用方法：指定模板项目地址即可生成新项目
- 项目结构：包含标准Rust项目文件和配置，如Cargo.toml、src目录等
- ![](https://thumbnail0.baidupcs.com/thumbnail/885613c39k9f053b1ed8b62b8b83c148?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586350644845750818&expires=8h&fid=4118282674-250528-81437543753797&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-ibIdni5U92hdbzx0caLFoe9Fcf8%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- 开源项目：GitHub仓库地址为cargo-generate/cargo-generate
- 项目状态：活跃维护的开源项目，支持多种模板功能

###### 4）安装pre-commit

06:29
- 基本概念
    - 定义: pre-commit是一个代码检查工具，可以在提交代码前进行代码检查。
    - 作用: 通过自动化检查避免将低级错误提交到代码库，提高代码质量。
    - 配置文件: 使用.pre-commit-config.yaml文件进行配置。
- 安装方法
    - pip安装:
        - 命令: pip install pre-commit
        - 特点: 全局安装
    - pipx安装:
        - 命令: pipx install pre-commit
        - 特点: 隔离环境安装，避免全局污染
    - 其他方式:
        - Mac用户可使用homebrew安装
        - Conda用户可使用conda install -c conda-forge pre-commit
- 配置说明
    - 基本结构:
    - Rust相关钩子:
        - cargo-fmt: 代码格式化
        - cargo-deny: 依赖安全检查
        - typos: 拼写检查
        - cargo-check: 基础编译检查
        - cargo-clippy: 代码lint检查
        - cargo-test: 单元测试
- 使用流程
    - 初始化:
        - 运行**pre-commit install**安装git钩子
        - 钩子会自动安装在.git/hooks/pre-commit
    - 首次检查:
        - 建议运行pre-commit run --all-files对所有文件进行检查
    - 后续使用:
        - 每次git commit时自动运行检查
        - 只检查被修改的文件
- 高级功能
    - 多语言支持:
        - 支持Python、Perl、R、Ruby等多种语言
        - 每种语言有特定的安装和执行方式
    - 环境隔离:
        - 自动创建隔离环境运行钩子
        - 不会污染系统环境
    - 缓存机制:
        - 安装的钩子会被缓存
        - 后续运行会重用缓存提高速度
- 注意事项
    - 版本控制:
        - 建议将.pre-commit-config.yaml加入版本控制
        - 团队共享相同配置
    - 性能影响:
        - 复杂的检查可能增加提交时间
        - 可通过exclude配置排除不需要检查的文件
    - 错误处理:
        - fail_fast选项控制是否在第一个错误时停止
        - 建议开发阶段设为false，查看所有问题

###### 5）安装Cargo deny
09:10
- 功能：用于检查Rust依赖安全性的Cargo插件
- 应用场景：
    - 生产环境/商业项目中检查依赖授权协议
    - 扫描供应链中的已知安全问题
- 典型问题：
    - 检测GPL v3等"传染性"协议依赖（使用此类依赖会导致商业代码必须开源）
    - 识别存在安全漏洞的依赖版本
- 安装命令：
```
﻿cargo install --locked cargo-deny
﻿cargo install cargo-deny --version 0.13.1
﻿
```
###### 6）安装git cliff



10:57

- 核心功能：自动化生成符合规范的CHANGELOG.md文件
- 实用价值：
    - 帮助使用者快速了解各版本变更内容
    - 遵循conventional commits规范
- 典型输出：
- 安装命令：
```
cargo install git-cliff
```
###### 7）其他工具

- typos-cli
    - 功能：代码中的英文拼写检查工具
    - 特点：
        - 自动识别常见拼写错误
        - 提供纠正建议
    - 安装命令：
    
- cargo-nextest
    - 定位：Rust增强测试工具集
    - 优势：
        - 提供更高效的测试运行机制
        - 增强测试报告功能

###### 8）安装cargo nextest

﻿

11:48

﻿

- 工具特点：cargo nextest是Rust的增强测试工具，相比标准cargo test具有更好的性能和输出格式
- 安装方式：通过cargo install cargo-nextest命令安装
- 使用场景：适合需要更详细测试报告或对测试性能有要求的Rust项目

###### 9）应用案例

﻿

13:11

﻿![](asserts/Pasted%20image%2020251113211422.png)

- 例题:代码示例走查
    - 题目解析
        - 错误类型：代码中使用了未定义的变量p，导致编译失败
        - 检查流程：
            - pre-commit会依次执行代码格式检查(cargo fmt)
            - 软件供应链检查(cargo deny)
            - 拼写检查(typos)
            - 静态代码检查(cargo check)
        - 错误定位：检查输出明确显示error[E0425]: cannot find value p in this scope
        - 工具优势：pre-commit可以在代码提交前自动发现这类基础错误，避免将错误代码提交到版本库
        - pre-commit安装：
            - 需要运行pre-commit install命令
            - 会在.git/hooks目录下生成pre-commit钩子
            - 具体实现细节可以不用关心，只需知道其作用机制
        - 检查内容：
            - 文件编码检查(fix-byte-order-marker)
            - 大小写冲突检查
            - 合并冲突检查
            - YAML语法检查
            - 文件尾行检查
            - 混合换行符检查
            - 尾部空格检查
            - Rust代码格式化检查

###### 10）Cargo.toml介绍
14:27
- Cargo.toml文件概述﻿14:33﻿
    - 项目描述文件：是整个Rust项目的核心配置文件，包含项目元数据和依赖信息
    - 文件位置：位于项目根目录下，通过cargo new命令自动生成
    - 主要功能：描述项目名称、版本、edition、依赖等关键信息
- Rust Edition概念﻿15:12﻿
    - 设计目的：保持Rust 1.0版本的向后兼容性，同时允许引入新语法特性
    - 版本周期：每三年发布一个新edition（如2024年底将发布新edition）
    - 兼容性特点：
        - 2015 edition允许使用async作为变量名
        - 2018 edition开始将其作为保留关键字
    - 升级影响：通常edition升级不会导致严重编译问题，可能会有少量警告
- 依赖管理﻿16:37﻿
    - 依赖声明：在`[dependencies]`部分添加，如anyhow = "1"表示错误处理库
    - 工具支持：
        - 插件可显示依赖最新版本
        - 可直接跳转到依赖文档页面
    - 版本查看：鼠标悬停可查看当前最新版本及更新历史
- 项目构建与输出﻿17:41﻿
    - 构建命令：
        - cargo build：生成debug版本
        - cargo build --release：生成优化版本
    - 输出位置：
        - 默认在项目target目录下
        - 可通过~/.cargo/config修改target-dir配置全局输出路径
    - 二进制大小：
        - 空项目debug版本约403KB
        - release版本约401KB（包含标准库）
- Git与Cargo配置﻿21:00﻿
    - gitignore：指定Git忽略的文件/目录
    - cliff.toml：
        - 用于生成规范的changelog
        - **TODO：需要修改$REPO替换为实际项目地址**
        - 支持基于conventional commits的提交解析
    - typos.toml：配置拼写检查的排除规则
- License配置﻿22:39﻿
    - 常见许可类型：
        - MIT/Apache-2.0：商业友好许可
        - BSD-2/3-Clause：宽松开源许可
        - MPL-2.0：弱copyleft许可
        - CC0-1.0：公共领域许可
    - 配置方式：在deny.toml中**通过allow列表指定允许的许可证**
    - 添加新许可：当遇到未授权的许可证时，可将其SPDX标识符添加到allow列表

###### 11）应用案例
24:23
- 例题:rustcli项目搭建
    - 项目初始化
        - 工具选择: 使用cargo generate工具生成项目模板，该工具可以从GitHub仓库获取模板
        - 模板来源: 使用tyr-rust-bootcamp/template作为基础模板
        - 项目创建: 执行命令cargo generate tyr-rust-bootcamp/template创建名为rcli的项目
	        - https://github.com/Levio-z/template.git
    - 项目结构
        - ![](https://thumbnail0.baidupcs.com/thumbnail/be10a8f13peb93e7b422e69b64c43ec4?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586348112303702009&expires=8h&fid=4118282674-250528-917002477154789&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-pl17s9qruy1FXq1P84qAdnU5Hhw%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
        - 核心文件: 包含README.md、main.rs、Cargo.toml等标准Rust项目文件
        - 配置文件: 包含pre-commit、cliff.toml、deny.toml等配置文件
        - 许可文件: 项目默认包含多种开源许可证选项(MIT、Apache-2.0等)
    - 开发环境配置
        - ![](https://thumbnail0.baidupcs.com/thumbnail/5cd119b71o55a46c3fc053e04cfbb2b2?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586348254589938844&expires=8h&fid=4118282674-250528-174376679582059&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-MRTMULFU6Z52PXRvXkuNvi4HAk0%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
        - 信任设置: 打开新项目时VSCode会询问是否信任项目作者，对于可信来源应选择信任
        - 初始提交: 项目创建后应立即进行初始提交，包含所有生成的文件
    - 远程仓库创建
        - 仓库命名: 按照规范命名为01-rcli
        - 仓库设置: 选择Public可见性，添加README文件描述项目
        - 语言选择: 明确标记为Rust项目
    - 代码推送
        - ![](https://thumbnail0.baidupcs.com/thumbnail/80923b926n9cd25a24337de1848cc2fc?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586348372176125368&expires=8h&fid=4118282674-250528-174148482292327&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-%2Fr6hY9%2BAnfc1FICrMe9rYaa%2F4UM%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
        - 远程添加: 使用git remote add origin命令添加远程仓库
        - 分支推送: 执行git push -u origin master将本地代码推送到远程
        - 推送验证: 推送完成后可在GitHub上查看完整的项目结构和代码
    - 开发工具推荐﻿26:30﻿
        - ![](https://thumbnail0.baidupcs.com/thumbnail/46dab5106g9bd0ceeb6028925d994cb4?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586350890800915086&expires=8h&fid=4118282674-250528-457735814541463&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-U6sQJfRz4RBSkG%2F7bXTALRnzrfg%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
        - 核心插件:
            - crates: Rust包管理
            - Even Better TOML: TOML文件支持
            - Error Lens: 错误提示优化
        - 辅助工具:
            - GitLens: Git增强
            - GitHub Copilot: 代码提示
            - Better Comments: 注释显示优化

###### 12）修改README.md

- 项目初始化修改
    - ![](https://thumbnail0.baidupcs.com/thumbnail/08fd2c086pd4125da252d4b9d4f45f0c?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586348489143168910&expires=8h&fid=4118282674-250528-206450950810135&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-fUPK6nztDlG5itKvGkKjqX6GOo4%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
    - 文件清理：创建项目后需要清理默认README.md文件内容，将其重命名为"rI"（小写i）
    - 初始内容：保留最基本的项目描述，如"the rust ci two"作为初始内容
    - 本地环境差异：本地安装了gramley工具导致的错误提示可以忽略，不影响项目构建
- 代码修改与提交
    - 基础修改：在main.rs中添加简单的println!("Hello, rust!");语句
    - 提交准备：修改完成后需要执行git commit操作
    - 提交信息：建议使用"first commit"等描述性信息作为首次提交的commit message
- 代码检查流程
    - ![](https://thumbnail0.baidupcs.com/thumbnail/75dcdb91cpdd81a510dc8936c304e7d2?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586349108617444304&expires=8h&fid=4118282674-250528-526184266385910&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-agmXfobZWwjcGUn%2BaU%2F8wk2oS6c%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
    - 自动检查项：
        - 合并冲突检查：Passed
        - 符号链接检查：Skipped（无文件需要检查）
        - YAML格式检查：Skipped（无文件需要检查）
        - 文件结尾修复：Passed
        - 混合行尾检查：Passed
        - 尾部空格修剪：Passed
        - Rust格式化检查：cargo fmt Passed
        - 依赖安全检查：cargo deny check Passed
        - 拼写检查：typos Passed
        - 基础编译检查：cargo check Passed
        - 代码质量检查：cargo clippy Passed
        - 单元测试检查：cargo test Passed
    - 提交结果：成功提交后显示2个文件变更，3处插入，83处删除
- 代码推送与CI触发
    - ![](https://thumbnail0.baidupcs.com/thumbnail/f1113ed9duf9c326d7a8024e8e8f4d49?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586349282101324626&expires=8h&fid=4118282674-250528-922309668693645&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-Oi1YyS0SgkZlDz9mxkOqYsXDuhc%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
    - 推送触发：git push操作会自动触发CI工作流
    - 工作流配置：
        - 名称：build
        - 触发条件：push到master分支或创建pull_request时
        - 分支过滤：包含master和v*标签的分支
    - 推送结果：显示5个对象被推送，总计590字节，压缩后delta为1

##### 2. workflows介绍

﻿

28:07

﻿

###### 1）GitHub Action概述

﻿

28:19

﻿

- ![](https://thumbnail0.baidupcs.com/thumbnail/11de1c905j423026dc9b27834f7cd664?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586349673788435255&expires=8h&fid=4118282674-250528-601780900763246&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-5J6Y9YsNUWAG6BvfxlQRjTyGX%2B0%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- 定义: 位于项目.github/workflows/build.yml路径下的CI工具
- 触发时机: 当代码提交到GitHub中央仓库时自动执行
- 核心功能: 执行代码质量检查、测试和发布流程自动化

###### 2）GitHub Action的功能

﻿

28:31

﻿

- 平台兼容性检查: 默认检查Ubuntu最新版环境，支持通过matrix扩展Windows等其他平台
- 依赖管理: 使用rust-cache缓存依赖项，显著减少重复编译时间
- 质量门禁: 包含代码格式化检查、静态分析和测试覆盖率检查

###### 3）检查的平台与步骤

﻿

28:46

﻿

- ![](https://thumbnail0.baidupcs.com/thumbnail/246b387b3od7f43a059128e320bbb0d0?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586348599283596029&expires=8h&fid=4118282674-250528-918328888388306&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-mZUcVUof03tvTpFc0PFfnGpidAc%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- 平台配置: 通过matrix.platform定义测试环境，当前仅配置ubuntu-latest
- 关键步骤序列:
    - 代码检出(actions/checkout@v4)
    - Rust工具链安装(rustup toolchain install)
    - 测试工具安装(cargo-llvm-cov和nextest)
    - 依赖缓存(Swatinem/rust-cache@v2)

###### 4）代码检查与测试

﻿

30:17

﻿

- ![](https://thumbnail0.baidupcs.com/thumbnail/5435fee1aqc0090eddd57cac60c0ae24?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586350998387136025&expires=8h&fid=4118282674-250528-3596303835118&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-SUzJl4vY7mhakmupx2Qh9RaSR7s%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- 格式化检查: 执行cargo fmt --check验证代码风格
- 静态分析:
    - 基础检查：cargo check --all
    - 严格检查：cargo clippy --all-targets --all-features --tests --benches -D warnings
- 测试执行: 使用cargo nextest run --all-features运行全量测试
- 错误处理: 任一检查步骤失败将终止整个workflow执行

###### 5）生成Change Log与Release

﻿

31:33

﻿

- ![](https://thumbnail0.baidupcs.com/thumbnail/1249818d8od8d0bf86ae7cf2dcc5939f?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586351104560720338&expires=8h&fid=4118282674-250528-998225353547288&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-I0yqRPXbkNHhiEMXaUN1H2Xv%2BDw%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- 版本发布流程:
    - 创建git tag触发workflow(git tag -a v0.1.2)
    - 自动生成CHANGELOG.md(git-cliff-action)
    - 创建GitHub Release并包含变更日志
- 配置要点:
    - 使用conventional commits规范提交信息
    - 通过cliff.toml自定义changelog模板
    - Release内容自动填充变更历史

##### 3. 总结

﻿

32:38

﻿

- ![](https://thumbnail0.baidupcs.com/thumbnail/ae0003326r64f864d6c7c4cf3e292653?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586351441112183829&expires=8h&fid=4118282674-250528-716931003852160&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-Oh7q6yt59J9syLrTdNRL5DrxIVA%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- 工程化价值: 首个commit即建立完整的CI/CD流水线
- 质量保障:
    - 覆盖代码风格、静态检查、测试验证全流程
    - 严格的warning处理机制(-D warnings)
- 扩展性设计:
    - 矩阵测试支持多平台扩展
    - 预置覆盖率检查等扩展点
- 最佳实践: 符合"工欲善其事，必先利其器"的工程理念

#### 二、让成为你的下一Rust编程大作

﻿

35:13

﻿

##### 1. Git配置与提交流程

- ![](https://thumbnail0.baidupcs.com/thumbnail/0115085afmbc1d0961be34b2e3620259?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586351655360937860&expires=8h&fid=4118282674-250528-345742813797113&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-U5TLB%2BdvHRr%2FjV%2F%2FMhWzFvIL%2Btk%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- 配置文件结构：展示了cliff.toml文件中changelog模板的完整结构，包含commit信息格式化规则和URL替换配置
- 模板语法：使用{% for commit in commits %}循环遍历提交记录，通过条件判断{% if commit.scope %}处理不同提交类型
- 关键配置项：
    - trim = true：自动去除模板首尾空白
    - postprocessors：包含URL替换规则，将$REPO替换为实际项目地址
    - ![](https://thumbnail0.baidupcs.com/thumbnail/cb91ea26an31b48b299738d3a4069465?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586351548929036204&expires=8h&fid=4118282674-250528-856165684348101&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-2Ugy61Vw%2BRqgaQLaFHo1gy54mhk%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- 提交操作：
    - 使用git commit命令提交对cliff.toml配置文件的修改
    - 提交信息格式为chore: correct the project url in cliff config
    - 修改内容为1个文件的1行变更（1 insertion, 1 deletion）

##### 2. 分支管理与Pull Request

- ![](https://thumbnail0.baidupcs.com/thumbnail/4a57f8d2fh1ac38b024c9c4229d26792?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586349859687276453&expires=8h&fid=4118282674-250528-630654265620464&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-tuDRXHT3etqVHg8uThihLx5dW3Y%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- 分支操作：
    - 在chore/fix-cliff-config分支进行配置修复
    - 通过git push origin chore/fix-cliff-config推送分支到远程仓库
    - 系统自动提示可创建Pull Request
    - ![](https://thumbnail0.baidupcs.com/thumbnail/70f06a3ceg0c06ae3e522fd81a6c07f8?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586348714997201215&expires=8h&fid=4118282674-250528-140382894125844&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-R7lRFPssmyq3HuDEumumuG5s0Yc%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- PR规范：
    - 标题应简明描述修改内容（如"chore: correct the project url in cliff config"）
    - 基础分支选择master，比较分支选择修复分支
    - 描述框可详细说明修改原因和影响范围

##### 3. 生产环境最佳实践

- ![](https://thumbnail0.baidupcs.com/thumbnail/1d9846820v7f489631c9ae86ce92db0c?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586350014478588656&expires=8h&fid=4118282674-250528-565868831347486&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-T8msDnivMMIiqsbpqnGqHP2a86I%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- 分支保护：
    - 生产项目应对master分支启用保护规则
    - 典型保护措施包括：禁止强制推送、防止分支删除、要求状态检查
- 代码合并要求：
    - 所有CI检查通过后才能合并PR
    - 建议启用Required Pull Request reviews功能
    - 训练环境中可简化这些流程进行演示

#### 三、GitHub操作演示

- ![](https://thumbnail0.baidupcs.com/thumbnail/76b4a3250q9fdc6e57d619903f9205b3?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586351767410682596&expires=8h&fid=4118282674-250528-528167235099531&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-Y8pl2%2FPxfbOFRmeC%2B2McXA%2Bl8vI%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- CI检查流程：演示了GitHub上pull request的CI检查过程，包括自动构建检查(build-rust)的运行状态和结果确认
- 单人项目简化流程：在个人独立开发项目中，可以直接向master分支推送代码，省略完整的团队协作流程
- 检查确认：需要等待所有CI检查通过后才能进行后续操作，演示中确认了所有检查都已通过

#### 四、CodeReview时该做些什么

﻿

37:33

﻿

##### 1. 不应关注代码格式等基础工作

﻿

37:46

﻿

- ![](https://thumbnail0.baidupcs.com/thumbnail/c7977518dr5936402d52de62ba2eb36b?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586350174107086846&expires=8h&fid=4118282674-250528-917509445390153&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-gWAXFUehUmIb4zxiZbdnEeJ4aGw%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- 自动化检查优先：代码格式、基础规范等应由CI工具自动检查完成，人工review时不应重复这些工作
- 效率原则：人工review应专注于机器无法自动检查的高层次质量问题，避免浪费在基础检查上

##### 2. 架构设计的审查
38:13
- 适用场景：主要针对新增功能或重大修改，简单PR可能不需要
- 审查重点：是否符合良好的架构设计规范，模块划分是否合理
- 灵活应用：根据PR复杂度决定是否需要进行架构层面的review
##### 3. 接口设计的审查
38:41
- 审查范围：包括对外API、内部接口、数据结构和公开方法
- 核心标准：接口设计是否合理、一致且易于使用
- 重要性：被认为是评估代码质量的核心要素之一
##### 4. 代码质量的审查
39:11
- 最佳实践：包括命名规范、避免冗余循环等编码习惯
- 可读性：避免晦涩难懂的算法，必要时需注明复杂算法的来源和目的
- 性能考量：评估是否存在性能优化空间
- 安全性：根据代码领域检查相关风险，如SQL注入、CSRF、XSS等
##### 5. 错误处理的审查
40:17
- 重要性：错误处理与正确路径同等重要，是生产环境代码的关键
- 接口设计：错误处理接口是否合理，错误分类是否恰当
- 平衡原则：错误处理范围既不能过大也不能过细，需要找到合适粒度
##### 6. 代码可维护性的审查
40:54
- DRY原则：检查是否存在重复代码，必须纠正复制粘贴行为
- 简洁性：代码是否保持足够简单(KISS原则)
- 设计原则：是否符合SOLID等面向对象设计原则
- 文档：在必要位置提供适量文档，不求多但求精
##### 7. 团队特定实践的符合性审查

41:23
- 团队规范：检查代码是否符合团队特有的开发实践和约定
- 灵活性：根据具体团队要求进行针对性审查
#### 五、合并pull request时注意事项

41:43
##### 1. 合并方式选择

- ![](https://thumbnail0.baidupcs.com/thumbnail/ee3e2a09bna56c6a53a9832d1ffaeea7?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586350308523917215&expires=8h&fid=4118282674-250528-129499955006163&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-mBn5erkyFpu4d9m%2FSHE7Uh2KkUI%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- 团队规约: 在合并PR前团队需要统一约定使用哪种合并方式
- 个人偏好: 讲师倾向于使用squash merge方式
- 选项说明:
    - Allow merge commits: 将head分支所有提交保留并生成一个合并提交
    - Allow squash merging: 将head分支所有提交压缩为单个提交
    - Allow rebase merging: 将head分支提交逐个rebase到base分支

##### 2. squash merge详解

- ![](https://thumbnail0.baidupcs.com/thumbnail/3303edc48u0f78b717708d4b2f096df9?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586350416577862274&expires=8h&fid=4118282674-250528-264543459817501&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-CCCFSzTpKhrpZ4xt1XCKZpxz0qQ%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- 操作特点: 将一个PR内的所有提交压缩成单个提交后合并到主线
- 分支管理: 合并完成后可以安全删除该分支
- 历史记录: 保持主分支提交历史的简洁性
- CI流程: 合并后主分支会自动触发GitHub Actions进行CI验证

##### 3. 合并后操作

- ![](https://thumbnail0.baidupcs.com/thumbnail/16c5384cco43dd06107aeb77f28e6ccc?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586347844835438577&expires=8h&fid=4118282674-250528-383351496853322&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-ycWwJ93K72%2F4rWUDFMDJ8fa2Vu8%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- 分支清理: 确认合并成功后应及时删除已合并的分支
- 代码同步: 需要checkout回master分支并拉取最新代码
- CI验证: 主分支上的合并提交会再次触发CI流程验证

##### 4. 课程内容总结

- ![](https://thumbnail0.baidupcs.com/thumbnail/ef03d643ei98b6ed771f2c25b1603efa?chkbd=0&chkv=0&dp-callid=0&dp-logid=3586347963556275496&expires=8h&fid=4118282674-250528-147815942273076&ft=image&quality=100&rt=pr&sign=FDTAER-DCb740ccc5511e5e8fedcff06b081203-ReOBRNYSxIXBScOcqw9pKCOKqG0%3D&size=c1080_u1080&time=1763031600&vuk=4118282674)
- 项目创建: 通过模板项目创建了CLI项目基础结构
- 开发实践: 完成了简单的commit提交和PR合并流程
- 重点探讨:
    - CI/CD工作流的设计思考
    - 如何进行有效的code review
    - 代码质量保障的最佳实践

#### 六、知识小结

|   |   |   |   |
|---|---|---|---|
|知识点|核心内容|考试重点/易混淆点|难度系数|
|Rust项目组织方式|使用GitHub Organization管理多个项目，每个课程有独立repo，采用模板项目统一配置|模板项目与常规cargo new项目的区别|⭐⭐|
|开发环境配置|安装rustup、VS Code及插件(含GitHub Copilot)、cargo generate工具链|不同rustup安装版本选择(最小/普通/全量)|⭐⭐|
|代码质量工具链|pre-commit集成：rustfmt/cargo-deny/typos/clippy/test，GitHub Actions CI流程|cargo-deny的license合规检查机制|⭐⭐⭐|
|项目模板解析|Cargo.toml配置(edition/依赖)、gitignore/deny.toml/cliff.toml规范文件|Edition兼容性问题(2015/2018/2021)|⭐⭐|
|CI/CD实践|GitHub Action工作流：多平台编译/代码覆盖率/rusty-cache优化/自动化changelog|squash merge策略与分支保护规则|⭐⭐⭐⭐|
|Code Review标准|架构设计/接口规范/错误处理/DRY原则/SOLID原则/安全审计四维度|生产环境与训练项目的review差异|⭐⭐⭐⭐|
|开发工作流演示|cargo generate生成项目→本地测试→pre-commit检查→PR流程→CI验证|next-test与传统cargo test性能对比|⭐⭐|

### 问题
#### 注意deny安装版本
﻿cargo install cargo-deny --version 0.13.1


### 找不到typos命令解决
```
在 `~/.bashrc` 或 `~/.zshrc` 中添加：

`export PATH="$HOME/.cargo/bin:$PATH"`

然后重新加载：

`source ~/.bashrc`
```

