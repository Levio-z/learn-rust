---
tags:
  - misc
---
## 1. 核心观点  
### Ⅰ. 概念层



### Ⅱ. 应用层




### Ⅲ. 实现层

### **IV**.原理层


## 2. 背景/出处  
- 来源：
- 引文/摘要：  
  - …  
  - …  

## 3. 展开说明  
#### 一、Redis基础介绍
- 实践方法: 通过编写Redis dummy server逐步加深对Tokio异步生态的理解
- 技术栈: 使用Tokio的TcpListener处理TCP连接，实现accept和process流程

###### RESP协议版本
- 版本演进: Redis 8.0开始支持实验性RESP3特性，通过HELLO命令可协商协议版本
- 兼容性: Redis 7及以下版本同时支持RESP2和RESP3客户端，但返回类型可能不同
- 连接方式: 通过TCP连接默认端口6379，使用特定协议格式通信
- 交互模型: 基于请求-响应模式，客户端发送命令数组，服务器处理后返回响应

- 错误格式: 以减号-开头，后接错误消息和CRLF终止符，如-Error message\r\n
- 客户端处理: 应当将错误响应视为异常情况，错误消息内容即为异常信息
###### 数据编码格式
- 简单字符串: 以+开头，如+OK\r\n
- 错误类型: 以-开头，如-ERR unknown command\r\n
- 整数: 以:开头，如:1000\r\n
- 批量字符串: 以``开头后接长度，如5\r\nhello\r\n
- 数组: 以*开头后接元素数量，如*2\r\n$5\r\nhello\r\n$5\r\nworld\r\n
- 空值表示:
    - 空批量字符串: $-1\r\n
    - 空数组: *-1\r\n
- 示例解析:
    - 字符串"hello"编码为$5\r\nhello\r\n
    - 包含"hello"和"world"的数组编码为*2\r\n$5\r\nhello\r\n$5\r\nworld\r\n
- RESP协议特性：Redis序列化协议(RESP)是客户端实现的网络协议，具有简单易实现、快速解析、人类可读的特点。
- 响应格式：可以对任何命令返回"OK\r\n"作为简单响应，这是RESP协议中的简单字符串(Simple Strings)格式。
- 协议版本：RESP2是Redis 2.0后的标准通信方法，RESP3是其超集，主要增加了更多数据类型支持。
### 引入tokio
- [Rust-tokio-基本概念](../../../../Areas/Rust/Area/3%20库&应用场景/库/crate/tokio/note/atomic/Rust-tokio-基本概念.md)
- 功能选择：
    - rt：基础运行时
    - rt-multi-thread：多线程运行时
    - macros：支持#[tokio::main]等宏
    - net：TCP监听等网络功能
### TCP监听

### 如何解析命令

构建一个RespFrame，实现不同命令的encode和decode
![](asserts/Pasted%20image%2020260107112306.png)

- 核心结构：
    - 使用枚举(enum)表示所有RESP数据类型
    - 每种类型对应独立的数据结构
- 设计考虑：
    - 为每种类型创建独立结构体（如SimpleString结构体）
    - 使用Option处理可空值（如空批量字符串）
    - 暂不支持大数类型（因Rust原生支持有限）
    - 映射的键限制为字符串类型，值可为任意RESP类型

- 核心特性：
    - RespEncode trait：将结构体编码为字节序列
    - RespDecode trait：从字节缓冲区解析为结构体
###### 3）bytes介绍
- 核心组件：
    - Bytes：不可变字节视图
    - BytesMut：可变字节缓冲区
- 关键特性：
    - 零拷贝：支持多个Bytes对象共享底层内存
    - 高效分割：split()方法可创建独立视图
    - 自动扩容：写入时自动增长缓冲区

### docode
##### 引入enum_dispatch
- 引入方式: 使用cargo add enum_dispatch命令添加依赖，版本为v0.3.13
- 作用位置: 在trait定义处通过`#[enum_dispatch]`宏标记需要分发的trait
- 实现原理: 自动为enum生成trait实现，避免手动编写重复的分发代码

### 实现命令
![](asserts/Pasted%20image%2020260108201530.png)
## 4. 与其他卡片的关联  
- 前置卡片：
- 后续卡片：
- 相似主题：

## 5. 应用/启发  
- 可以如何应用在工作、学习、生活中  
- 引发的思考与问题  

## 6. 待办/进一步探索  
- [x] [tokio-decode](../../4%20note/note/inbox/tokio-decode.md)
  
