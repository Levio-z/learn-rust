### 1、实现类似TcpListener和TcpStream的接口的设计工作
- 希望用户在多线程上使用
- 简单易用的接口
- 启动一个线程，在后台实现tcp
- 只有单个网路连接如何进行多路复用
#### 实现1
- cm(多生产者)
	- 管理多个套接字
- pm（消费者）数据包管理器
	- 在另一个线程里面使用tun/tap
- 多生产者多消费者（**MPMC**）通信机制，来源于 `crossbeam` 并发库

- 生产者通过MPMC向cm发送请求，cm通过MPMC向pm发送，pm接收到数据包，存在缓冲区，然后发送给cm，cm为每个连接提供了未读数据的缓冲区。
- 将缓区复制到新buffer，通过通道发送给套接字

#### 实现2

- cm还是连接管理器
	- 将多有TCB放在一个map里面
- pm是数据包管理器
- TCB读取到不适合它的数据包，就放入一个队列
- 套接字获取锁，才能访问pm，遍历所有数据包，上面没有数据，需要yield，并且触发计时器
- 计时器
	- 决定是否该重试发送包
- 没有得到，得到一个comvar
- 使用一个线程运行nic，读到数据唤醒线程
	- https://www.coverfire.com/articles/queueing-in-the-linux-network-stack/

客户端->CM
- 内核需要阻止程序
- 在内核阻止客户端缓存数据