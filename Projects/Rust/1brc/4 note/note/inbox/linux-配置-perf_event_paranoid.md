---
tags:
  - note
---
## 1. 核心观点  
### Ⅰ. 概念层



### Ⅱ. 应用层




### Ⅲ. 实现层

### **IV**.原理层


## 2. 背景/出处  
- 来源：
- 引文/摘要：  
  - …  
  - …  

## 3. 展开说明  
在 WSL (Ubuntu/Linux) 环境下进行 Rust 代码性能分析，主要分为**采样（Sampling）**和**可视化（Visualization）**两个阶段。

针对你提到的“查看具体方法”和“堆栈占用时间”，以下是目前 Rust 生态中最主流、最强大的工具组合：

---



简单来说，这是一个 Linux 内核的安全限制。`/proc/sys/kernel/perf_event_paranoid` 这个文件决定了**非特权用户（普通用户）可以使用哪些性能监控（perf events）功能**。

当你运行 `samply` 或 `perf` 这样的工具时，它们需要监听 CPU 的硬件计数器。由于这涉及到敏感的系统级数据，内核会根据这个“偏执度”（Paranoid）级别来决定是否允许你执行。

### 各个级别的含义

这个设置的值通常为以下几种：

- **2 (当前值)：** 最严格。**不允许**普通用户测量内核性能或使用 CPU 硬件计数器。你只能测量用户空间的数据（而且通常受限）。这是大多数现代 Linux 发行版的默认安全设置。
    
- **1：** 允许普通用户读取内核频率、使用 CPU 硬件计数器，但不允许追踪原始跟踪点（raw tracepoints）。**这是运行 samply 的推荐级别。**
    
- **0：** 允许普通用户访问大部分性能数据，包括原始跟踪点（除了读取敏感内核内存）。
    
- **-1：** 完全开放。基本上没有任何限制（不建议在生产环境使用）。
    

---

### 为什么 samply 需要它？

samply 是一个采样分析器（Sampling Profiler）。它通过定期中断 CPU 并查看当前正在运行的代码来工作。

如果设置为 2，内核会出于安全考虑（防止侧信道攻击或敏感信息泄露）拒绝 samply 获取这些 CPU 硬件信息。

---

### 如何修改？

你可以通过以下两种方式进行修改：

#### 1. 临时修改（重启后失效）

执行以下命令：

Bash

```
sudo sysctl -w kernel.perf_event_paranoid=1
```

#### 2. 永久修改

如果你希望重启后依然生效，需要修改配置文件：

1. 打开文件：`sudo nano /etc/sysctl.conf`
    
2. 在文件末尾添加一行：
    
    Plaintext
    
    ```
    kernel.perf_event_paranoid=1
    ```
    
3. 保存退出，并运行 `sudo sysctl -p` 使其立即生效。
    

---

**安全提示：** 将此值设置为 `1` 在开发环境下通常是安全的，但在多租户的高安全性服务器上，请谨慎操作，因为它确实略微增加了普通用户窥探系统活动的能力。

你是在尝试为 Rust 程序还是其他语言编写的代码做性能分析？我可以帮你看看 `samply` 的具体配置。


## 4. 与其他卡片的关联  
- 前置卡片：
- 后续卡片：
- 相似主题：

## 5. 应用/启发  
- 可以如何应用在工作、学习、生活中  
- 引发的思考与问题  

## 6. 待办/进一步探索  
 
  
