---
tags:
  - reference
---
## 1. æ ¸å¿ƒè§‚ç‚¹  
### â… . æ¦‚å¿µå±‚



### â…¡. å®ç°å±‚



### â…¢. åŸç†å±‚

## 2. èƒŒæ™¯/å‡ºå¤„  
- æ¥æºï¼š
- å¼•æ–‡/æ‘˜è¦ï¼š  
  - â€¦  
  - â€¦  

## 3. å±•å¼€è¯´æ˜  
### æŒ‰ç…§èŒè´£æ‹†åˆ†

1. **å­—ç¬¦çº§é—®é¢˜ â†’ Lexer**
    
2. **ç»“æ„çº§é—®é¢˜ â†’ Parser**
    
3. **æ‰§è¡Œçº§é—®é¢˜ â†’ Executor**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Lexer     â”‚  line â†’ Vec<Token>
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Parser    â”‚ Token â†’ AST(Command, Pipeline, Redirect)
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Executor   â”‚ AST â†’ æ‰§è¡Œç»“æœ
```




---

## äºŒã€ä»€ä¹ˆæ˜¯ Parserï¼ˆè¯­æ³•åˆ†æå™¨ï¼‰


---

## ä¸‰ã€ç”¨ä¸€å¥è¯ä¸¥æ ¼åŒºåˆ†ä¸¤è€…

### åˆå§‹è®¾ç½®ï¼šä¸€å¥è¯å®šä¹‰

|å±‚çº§|å…³æ³¨ç‚¹|å…¸å‹é—®é¢˜|
|---|---|---|
|Lexer|å­—ç¬¦å¦‚ä½•å˜æˆ token|`' '` æ˜¯å­—ç¬¦è¿˜æ˜¯åˆ†éš”ç¬¦ï¼Ÿ|
|Parser|token å¦‚ä½•ç»„æˆå‘½ä»¤|`>` åé¢æ˜¯ä¸æ˜¯æ–‡ä»¶åï¼Ÿ|

---

## å››ã€æŠŠä½ ç°åœ¨çš„ä»£ç å¯¹ç…§è¿‡æ¥çœ‹

### åˆå§‹è®¾ç½®ï¼šä½ ç°åœ¨çš„ split_quotes åšäº†ä»€ä¹ˆï¼Ÿ

`split_quotes` åŒæ—¶åœ¨åšï¼š

- quote / escapeï¼ˆLexer çš„äº‹ï¼‰
    
- `|` æ‹†å‘½ä»¤ï¼ˆParser çš„äº‹ï¼‰
    
- `>` / `>>` / `2>`ï¼ˆParser çš„äº‹ï¼‰
    
- argv æ„é€ ï¼ˆParser çš„äº‹ï¼‰
    

ğŸ‘‰ **è¿™æ˜¯â€œLexer + Parser èåˆåœ¨ä¸€ä¸ªçŠ¶æ€æœºé‡Œâ€**

---

## äº”ã€ä¸ºä»€ä¹ˆä¸€å®šè¦æ‹†ï¼Ÿ

### åˆå§‹è®¾ç½®ï¼šä¸æ‹†ä¼šå‘ç”Ÿä»€ä¹ˆï¼Ÿ

ä¸€æ—¦ä½ ç»§ç»­åŠ åŠŸèƒ½ï¼š

- `< input`
    
- `2>&1`
    
- `$(command)`
    
- backtick
    
- å˜é‡å±•å¼€
    

ä½ çš„çŠ¶æ€æœºä¼šå‡ºç°ï¼š

- çŠ¶æ€æŒ‡æ•°çˆ†ç‚¸
    
- flag äº¤å‰æ±¡æŸ“
    
- æ— æ³•å•å…ƒæµ‹è¯•
    

è¿™æ˜¯æ‰€æœ‰ shell åˆå­¦è€…éƒ½ä¼šè¸©çš„å‘ã€‚

---

## å…­ã€æœ€å°ç¤ºä¾‹ï¼šå¯¹æ¯”æ¸…æ™°ç‰ˆæœ¬

### åˆå§‹è®¾ç½®ï¼šLexerï¼ˆåªç®¡å­—ç¬¦ï¼‰

```rust
enum Lexeme {
    Word(String),
    Pipe,
    RedirectOut,
    RedirectAppendOut,
}
```

### åˆå§‹è®¾ç½®ï¼šParserï¼ˆåªç®¡ç»“æ„ï¼‰

```rust
struct CommandSpec {
    argv: Vec<String>,
    redirects: Vec<Redirect>,
}
```

Lexer æ°¸è¿œä¸è¿”å› `Redirect { path }`  
Parser æ°¸è¿œä¸å¤„ç† `'` å’Œ `\`

---

## æ€»ç»“

**â€œquote è§„åˆ™åªå­˜åœ¨äº Lexerâ€** çš„æ„æ€æ˜¯ï¼š

> å¼•å·åªå½±å“**å­—ç¬¦å¦‚ä½•åˆå¹¶æˆä¸€ä¸ªè¯**ï¼Œä¸å½±å“å‘½ä»¤ç»“æ„ã€‚

**â€œredirect è§„åˆ™åªå­˜åœ¨äº Parserâ€** çš„æ„æ€æ˜¯ï¼š

> é‡å®šå‘æ˜¯**å‘½ä»¤çš„è¯­ä¹‰ç»“æ„**ï¼Œä¸å±äºå­—ç¬¦å¤„ç†ã€‚

---


    for cmd in pipeline:
    setup_pipe_if_needed()
    apply_redirections(cmd)
    ctx = ExecContext {
        stdin,
        stdout,
        stderr,
        is_last
    }
    run_command(cmd, ctx)




## 4. ä¸å…¶ä»–å¡ç‰‡çš„å…³è”  
- å‰ç½®å¡ç‰‡ï¼š
	- [ç¼–è¯‘åŸç†-Lexer-åŸºæœ¬æ¦‚å¿µ](../todo/ç¼–è¯‘åŸç†-Lexer-åŸºæœ¬æ¦‚å¿µ.md)
	- [ç¼–è¯‘åŸç†-Parse-åŸºæœ¬æ¦‚å¿µ](../todo/ç¼–è¯‘åŸç†-Parse-åŸºæœ¬æ¦‚å¿µ.md)
- åç»­å¡ç‰‡ï¼š
- ç›¸ä¼¼ä¸»é¢˜ï¼š

## 5. åº”ç”¨/å¯å‘  
- å¯ä»¥å¦‚ä½•åº”ç”¨åœ¨å·¥ä½œã€å­¦ä¹ ã€ç”Ÿæ´»ä¸­  
- å¼•å‘çš„æ€è€ƒä¸é—®é¢˜  

## 6. å¾…åŠ/è¿›ä¸€æ­¥æ¢ç´¢  
 
  
