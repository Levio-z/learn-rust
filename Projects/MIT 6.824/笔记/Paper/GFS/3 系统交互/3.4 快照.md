快照作几乎可以立即创建文件或目录树（“源”）的副本，同时最大限度地减少正在进行的突变的任何中断。我们的用户使用它来快速创建庞大数据集的分支副本（通常是递归地创建这些副本的副本），或者在尝试以后可以轻松提交或回滚的更改之前对当前状态进行检查点。

与 AFS [5] 一样，我们**使用标准的写时复制技术来实现快照**。当主节点收到快照请求时，它首先撤销它即将快照的文件中块上的任何未完成租约。这确保了对这些块的任何后续写入都需要与主节点交互才能找到租约持有者。这将使主节点有机会首先创建块的新副本。

租约被撤销或过期后，主服务器会将作记录到磁盘。然后，它通过复制源文件或目录树的元数据，将此日志记录应用于其内存中状态。新创建的快照文件指向与源文件相同的块。

当客户端在快照操作后第一次想要写入块 C 时，它会向主服务器发送请求以查找当前租赁持有者。主节点注意到块 C 的引用计数大于 1它推迟回复客户端请求，而是选择一个新的块句柄 C'。然后，它要求每个具有当前 C 副本的 chunkserver 创建一个名为 C' 的新块。通过在与原始块服务器相同的块服务器上创建新块，我们确保数据可以在本地复制，而不是通过网络复制（我们的磁盘速度大约是 100 Mb 以太网链路的三倍）。从这一点来看，请求处理与任何块没有什么不同：主节点授予其中一个副本对新块 C' 的租约，并回复客户端，客户端可以正常写入块，而不知道它刚刚从现有块创建。

