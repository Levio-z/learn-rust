![](asserts/Pasted%20image%2020250808203426.png)
GFS 集群由单个主服务器和多个块服务器组成，并由多个客户端访问，如图 1 所示。其中每一个通常是运行用户级服务器进程的商用 Linux 机器。只要机器资源允许，并且运行可能不稳定的应用程序代码导致的较低可靠性是可以接受的，在同一台机器上运行块服务器和客户端很容易。

**文件被划分为固定大小的块**。 每个块都由主节点在创建块时分配的不可变且全局唯一的 64 位块句柄标识。块服务器将块作为 Linux 文件存储在本地磁盘上，并读取或写入由块句柄和字节范围指定的块数据。为了可靠性，每个块都复制在多个块服务器上。**默认情况下，我们存储三个副本**，但用户可以为文件命名空间的不同区域指定不同的复制级别。

**主服务器维护所有文件系统元数据**。这包括**命名空间、访问控制信息、从文件到块的映射以及块的当前位置**。它还控制系统范围的活动，例如块租约管理、孤立块的垃圾回收以及块服务器之间的块迁移。 主服务器定期与 HeartBeat 消息中的每个 chunkserver 进行通信，以给其指令并收集其状态。

**链接到每个应用程序的 GFS 客户端代码实现文件系统 API，并与主服务器和块服务器通信以代表应用程序读取或写入数据**。客户端与主服务器交互以进行元数据操作，但所有数据承载通信都直接发送到 chunkserver。我们不提供 POSIX API，因此不需要挂接到 Linux vnode 层。

客户端和块服务器都不缓存文件数据。
客户端缓存几乎没有什么好处，因为大多数应用程序都流式传输大文件或工作集太大而无法缓存。 没有它们可以通过消除缓存一致性问题来简化客户端和整个系统。（但是，客户端会缓存元数据。**块服务器不需要缓存文件数据，因为块存储为本地文件，因此 Linux 的缓冲区缓存已经将经常访问的数据保存在内存中。**

