```go
package main

import (
	"fmt"
	"math/rand"
	"sync"
	"time"
)

func requestVote() bool {
	time.Sleep(time.Millisecond * time.Duration(rand.Intn(200)))
	return rand.Intn(2) == 1
}

func main() {
	var mu sync.Mutex
	cond := sync.NewCond(&mu)

	count := 0      // æ”¶åˆ°çš„æœ‰æ•ˆç¥¨æ•°
	finished := 0   // å®ŒæˆæŠ•ç¥¨çš„æ€»çº¿ç¨‹æ•°

	const total = 10
	const majority = 5

	for i := 0; i < total; i++ {
		go func() {
			vote := requestVote() // æ¨¡æ‹ŸæŠ•ç¥¨ï¼ˆéšæœºè¿”å› true/falseï¼‰

			mu.Lock()
			defer mu.Unlock()

			if vote {
				count++
			}
			finished++

			// å”¤é†’æ‰€æœ‰ Wait ä¸­çš„ goroutineï¼ˆè¿™é‡Œåªæœ‰ä¸»çº¿ç¨‹ä¸€ä¸ª waiterï¼ŒSignal ä¹Ÿå¯ï¼‰
			cond.Broadcast()
		}()
	}

	mu.Lock()
	for count < majority && finished < total {
		// ç­‰å¾…æ¡ä»¶æ»¡è¶³ï¼ˆç¥¨æ•°è¿‡åŠ æˆ– æŠ•ç¥¨å…¨éƒ¨å®Œæˆï¼‰
		cond.Wait()
	}
	if count >= majority {
		fmt.Println("Received 5+ votes! ")
	} else {
		fmt.Println("Lost ")
	}
	mu.Unlock()
}

```
###  `sync.Mutex`

ç”¨äºä¿æŠ¤ä¸´ç•Œèµ„æºï¼ˆ`count`, `finished`ï¼‰çš„å¹¶å‘è®¿é—®ã€‚

###  `sync.Cond`

æ¡ä»¶å˜é‡ç”¨äºï¼š

- å½“ä¸»çº¿ç¨‹ç­‰å¾…â€œçŠ¶æ€è¾¾åˆ°ç‰¹å®šæ¡ä»¶â€æ—¶é˜»å¡ï¼›
    
- å½“åå° goroutine æ›´æ–°çŠ¶æ€åé€šçŸ¥ä¸»çº¿ç¨‹å”¤é†’ç»§ç»­åˆ¤æ–­ã€‚
### ğŸ¯ æ¡ä»¶åˆ¤æ–­é€»è¾‘


å¤åˆ¶ç¼–è¾‘

`for count < 5 && finished < 10 {     cond.Wait() }`

- å¦‚æœå½“å‰ç¥¨æ•°ä¸è¶³ 5 ä¸”æœªæŠ•å®Œï¼Œåˆ™ä¸»çº¿ç¨‹è¿›å…¥é˜»å¡ï¼›
    
- è¢« `Broadcast()` å”¤é†’åï¼Œé‡æ–°åˆ¤æ–­ç¥¨æ•°æ˜¯å¦è¾¾æ ‡ï¼›
    
- è‹¥ 10 ä¸ªçº¿ç¨‹éƒ½æ‰§è¡Œå®Œä»æœªè¾¾æ ‡ï¼Œåˆ™ç›´æ¥åˆ¤è´Ÿã€‚

## cond.Broadcast vs cond.Signal

- `Broadcast()`ï¼šå”¤é†’**æ‰€æœ‰**åœ¨ `.Wait()` ä¸Šé˜»å¡çš„ goroutineï¼›
    
- `Signal()`ï¼šåªå”¤é†’**ä¸€ä¸ª**ï¼ˆéšæœºé€‰æ‹©ï¼‰é˜»å¡çš„ goroutineã€‚
    

æœ¬ä¾‹ä¸­ï¼š

- ä¸»çº¿ç¨‹æ˜¯**å”¯ä¸€çš„ `Wait()` å®ä¾‹**ï¼›
    
- æ‰€ä»¥ `Signal()` / `Broadcast()` **éƒ½å¯**ï¼Œç”¨ `Broadcast()` æ›´ä¿é™©ä¸€ç‚¹ã€‚


- **Go çš„æ¡ä»¶å˜é‡åä½œæ¨¡å‹**
    
- **å•ç”Ÿäº§è€…-å¤šæ¶ˆè´¹è€…** æˆ– **å¤š worker åŒæ­¥åè°ƒ**
    
- **å¹¶å‘ç¼–ç¨‹ä¸­çš„æ¡ä»¶å”¤é†’æ¨¡å¼**