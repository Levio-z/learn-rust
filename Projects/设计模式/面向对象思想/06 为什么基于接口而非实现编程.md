### 接口本质
- 接口
    - 本质
        - **“接口”就是一组“协议”或者“约定”，是功能提供者提供给使用者的一个“功能列表”。**
    - 例子
        - “接口”在不同的应用场景下会有不同的解读，比如服务端与客户端之间的“接口”，类库提供的“接口”，甚至是一组通信的协议都可以叫作“接口”。刚刚对“接口”的理解，都比较偏上层、偏抽象，与实际的写代码离得有点远。如果落实到具体的编码，“基于接口而非实现编程”这条原则中的“接口”，可以理解为编程语言中的接口或者抽象类。
- 为什么有效提高质量
    - **可以将接口和实现相分离，封装不稳定的实现，暴露稳定的接口**。上游系统面向接口而非实现编程，不依赖不稳定的实现细节，这样当实现发生变化的时候，上游系统的代码基本上不需要做改动，以此来降低耦合性，提高扩展性。
- 实际上，“基于接口而非实现编程”这条原则的另一个表述方式，是“基于抽象而非实现编程”。
    - 在软件开发中，最大的挑战之一就是需求的不断变化，这也是考验代码设计好坏的一个标准。
	    - **越抽象、越顶层、越脱离具体某一实现的设计，越能提高代码的灵活性，越能应对未来的需求变化**。
	    - 好的代码设计，不仅能应对当下的需求，而且在将来需求发生变化的时候，仍然能够在不破坏原有代码设计的情况下灵活应对。而抽象就是提高代码扩展性、灵活性、可维护性最有效的手段之一。
### 如何将这条原则应用到实战中
案例
```java
public class AliyunImageStore {
 //... 省略属性、构造函数等...

 public void createBucketIfNotExisting(String bucketName) {
 // ... 创建 bucket 代码逻辑...
 // ... 失败会抛出异常..
 }

 public String generateAccessToken() {
 // ... 根据 accesskey/secrectkey 等生成 access token
 }

 public String uploadToAliyun(Image image, String bucketName, String accessTok
 //... 上传图片到阿里云...
 //... 返回图片存储在阿里云上的地址 (url）...
 }

 public Image downloadFromAliyun(String url, String accessToken) {
 //... 从阿里云下载图片...
 }
}
// AliyunImageStore 类的使用举例
public class ImageProcessingJob {
 private static final String BUCKET_NAME = "ai_images_bucket";
 //... 省略其他无关代码...

 public void process() {
 Image image = ...; // 处理图片，并封装为 Image 对象
 AliyunImageStore imageStore = new AliyunImageStore(/* 省略参数 */);
 imageStore.createBucketIfNotExisting(BUCKET_NAME);
 String accessToken = imageStore.generateAccessToken();
 imagestore.uploadToAliyun(image, BUCKET_NAME, accessToken);
 }

}

```
个上传流程包含三个步骤：创建 bucket（你可以简单理解为存储目录）、生成 access token 访问凭证、携带 access token 上传图片到指定的 bucket 中。代码实现非常简单， 类中的几个方法定义得都很干净，用起来也很清晰，乍看起来没有太大问题，完全能满足当下的需求。

不过，软件开发中唯一不变的就是变化。过了一段时间后，我们自建了私有云，不再将图片存储到阿里云了，而是将图片存储到自建私有云上。为了满足这样一个需求的变化，我们该如何修改代码呢？

我们需要重新设计实现一个存储图片到私有云的 PrivateImageStore 类，并用它替换掉项 目中所有的 AliyunImageStore 类对象。这样的修改听起来并不复杂，只是简单替换而 已，对整个代码的改动并不大。不过，我们经常说，“细节是魔鬼”。这句话在软件开发中 特别适用。实际上，刚刚的设计实现方式，就隐藏了很多容易出问题的“魔鬼细节”，我们 一块来看看都有哪些。

新的 PrivateImageStore 类需要设计实现哪些方法，才能在尽量最小化代码修改的情况 下，替换掉 AliyunImageStore 类呢？这就要求我们必须将 AliyunImageStore 类中所定 义的所有 public 方法，在 PrivateImageStore 类中都逐一定义并重新实现一遍。而这样做 就会存在一些问题，我总结了下面两点。
- 首先，AliyunImageStore 类中有些**函数命名暴露了实现细节**，比如，uploadToAliyun() 和 downloadFromAliyun()。如果开发这个功能的同事没有接口意识、抽象思维，那这种 暴露实现细节的命名方式就不足为奇了，毕竟最初我们只考虑将图片存储在阿里云上。而我 们把这种包含“aliyun”字眼的方法，照抄到 PrivateImageStore 类中，显然是不合适 的。如果我们在新类中重新命名 uploadToAliyun()、downloadFromAliyun() 这些方法， 那**就意味着，我们要修改项目中所有使用到这两个方法的代码，代码修改量可能就会很大。**
- 其次，**将图片存储到阿里云的流程，跟存储到私有云的流程，可能并不是完全一致的**。比 如，阿里云的图片上传和下载的过程中，需要生产 access token，而私有云不需要 access token。一方面，AliyunImageStore 中定义的 generateAccessToken() 方法不能照抄到 PrivateImageStore 中；另一方面，我们在使用 AliyunImageStore 上传、下载图片的时 候，代码中用到了 generateAccessToken() 方法，如果要改为私有云的上传下载流程，这 些代码都需要做调整。
#### 如何解决
- **函数的命名不能暴露任何实现细节**。比如，前面提到的 uploadToAliyun() 就不符合要 求，应该改为去掉 aliyun 这样的字眼，改为更加抽象的命名方式，比如：upload()。
- **封装具体的实现细节。**比如，跟阿里云相关的特殊上传（或下载）流程不应该暴露给调 用者。我们对上传（或下载）流程进行封装，对外提供一个包裹所有上传（或下载）细节的方法，给调用者使用。
- **为实现类定义抽象的接口**。具体的实现类都依赖统一的接口定义，遵从一致的上传功能 协议。使用者依赖接口，而不是具体的实现类来编程。
### 是否需要为每个类定义接口？
**做任何事情都要讲求一个“度”，过度使用这条原则，非得给每个类都定义接口，接口满天飞，也会导致不必要的开发负担。**至于什么时候，该为某个类定义接口，实现基于接口的编程，什么时候不需要定义接口，直接使用实现类编程，我们做权衡的根本依据，还是要**回归到设计原则诞生的初衷上来。只要搞清楚了这条原则是为了解决什么样的问题而产生的，你就会发现，很多之前模棱两可的问题，都会变得豁然开朗。**

前面我们也提到，这条原则的设计初衷是，**将接口和实现相分离，封装不稳定的实现，暴露 稳定的接口。上游系统面向接口而非实现编程，不依赖不稳定的实现细节，这样当实现发生 变化的时候，上游系统的代码基本上不需要做改动，以此来降低代码间的耦合性，提高代码 的扩展性。**

从这个设计初衷上来看，如果在**我们的业务场景中，某个功能只有一种实现方式，未来也不 可能被其他实现方式替换，那我们就没有必要为其设计接口**，也没有必要基于接口编程，直 接使用实现类就可以了。

除此之外，**越是不稳定的系统，我们越是要在代码的扩展性、维护性上下功夫。**相反，如果 **某个系统特别稳定，在开发完之后，基本上不需要做维护，那我们就没有必要为其扩展性， 投入不必要的开发时间。**