# 什么是基于贫血模型的传统开发模式？

业务逻辑集中在 UserService 中。我们通过 UserService 来操作 UserBo。换句话说，Service 层的数据和业务逻辑，被分割为 BO 和 Service 两个类中。像 UserBo 这样， **只包含数据，不包含业务逻辑的类**，就叫作**贫血模型**（Anemic Domain Model）。

UserEntity、UserVo 都是基于贫血模型设计的。这种贫血模型将数据与操作分离，破坏了面向对象的封装特性，是一种典型的面向过程的编程风格。

# 什么是基于充血模型的 DDD 开发模式？

### 首先，我们先来看一下，什么是充血模型？

充血模型（Rich Domain Model）正好相反，**数据和对应的业务逻辑被封装到同一个类中。**因此，这种充血模型满足面向对象的封装特性，是典型的面向对象编程风格。

### 接下来，我们再来看一下，什么是领域驱动设计？

领域驱动设计，即 DDD，主要是用来指导如何**解耦业务系统**，**划分业务模块**，**定义业务领域模型**及其**交互**。

我们知道，除了监控、调用链追踪、API 网关等服务治理系统的开发之外，微服务还有另外一个更加重要的工作，那就是**针对公司的业务，合理地做微服务拆分**。而**领域驱动设计恰好就是用来指导划分服务的。**所以，微服务加速了领域驱动设计的盛行。

做好领域驱动设计的关键是，看你对自己**所做业务的熟悉程度，而并不是对领域驱动设计这个概念本身**的掌握程度。即便你对领域驱动搞得再清楚，但是对业务不熟悉，也并不一定能做出合理的领域设计。所以，不要把领域驱动设计当银弹，不要花太多的时间去过度地研究它。

实际上，基于充血模型的 DDD 开发模式实现的代码，也是按照 MVC 三层架构分层的。Controller 层还是负责暴露接口，Repository 层还是负责数据存取，Service 层负责核心业务逻辑。它跟基于贫血模型的传统开发模式的区别主要在 Service 层。

在基于充血模型的 DDD 开发模式中，Service 层包含 Service 类和 Domain 类两部分。Domain 就相当于贫血模型中的 BO。不过，Domain 与 BO 的区别在于它是基于充血模型开发的，既包含数据，也包含业务逻辑。而 Service 类变得非常单薄。总结一下的话就是，**基于贫血模型的传统的开发模式，重 Service 轻 BO**；**基于充血模型的 DDD 开发模式**，**轻 Service 重Domain。**

# 为什么基于贫血模型的传统开发模式如此受欢迎？

- 大部分情况下，我们开发的系统业务可能都比较简单，简单到就是基于SQL 的 CRUD 操作，所以，我们根本不需要动脑子精心设计充血模型，贫血模型就足以应 付这种简单业务的开发工作。
- 充血模型的设计要比贫血模型更加有难度
- 思维已固化，转型有成本。

# 什么项目应该考虑使用基于充血模型的 DDD 开发模式？

刚刚我们讲到，基于贫血模型的传统的开发模式，比较适合业务比较简单的系统开发。相对应的，基于充血模型的 DDD 开发模式，**更适合业务复杂的系统开发**。

实际上，除了我们能看到的代码层面的区别之外（一个业务逻辑放到 Service 层，一个放到领域模型中），还有一个非常重要的区别，**那就是两种不同的开发模式会导致不同的开发流程。**基于充血模型的 DDD 开发模式的开发流程，在应对复杂业务系统的开发的时候更加有优势。为什么这么说呢？我们先来回忆一下，我们平时基于贫血模型的传统的开发模式，都是怎么实现一个功能需求的。

不夸张地讲，我们平时的开发，大部分都是 **SQL 驱动（SQL-Driven）的开发模式。**我们接到一个后端接口的开发需求的时候，就去看接口需要的数据对应到数据库中，需要哪张表或者哪几张表，然后思考如何编写 SQL 语句来获取数据。之后就是定义 Entity、BO、VO，然后模板式地往对应的 Repository、Service、Controller 类中添加代码。

业务逻辑包裹在一个大的 SQL 语句中，而 Service 层可以做的事情很少。SQL 都是针对特定的业务功能编写的，复用性差。当我要开发另一个业务功能的时候，只能重新写个满足新需求的 SQL 语句，这就可能导致各种长得差不多、区别很小的 SQL 语句满天飞。

所以，在这个过程中，很少有人会应用领域模型、OOP 的概念，也很少有代码复用意识。**对于简单业务系统来说，这种开发方式问题不大。**但对于复杂业务系统的开发来说，这样的**开发方式会让代码越来越混乱，最终导致无法维护。**

如果我们在项目中，应用基于充血模型的 DDD 的开发模式，那对应的开发流程就完全不一样了。**在这种开发模式下，我们需要事先理清楚所有的业务，定义领域模型所包含的属性和方法。领域模型相当于可复用的业务中间层**。新功能需求的开发，都基于之前定义好的这些领域模型来完成。

我们知道，越复杂的系统，**对代码的复用性、易维护性要求就越高，我们就越应该花更多的时间和精力在前期设计上。而基于充血模型的 DDD 开发模式，正好需要我们前期做大量的业务调研、领域模型设计，所以它更加适合这种复杂系统的开发。**