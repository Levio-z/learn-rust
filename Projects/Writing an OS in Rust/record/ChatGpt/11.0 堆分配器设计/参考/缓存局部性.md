>https://www.geeksforgeeks.org/computer-organization-architecture/locality-of-reference-and-cache-operation-in-cache-memory/

### 1. 引用局部性（Temporal Locality / Locality of Reference）
**定义**：  
引用局部性指**在某一时间段内，程序倾向于访问同一组的内存区域或数据块的现象**。它是程序执行时的一种规律性，体现了程序访问数据的重复性。
**类型**：
- **时间局部性（Temporal Locality）**：如果一个数据被访问过，它在不久的将来可能会再次被访问。
    - 例：循环中频繁访问同一个数组元素、局部变量或对象字段。
    - 在程序执行**循环**时，控制单元会反复访问构成循环体的指令集：循环体中的指令被连续执行多次，形成**时间局部性**。数据操作也通常在循环中重复使用，增强缓存利用率。
    - **子程序调用（Subroutine Calls）**：在调用子程序时，每次都需要从内存中获取该子程序的指令集。系统通常通过将子程序放入缓存来减少重复加载，提高执行效率。
    - 对数据项的访问也会集中化，即同一数据项会被多次访问。
	    - 数组、变量或结构体成员的重复访问体现时间局部性
	    - 连续访问邻近数据（如数组遍历）体现空间局部性。
- **机制**：
    
    - 若子程序被频繁调用，其指令会被重复访问，体现时间局部性。
        
    - 系统通常通过将子程序放入缓存来减少重复加载，提高执行效率。
- **空间局部性（Spatial Locality）**：如果一个数据被访问过，其附近的数据很可能很快被访问。
    - 例：顺序遍历数组或读取连续的内存块。
**作用**：
- 引用局部性是设计缓存系统的核心依据。缓存通常存储最近访问的数据块（基于时间局部性）或相邻数据块（基于空间局部性），提高命中率。
---
### 2. 高速缓存（Cache）

**定义**：  
缓存是一种速度极快的临时存储器，是一种更小、更快的内存，位于CPU和主内存之间，用于存储近期使用或频繁使用的数据和指令的副本。高速缓存最重要的用途是它用于减少从主内存访问数据的平均时间。
**工作机制**：
1. **缓存命中（Cache Hit）**：请求的数据在缓存中存在，CPU可以直接访问。
2. **缓存未命中（Cache Miss）**：请求的数据不在缓存中，需要从主存读取，并将其存入缓存。
3. **替换策略**：当缓存满时，需要根据策略（如LRU、FIFO）淘汰部分数据。
**作用**：
- 利用引用局部性，缓存提高程序执行效率。
- 减少CPU访问主存的延迟。
---
### 3. 缓存操作（Cache-friendly Operations）
**定义**：  
缓存作是指程序执行过程中，**以高效利用缓存为目的的数据和指令操作**。
- 例如顺序访问数组(顺序访问可以**充分利用空间局部性**，一次读取的缓存行可以覆盖多个连续元素)、使用局部变量(局部变量通常存放在 **CPU寄存器或栈上**，访问速度极快。避免频繁访问主存（RAM）或远程内存，可以减少缓存未命中（Cache Miss）。)、避免随机内存访问等。
**优化方法**：
- **顺序访问**数组或连续内存块，利用空间局部性。
- **重复使用**变量和对象，利用时间局部性。
- **减少缓存抖动**：避免频繁访问不同内存块导致缓存频繁置换。
**作用**：
- 提高缓存命中率。
- 降低内存访问延迟，提高整体程序性能。

### 缓存的性能

****缓存性能：**** 缓存的性能是根据命中率来衡量的。当 CPU 引用内存并在[高速缓存](https://www.geeksforgeeks.org/computer-science-fundamentals/cache-memory/)中找到数据或指令时 ，称为缓存命中。如果在高速缓存中找不到所需的数据或指令，并且 CPU 引用主内存来查找该数据或指令，则称为缓存未命中。
```
Hit + Miss  = Total CPU Reference // CPU 在一段时间内访问缓存的总次数。
Hit Ratio(h) = Hit / (Hit+Miss)    // 命中率
Miss Ratio = 1 - Hit Ratio(h)      // 未命中率
Miss Ratio = Miss / (Hit+Miss)     // 未命中率
```
任何内存系统的平均访问时间由两个级别组成：缓存和主内存。如果 __Tc__ 是访问高速缓存的时间，__Tm__ 是访问主内存的时间，那么我们可以写：
```
Tavg = Average time to access memory

For simultaneous access
Tavg = h * Tc + (1-h)*Tm  

For hierarchial access
Tavg = h * Tc + (1-h)*(Tm + Tc)
```
Tavg​：平均访问时间（Average Memory Access Time）
 h：缓存命中率（Hit Ratio）
Tc​：访问缓存的时间（Cache access time）
Tm​：访问主存的时间（Memory access time）

同时访问（Simultaneous Access）
- 命中时，只需花 Tc​ 时间
- 未命中时，只需花 Tm​ 时间（因为访问主存是独立的，不需要再次访问缓存）。

分层访问（Hierarchical Access）
- 在多级缓存或层次结构下，访问是**顺序的**。
- 命中时，仍只需 Tc​。
- 未命中时：
    1. 先访问缓存（发现未命中，花 Tc​）
    2. 再访问主存（花 Tm​）

