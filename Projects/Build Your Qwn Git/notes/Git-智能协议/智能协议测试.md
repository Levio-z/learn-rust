```
curl -v --http1.0 "$GIT_URL/info/refs"
```
### 尝试旧客户端协议
```
curl -v --http1.0 "https://github.com/learn-rust-projects/build-your-own-git.git/info/refs"
```

```
Please upgrade your git client.
GitHub.com no longer supports git over dumb-http
```
这说明 **GitHub 已完全禁用 dumb-http 协议**，即：

`/info/refs` **不带参数** 的访问方式已经被 GitHub 屏蔽。

GitHub 只允许 **Smart HTTP 协议（带 service 参数）**，否则必然返回 403。
### 尝试智能协议

```
curl -v --out test "https://github.com/learn-rust-projects/build-your-own-git.git/info/refs?service=git-upload-pack"

```

因为 GitHub 返回的 MIME type 是：

`application/x-git-upload-pack-advertisement`

curl 会识别它为 **binary content-type**，并且会看到内容里有：

- `\0`（null byte）
- `\xff`
- `0000` flush packet
- pkt-line header
- Git capability 结束符


终端无法安全打印这些字节。

保存下来后
```
001e# service=git-upload-pack
0000015b9e4257ec52490078b918ab43831520d495e2a75e HEAD^@multi_ack thin-pack side-band side-band-64k ofs-delta shallow deepen-since deepen-not deepen-relative no-progress include-tag multi_ack_detailed allow-tip-sha1-in-want allow-reachable-sha1-in-want no-done symref=HEAD:refs/heads/master filter object-format=sha1 agent=git/github-60d715541676-Linux
003f9e4257ec52490078b918ab43831520d495e2a75e refs/heads/master
0000
```

https://git-scm.com/docs/gitprotocol-pack

返回的响应是一个 pkt-line 流，其中描述了每个引用及其当前值。该流必须按照 C 语言环境的排序规则按名称排序。

如果 HEAD 是有效参考文献，则 HEAD 必须作为第一个广告参考文献出现。如果 HEAD 不是有效参考文献，则 HEAD 完全不能出现在广告列表中，但其他参考文献仍然可以出现。

流必须在第一个 ref 的 NUL 值后包含功能声明。如果提供了 ref 的剥离值（即“ref^{}”），则该剥离值必须紧跟在 ref 本身之后。符合规范的服务器必须剥离带注释的 ref。

```
  advertised-refs  =  *1("version 1")
		      (no-refs / list-of-refs)
		      *shallow
		      flush-pkt

  no-refs          =  PKT-LINE(zero-id SP "capabilities^{}"
		      NUL capability-list)

  list-of-refs     =  first-ref *other-ref
  first-ref        =  PKT-LINE(obj-id SP refname
		      NUL capability-list)

  other-ref        =  PKT-LINE(other-tip / other-peeled)
  other-tip        =  obj-id SP refname
  other-peeled     =  obj-id SP refname "^{}"

  shallow          =  PKT-LINE("shallow" SP obj-id)

  capability-list  =  capability *(SP capability)
  capability       =  1*(LC_ALPHA / DIGIT / "-" / "_")
  LC_ALPHA         =  %x61-7A
```
[other-tip与other-peeled](../record/other-tip与other-peeled.md)
#### 测试
```
curl -v --output test "https://github.com/learn-rust-projects/os-rust.git/info/refs?service=git-upload-pack"
```


```
001e# service=git-upload-pack
0000015932f1af4c07d0d31e8d2a8621ec76dbb8dea97cbf HEAD^@multi_ack thin-pack side-band side-band-64k ofs-delta shallow deepen-since deepen-not deepen-relative no-progress include-tag multi_ack_detailed allow-tip-sha1-in-want allow-reachable-sha1-in-want no-done symref=HEAD:refs/heads/main filter object-format=sha1 agent=git/github-60d715541676-Linux
005f7b8e091b41a5ad9f55f54d0e4b11c9005087ecd2 refs/heads/01-bare_bones-freestanding_rust_binary
005abf6efc4cb1f8bad4f1a5cb80a166985d0d501f48 refs/heads/02-bare_bones-minimal_rust_kernel
004afaa02964330128f26f422016e1ab283f29baf328 refs/heads/03-bare_bones-vga
004e6f001a1150d75d904d442daf153922a5199d7965 refs/heads/04-bare_bones-testing
0055c7edcaf2a3e21302c478427ca99670f66debeb06 refs/heads/05-interrupts-cpu_exceptions
0054efdbb27b5446e36261900c98db738c9c251a3b04 refs/heads/06-interrupts-double_faults
005afffa6a8ec212568d85693565616715f8226d748e refs/heads/07-interrupts-hardware_interrupts
004fd2120cf4bdb814029ce54be0c31145b32657df58 refs/heads/08-paging-introduction
005458b6f2fb48fa16b7a37da8a58e848a50037be3e9 refs/heads/11-paging-allocator_designs
003d32f1af4c07d0d31e8d2a8621ec76dbb8dea97cbf refs/heads/main
003ebf6efc4cb1f8bad4f1a5cb80a166985d0d501f48 refs/pull/1/head
003efaa02964330128f26f422016e1ab283f29baf328 refs/pull/2/head
003e6f001a1150d75d904d442daf153922a5199d7965 refs/pull/3/head
003ec7edcaf2a3e21302c478427ca99670f66debeb06 refs/pull/4/head
003eefdbb27b5446e36261900c98db738c9c251a3b04 refs/pull/5/head
003efffa6a8ec212568d85693565616715f8226d748e refs/pull/6/head
0000
```