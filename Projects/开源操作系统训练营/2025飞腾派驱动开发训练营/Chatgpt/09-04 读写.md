[08-01 dts分析](08-01%20dts分析.md)
- https://github.com/elliott10/dev-hw-driver/blob/main/docs/GPIO-controller-pl061-DDI0190.pdf
	- 3.2 Summary of PrimeCell GPIO registers

### 修改平台配置文件
![](asserts/Pasted%20image%2020250707201419.png)


![](asserts/Pasted%20image%2020250707201338.png)
加上pl061

- arceos
	- 虚拟内存和物理内存都准备好

### 平台有关代码层
![](asserts/Pasted%20image%2020250707201437.png)
寄存器加上虚拟地址偏移初始化
![](asserts/Pasted%20image%2020250707201517.png)
#### 初始化代码
![](asserts/Pasted%20image%2020250707201834.png)
- [1](#打开pin3的中断)


- 使能中断
- 注册一个handler函数
![](asserts/Pasted%20image%2020250707201957.png)

### 打开pin3的中断使能设置
![](asserts/Pasted%20image%2020250707202916.png)
![](asserts/Pasted%20image%2020250707202320.png)
![](asserts/Pasted%20image%2020250707202207.png)![](asserts/Pasted%20image%2020250707202259.png)
- 对GPIO寄存器进行声明
- 对应文档
	- https://github.com/elliott10/dev-hw-driver/blob/main/docs/GPIO-controller-pl061-DDI0190.pdf
	- 3.2 Summary of PrimeCell GPIO registers
- GPIO-IE
	- ![](asserts/Pasted%20image%2020250707202501.png)
	- ![](asserts/Pasted%20image%2020250707202638.png)
	- ![](asserts/Pasted%20image%2020250707213719.png)
### 实现对GPIO中断进行处理
![](asserts/Pasted%20image%2020250707202929.png)

- 外部关机输入
#### 串口中断
![](asserts/Pasted%20image%2020250707203045.png)
##### 对应中断号声明
![](asserts/Pasted%20image%2020250707203131.png)
![](asserts/Pasted%20image%2020250707203138.png)
[06 中断](06%20中断.md)
- 中断类型看到中断号

实际的中断偏移：是1+32 = 33

#### mod
初始化的中断号
![](asserts/Pasted%20image%2020250707203410.png)
### 清除

![](asserts/Pasted%20image%2020250707203443.png)

- 示例
![](asserts/Pasted%20image%2020250707203459.png)
![](asserts/Pasted%20image%2020250707203521.png)
可以用这个函数替代它

![](asserts/Pasted%20image%2020250707203545.png)

##### 中断号区域

### 按下按钮
![](asserts/Pasted%20image%2020250707203639.png)![](asserts/Pasted%20image%2020250707203721.png)
第三位出现1代表第三位引脚出现中断
GPIOIC清楚中断
![](asserts/Pasted%20image%2020250707203831.png)
1代表清楚中断
### 整理结构
- 设备空间抽象
- 中断号7使能
- 中断处理函数注册
	- 中断清楚
- 
