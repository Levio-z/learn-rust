## 实践案例：使用 Volume 部署 MySQL 数据库

  

我们将通过一个 MySQL 数据库的例子来演示如何使用 Volume 持久化数据。

  

### 创建并管理 Volume

  

```shell

# 创建一个命名卷

docker volume create mysql_data

  

# 查看卷信息

docker volume inspect mysql_data

  

# 列出所有卷

docker volume ls

```

  

### 使用 Volume 运行 MySQL

  

```shell

# 运行 MySQL 容器并挂载卷

docker run -d \

  --name mysql_db \

  -e MYSQL_ROOT_PASSWORD=mysecret \

  -v mysql_data:/var/lib/mysql \

  mysql:8.0

  

参数详解

参数 说明

docker run  启动一个新的容器

-d --detach，让容器在后台运行（非交互式）

--name mysql_db   设置容器名称为 mysql_db，便于后续操作，如 docker stop mysql_db

-e MYSQL_ROOT_PASSWORD=mysecret  通过环境变量设置 root 用户密码为 mysecret，这是 MySQL 镜像的默认初始化机制

-v mysql_data:/var/lib/mysql  将容器内的 MySQL 数据目录 /var/lib/mysql 持久化到名为 mysql_data 的 Docker 卷中

mysql:8.0   使用 Docker Hub 上的 MySQL 8.0 镜像

  

# 进入容器创建测试数据

	docker exec -it mysql_db mysql -uroot -pmysecret -h127.0.0.1

  

-h127.0.0.1 指定要连接的 主机地址为 127.0.0.1（即容器内本地）

  

特别说明：-h127.0.0.1 在容器内是否合理？

容器内连接 MySQL 时，可以使用 -h127.0.0.1，但其实默认就连接的是本机 MySQL 实例（即容器内自身）

  

有时候使用 localhost 会触发 MySQL 使用 Unix socket，而不是 TCP 连接

  

所以明确写 -h127.0.0.1 表示“强制使用 TCP 协议连接”，这对某些配置（如禁用 socket）是必要的

  

# 在 MySQL 中创建测试数据

mysql> CREATE DATABASE test_db;

mysql> USE test_db;

mysql> CREATE TABLE users (id INT, name VARCHAR(50));

mysql> INSERT INTO users VALUES (1, 'John Doe');

mysql> exit

```

  

### 验证数据持久化

  

```shell

# 删除原容器

docker rm -f mysql_db

  

# 使用同一个卷启动新容器

docker run -d \

  --name mysql_db2 \

  -e MYSQL_ROOT_PASSWORD=mysecret \

  -v mysql_data:/var/lib/mysql \

  mysql:8.0

  

# 验证数据是否存在

docker exec -it mysql_db2 \

   mysql -uroot -pmysecret -e "USE test_db; SELECT * FROM users;"

```

  

参数 作用

-e 表示“执行一段 SQL 语句”，即非交互式执行

"..." 传入的 SQL 内容，多个语句用分号隔开