#### 1. 🧱 中间层镜像（Intermediate Image Layers）

- Docker 在构建镜像时，会为每一条 `RUN`、`COPY` 等 Dockerfile 指令生成一个中间层镜像。
    
- 这些中间层通常 **没有标签**（tag），只是构建过程中的产物。
    
- 默认情况下 `docker image ls` **不会列出这些中间层**，因为它们不是用户显式可见的镜像对象。
    

---

#### 2. 🌀 悬空镜像（Dangling Images）

- 指镜像 **没有被任何 tag 引用**，但仍存在于本地。
    
- 原因：
    
    - 重新构建带相同 tag 的镜像时，旧镜像变成悬空镜像
        
    - 使用 `docker commit` 或 `build` 后没有打标签

```
REPOSITORY    TAG       IMAGE ID      CREATED       SIZE
<none>        <none>    d1e4f456ef5a  2 hours ago   123MB
```

### 为什么后来看不到
#### 为什么 `docker images -a` 没看到中间层镜像？

##### 1. Docker 版本和构建模式的变化

- **新版 Docker 默认使用 BuildKit** 构建镜像。
    
- BuildKit 采用了全新的构建缓存管理方式，中间层缓存并不会以普通镜像的形式存在于 `docker images` 里。
    
- 你用 `docker images -a` 只能看到“带标签的镜像”及“悬空镜像（dangling images）”，而 BuildKit 的缓存更像是专门的构建缓存，和镜像仓库里的镜像不同。
    

##### 2. 你用的构建命令可能触发 BuildKit

从 Docker 18.09 开始默认启用 BuildKit，构建缓存层不会以普通镜像层的形式保存，而是独立管理。

#### 1. 关闭 BuildKit，使用旧的构建方式试试：
```
DOCKER_BUILDKIT=0 docker build -t myapp:latest .
```
然后执行：

```
docker images -a
```
此时你应该可以看到中间层镜像（带 `<none>` 标签的镜像层）了。