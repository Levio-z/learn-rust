## 1\. 基本格式

```bash
-p [host_ip:]host_port:container_port[/protocol]
```

-   `host_ip`（可选）：绑定宿主机的具体 IP，默认绑定所有接口 `0.0.0.0`
    
-   `host_port`：宿主机端口
    
-   `container_port`：容器内部端口
    
-   `protocol`（可选）：协议，默认 TCP，可指定为 `udp`
    

---

## 2\. 四种常见端口映射方式

### 方式一：简单端口映射（宿主机所有接口）

```bash
docker run -p 8080:80 nginx
```

-   宿主机的 8080 端口映射到容器的 80 端口
    
-   任何访问宿主机的 8080 端口的请求都会转发到容器内 80 端口
    

---

### 方式二：指定宿主机 IP 绑定端口

```bash
docker run -p 127.0.0.1:8080:80 nginx
```

-   只监听宿主机的 `127.0.0.1`（localhost）接口的 8080 端口
    
-   宿主机外部无法通过网络访问该端口，增强安全性
    

---

### 方式三：映射随机宿主机端口到固定容器端口

```bash
docker run -p 80 nginx
```

或更显式地：

```bash
docker run -p :80 nginx
```

-   Docker 会自动分配一个随机的宿主机端口映射到容器的 80 端口
    
-   通过 `docker port <container_id>` 可以查看分配的端口号
    

---

### 方式四：指定协议（TCP/UDP）

```bash
docker run -p 8080:80/tcp nginx
docker run -p 8080:80/udp some-udp-app
```

-   默认协议是 TCP，显式指定协议可支持 UDP 应用
    
-   例如 DNS、VoIP 等需要 UDP 协议支持
    

---

## 3\. 总结表格

| 端口映射格式 | 说明 | 示例 |
| --- | --- | --- |
| `-p host_port:container_port` | 宿主机所有接口映射固定端口 | `-p 8080:80` |
| `-p host_ip:host_port:container_port` | 绑定宿主机指定 IP 地址端口 | `-p 127.0.0.1:8080:80` |
| `-p container_port` 或 `-p :container_port` | 自动分配宿主机端口映射容器端口 | `-p 80` 或 `-p :80` |
| `-p host_port:container_port/protocol` | 指定协议（tcp 或 udp） | `-p 53:53/udp` |

---

## 4\. 使用示例

```bash
# 映射宿主机 8080 端口到容器 80 端口
docker run -p 8080:80 nginx

# 只绑定本地回环地址端口，避免外网访问
docker run -p 127.0.0.1:8080:80 nginx

# 随机端口映射
docker run -p 80 nginx

# UDP 端口映射
docker run -p 53:53/udp some-dns-server
```

---

## 5\. 注意事项

-   端口冲突：确保宿主机端口未被占用，否则启动失败
    
-   防火墙配置：宿主机防火墙规则可能阻止端口访问
    
-   多端口映射：可多次使用 `-p` 映射多个端口
    

---