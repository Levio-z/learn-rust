# C++ 数组全解：从声明到多维再到指针衰减

在 C++ 里，**数组（array）** 是一组在内存中**连续存储**的同类型元素。它的底层规则有点复杂（特别是跟指针扯上关系时），但抓住几个核心要点，就能轻松理解。

---

## 1\. 如何声明数组

最基本的形式就是：

```cpp
T name[N];
```

-   `T` 是元素类型
-   `name` 是数组名
-   `N` 是数组长度（元素个数）
例子：

```cpp
int a[5];     // 5 个 int，a[0]~a[4]
double b[10]; // 10 个 double
```
数组的元素编号从 **0 开始**，可以用 `[]` 下标访问。

---

## 2\. 数组能装什么？

几乎所有对象类型都能当数组元素，包括：

-   基本类型（int, double…）
    
-   指针
    
-   类、枚举
    
-   甚至数组本身（这就成了多维数组）
    

⚠️ 例外：

-   不能有 `void` 元素
    
-   不能有“引用”的数组
    
-   不能有“函数”的数组
    

---

## 3\. 数组的“不能做的事”

虽然数组是对象，但它有几个禁区：

### ❌ 不能整体赋值

```cpp
int a[3] = {1,2,3};
int b[3] = {4,5,6};
a = b; // 错误！数组不能整体赋值
```

要么一个个拷贝，要么用 `std::copy`。

### ❌ 不能返回数组

函数不能返回数组本身，但可以返回指针或引用。

---

## 4\. 数组和指针的“暧昧关系”

数组名字在大多数情况下会 **自动转化为指向首元素的指针**，这叫**数组到指针衰减（decay）**。

例子：

```cpp
int a[3] = {1, 2, 3};
int* p = a;      // a 衰减为 int*，指向 a[0]
std::cout << *a; // 输出 1，相当于 a[0]
std::cout << p[1]; // 输出 2
```

⚠️ 但注意：数组和指针不是一回事。比如：

```cpp
sizeof(a); // 返回整个数组的大小：3 * sizeof(int)
sizeof(p); // 返回指针大小（通常是 8 字节）
```

---

## 5\. 数组和函数参数

因为有“衰减”，所以函数参数写成 `int a[]` 和 `int* a` 没区别：

```cpp
void f(int arr[]) { ... }   // 等价于 void f(int* arr)
```

如果想要**强制传数组**，要用引用：

```cpp
void g(int (&arr)[3]) { ... } // 只能传 int[3]
```
- `&arr` → 表示这是一个引用；
- `[3]` → 表示这个引用的类型是 **长度为 3 的数组**；
- 所以整个意思是 **“对一个 int[3] 的引用”**。
---

## 6\. 多维数组

数组的元素还可以是数组：

```cpp
int a[2][3] = {
    {1,2,3},
    {4,5,6}
};
```

这是一个 **2×3 的矩阵**，内存是连续的，按行排列。

衰减的时候要小心：

```cpp
int b[2][3];
int (*p)[3] = b;  // b 衰减为指向“3个int的数组”的指针
```

不是 `int**` 哦！很多新手会踩坑。

---

## 7\. 未知大小的数组

你可以先声明一个未知大小的数组，再定义时补齐：

```cpp
extern int x[];  // 还不知道多大
int x[10];       // 定义时告诉它有 10 个
```

多维数组里，**除了第一维，其他维度必须已知**：

```cpp
extern int a[][2]; // OK
extern int b[2][]; // 错误
```

---

## 8\. 动态数组

用 `new[]` 可以在堆上分配数组：

```cpp
int* p = new int[5]; // 5 个 int
delete[] p;          // 别忘记释放
```

C++11 起推荐用 `std::vector`，更安全。

---

## 9\. 小技巧与现代写法

-   用 `std::begin` 和 `std::end` 操作数组：
    
    ```cpp
    int a[3] = {1,2,3};
    std::for_each(std::begin(a), std::end(a), [](int x){ std::cout << x; });
    ```
    
-   范围 for 循环（C++11）直接支持数组：
    
    ```cpp
    for (int n : a) std::cout << n;
    ```
    

---

## 10\. 总结

-   数组是**固定大小、连续存储**的元素集合。
-   名字多数情况下会衰减为指针，但它本质上还是对象。
-   不支持整体赋值、不支持返回。
-   多维数组本质上还是“数组的数组”。
-   动态数组用 `new[]`，更推荐 `std::vector`。
一句话：**数组是指针的好基友，但千万别把它俩当成一个东西！**

---

要不要我帮你画一张 **数组 vs 指针关系图**（内存布局 + sizeof 对比 + 衰减过程），直观地展示它们的区别？