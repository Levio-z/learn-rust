### 虚拟化与Hypervisor概念

基于一台物理计算机系统建立一台或多台虚拟计算机系统（虚拟机）
每台虚拟机
- **拥有自己的独立的虚拟机硬件，支持一个独立的虚拟执行环境。
- 每个虚拟机中运行的操作系统，**认为自己独占该执行环境**，无法区分该环境是物理机还是虚拟机
![](Pasted%20image%2020250522001511.png)
Hypervisor即图中的虚拟化层软件： 运行在物理服务器和操作系统之间的中间软件层，**允许多个操作系统和应用共享硬件**。

### Hypervisor与模拟器Emulator的区别

根本区别：虚拟运行环境和支撑它的物理运行环境的体系结构即ISA是否一致。
![](Pasted%20image%2020250522001640.png)

根据1974年，Popek和Goldberg对虚拟机的定义：

- 虚拟机可以看作是物理机的一种高效隔离的复制，蕴含三层含义：同质、高效和资源受控。
    - 同质要求ISA的同构
    - 高效要求虚拟化消耗可忽略
    - 资源受控要求**中间层对物理资源的完全控制**。
- Hypervisor必须符合上述要求，而模拟器更侧重的是仿真效果，对性能效率通常没有硬性要求。

### 虚拟化类型

主要包括两种类型：区别在于构成的层级、引导的过程、实现的基础。
![](Pasted%20image%2020250522001729.png)
我们目前的实验仅针对I型虚拟化。
### Hypervisor支撑的资源对象层次
![](Pasted%20image%2020250522001750.png)
- VM：管理地址空间；同一整合下级各类资源
    - vCPU：计算资源虚拟化，VM中执行流
    - vMem：内存虚拟化，按照VM的物理空间布局
    - vDevice：设备虚拟化：包括直接映射和模拟
    - vUtilities：中断虚拟化、总线发现设备等

Hypervisor模拟了完整的物理机环境，物理环境下的资源在虚拟环境下都有对应。

![](Pasted%20image%2020250522001818.png)
第二种绑定，绑定之后就不可以更换。
- 效率高，劣势就是vcpu数量受限
![](Pasted%20image%2020250522001845.png)
- 个人评价：虚拟机就很像普通系统，地址对物理页帧的抽象

![](Pasted%20image%2020250522002022.png)

- 物理网卡当成网桥
- 另外一种
	- 多核，插槽只有一个。和核绑定。
![](Pasted%20image%2020250522002049.png)