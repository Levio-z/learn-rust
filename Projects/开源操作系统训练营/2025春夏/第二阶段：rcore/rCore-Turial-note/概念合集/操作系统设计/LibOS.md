LibOS 以**函数库**的形式存在，为应用程序提供操作系统的基本功能。它最早来源于 MIT PDOS研究小组在1996年左右的Exokernel（外核）操作系统结构研究。Frans Kaashoek 教授的博士生Dawson Engler 提出了一种与以往操作系统架构大相径庭的 Exokernel（外核）架构设计 [1](https://rcore-os.cn/rCore-Tutorial-Book-v3/chapter1/2remove-std.html#exokernel) ，即把传统的单体内核分为两部分，一部分以库操作系统的形式（即 LibOS）与应用程序紧耦合以实现传统的操作系统抽象，并进行面向应用的裁剪与优化；另外一部分（即外核）仅专注在最基本的安全复用物理硬件的机制上，**来给 LibOS 提供基本的硬件访问服务。这样的设计思路可以针对应用程序的特征定制 LibOS ，达到高性能的目标。**

这种操作系统架构的设计思路比较超前，对原型系统的测试显示了很好的性能提升。但最终没有被工业界采用，其中一个重要的原因是针**对特定应用定制一个LibOS的工作量大，难以重复使用。人力成本因素导致了它不太被工业界认可**。

### LibOS 如何绕过通用内核获得性能优化？应用如何实现定制化？
#### 1. 性能优化 —— 绕过通用内核层

在传统 OS（如 Linux）中，应用访问硬件资源需要经过 **系统调用 + 内核抽象层**，引入上下文切换与通用功能开销。  
LibOS + Exokernel 的优化手段：
1. **资源直接暴露**
    - 外核不提供高层抽象，而是暴露最小化的硬件资源接口：
        - 直接分配物理内存页给应用
        - 直接分配磁盘块号而不是文件描述符
        - 直接分配网络包缓冲区而不是 socket 抽象
    - → 避免了复杂的 VFS、TCP/IP 栈、调度器逻辑。
2. **安全性靠能力（Capabilities）机制**
    - 外核通过能力（token）控制哪些应用能访问哪些资源。
    - 安全检查发生在资源绑定阶段，而不是每次调用阶段。
    - → 避免了传统内核频繁的权限检查。
- **资源绑定阶段**：
    - 当应用第一次申请某资源时（例如申请一个物理内存页），外核检查安全性，并返回一个能力 token。
    - 这一步完成安全检查，相当于“发放钥匙”。
- **使用阶段**：
    - 之后，应用使用这个 token 在用户态直接访问资源。
    - 外核只需验证 token 有效性，而不必重复做复杂的权限判断。
    - → 安全与高效兼得。
3. **用户态库实现 OS 功能**
    - 应用通过链接的 **LibOS** 实现内存管理、文件系统、线程调度。
    - 这些逻辑运行在用户态，避免用户态 ↔ 内核态切换。
**例子**：
- 在 Exokernel Aegis 中，应用直接获得物理页的映射表，内存管理完全在用户态实现 → 页表修改无需陷入内核。
- 网络栈可以直接在用户态收发包（类似 DPDK 的思路），绕过内核 TCP/IP。
---
#### 2. 定制化 —— 应用裁剪或替换 LibOS 功能
不同应用有不同需求，LibOS 可以裁剪或替换操作系统抽象：
1. **文件系统定制**
    - 数据库可以实现自己的存储管理（如 **raw disk access**），避免通用文件系统层的缓存与元数据开销。
    - → 这就是 Oracle DB、MySQL 的“直接 I/O”思路，只不过 LibOS 下更彻底。
2. **内存管理定制**
    - 科学计算应用可以要求 **大页映射**（Huge Pages）来减少 TLB miss。
    - 数据库可以设计专属的 **buffer pool** 来代替通用的虚拟内存分页机制。
3. **线程调度优化**
    - Web 服务器应用可能需要高并发、低延迟 → LibOS 提供用户态线程（类似 Go runtime 的 goroutine 调度）。
    - 批处理应用可能需要最大化吞吐量 → 可以实现批量调度策略。
4. **网络栈替换**
    - Web 应用可以使用 **轻量级用户态 TCP/IP 栈**（零拷贝、无内核上下文切换）。
    - 分布式系统可以直接用 **RDMA（远程直接内存访问）**，绕过传统 socket 抽象。
---

#### 3. 工业类比（现代化继承）

虽然 Exokernel+LibOS 没在工业界直接落地，但很多现代优化思路与它相似：
- **DPDK / SPDK** → 用户态网络与存储栈，绕过 Linux 内核。
- **unikernel（MirageOS, OSv）** → 针对单应用编译出专属 OS 映像。
- **数据库系统** → 自带内存管理和文件存储逻辑，本质上就是 “定制化 LibOS”。
- **语言 runtime（JVM, Go runtime）** → 自带线程调度、GC，部分 OS 功能由 runtime 承担。