- 定义
	这里我们把控制流在执行完某指令时的物理资源内容，即确保下一时刻能继续 **_正确_ 执行控制流指令的物理资源内容**称为控制流的 **上下文** (Context) ，也可称为控制流所在执行环境的状态。

- 站在硬件的角度，**指令可访问的所有物理资源的内容，包括自带的所有通用寄存器、特权级相关特殊寄存器、以及指令访问的内存等，会随着指令的执行而逐渐发生变化。**

**不同的上下文**

- 如果一个**控制流属于某个函数，那么这个控制流的上下文简称为函数调用上下文。**
- 还有属于xx，是xx上下文，应用程序，进程，操作系统，中断/异常/陷入的上下文

**上下文保存与恢复**

在 CPU 不断执行指令的过程中，各种前缀的上下文（执行环境的状态）会不断地变化。如果出现了处理器在执行过程中的突变（即异常控制流）或转移（如多层函数调用），需要由维持执行环境的软硬件协同起来，保存发生突变或转移前的控制流上下文，即当前执行环境的状态（比如突变或函数调用前一刻的指令寄存器，栈寄存器和其他一些通用寄存器等内容），并在完成突变处理或被调用函数执行完毕后，恢复突变或转移前的控制流上下文。这是由于完成与突变相关的执行会破坏突变前的控制流上下文（比如上述各种寄存器的内容），导致如果不保存之前的控制流上下文，就无法恢复到突变前正确的执行环境，继续正常的普通控制流的执行。

- 对于异常控制流的上下文保存与恢复，**主要是通过 CPU 和操作系统（手动编写在栈上保存与恢复寄存器的指令）来协同完成**；**对于函数转移控制流的上下文保存与恢复，主要是通过编译器（自动生成在栈上保存与恢复寄存器的指令）来帮助完成的。**

#### 异常控制流

在操作系统中，需要处理三类异常控制流：外设中断 (Device Interrupt) 、陷入 (Trap) 和异常 (Exception，也称Fault Interrupt)。

### 上下文偏差

我们这里说的控制流的上下文是指仅会影响控制流正确执行的有限的物理/虚拟资源内容。这里需要理解程序中控制流的上下文对程序 _正确_ 执行的影响。如果在某时刻，由于某种有意或无意的原因，控制流的上下文发生了变化（比如某个寄存器的值变了），但并不是由于程序的控制流本身的指令导致的，这就会使得接下来的程序指令执行出现偏差，并最终导致执行过程或执行结果不符合预期，这种情形称为 **程序执行错误** 。 而操作系统有责任来保护应用程序中控制流的上下文，以让应用程序得以正确执行。