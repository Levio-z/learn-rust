---
tags:
  - note
---
## 1. 核心观点  

在 Git 的 `.idx` 索引文件结构中，**扇出表（fan-out table）** 是在头部（header）之后出现的第一部分，用于快速定位对象哈希（SHA-1 或 SHA-256）在索引文件中的大致位置。


## 2. 背景/出处  
- 来源：
- 引文/摘要：  
  - …  
  - …  

## 3. 展开说明  
与包文件一样，版本 2 索引文件以标头开头，尽管索引文件标头只有 8 个字节而不是 12 个字节。前四个字节始终是 `255、116、79、99`，选择这些字节是因为索引文件的第一个版本没有任何标头信息，而这四个字节将是版本 1 索引文件的无效启动。接下来的四个字节显式表示版本号——在我们的例子中，版本 2。

其本质是一个 **256 个 4 字节整数（共 1024 字节）** 的表。每个条目 `fanout[N]` 表示：

> “对象名（哈希值）的第一个字节 ≤ N 的所有对象的数量总和。”

换言之，这是一个 **累计分布表（cumulative histogram）**，它告诉 Git：

- 若第一个字节 ≤ 0x00，有多少对象；
    
- 若第一个字节 ≤ 0x01，有多少对象；
    
- …
    
- 若第一个字节 ≤ 0xFF，总对象数。
    

因此，`fanout[255]`（或 `fanout[0xFF]`）始终等于 **包中对象的总数**。
![](asserts/Pasted%20image%2020251113153836.png)
### 2. 扇出表的作用

Git 对象在索引文件中是按 **哈希字典序排序** 的。  
扇出表的设计使得 Git 可以通过第一个字节 **快速跳转** 到目标对象的索引范围。例如：

- 若要查找哈希以 `0x4f` 开头的对象：
    - 从 `fanout[0x4e]` 得知前一段共有多少对象。
    - 从 `fanout[0x4f]` 得知截至 0x4f 的累计数量。
    - 于是该对象的索引区间为：`[fanout[0x4e], fanout[0x4f])`。
    - 然后在这段区间内二分搜索具体哈希。

这使得 Git 可以在 **O(1)** 时间找到搜索区间，接着用 **O(log n)** 完成定位。






## 4. 与其他卡片的关联  
- 前置卡片：
- 后续卡片：
- 相似主题：

## 5. 应用/启发  
- 可以如何应用在工作、学习、生活中  
- 引发的思考与问题  

## 6. 待办/进一步探索  
- [ ] 深入阅读 xxx  
- [ ] 验证这个观点的边界条件  
