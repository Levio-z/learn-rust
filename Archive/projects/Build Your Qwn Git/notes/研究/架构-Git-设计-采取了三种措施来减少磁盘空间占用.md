---
tags:
  - note
---
## 1. 核心观点  
### Ⅰ. 概念层
- Git **使用 zlib 压缩文件后再进行存储**。
	- zlib 可以减小每个文件的大小，同时还能快速解压缩（“展开”）。
- 数据去重
	- **移除冗余数据的技术。创建新提交时，Git 会使用 SHA-1 算法对提交中每个跟踪文件的内容进行哈希运算，并与所有已存在对象的哈希值进行比较。如果某个文件的哈希值与现有对象的哈希值匹配，Git 就不会为该文件存储任何新内容**。
- （packfiles）增量式差异存储对象：增量式差异，“只存储与某个基础对象的差异”，而不是重复保存完整内容，delta就是基于基础对象差异构造出来的对象。一个对象可以基于另一个 delta，再基于另一个 delta。
	- [Git-OBJ_REF_DELTA-基本概念](../Reference/Git-OBJ_REF_DELTA-基本概念.md)
	- [git-OBJ_OFS_DELTA （偏移量增量对象）](../Reference/git-OBJ_OFS_DELTA%20（偏移量增量对象）.md)
		- 更易压缩和提升压缩率
- 编码优化：MSB 可变长整数的位编排与大端编码方式
	- 编码使得 Git 在存储对象大小、delta 偏移、扩展字段时能用尽量短的空间表示小数字
- 客户 服务端协商算法，不传输客户端已有内容

### Ⅱ. 实现层



### Ⅲ. 原理层

## 2. 背景/出处  
- 来源：
- 引文/摘要：  
  - …  
  - …  

## 3. 展开说明  
### 3.1 如何处理相似不相同的文件？

即使两个文件大部分内容都相同，只要存在任何差异，Git 就会认为它们完全不同，对于很多项目来说，这并不是什么大问题。Zlib 压缩功能强大，磁盘空间也足够便宜，因此 Git 可以长期只使用这两种技术。但有一件事却并不便宜：带宽。即使你的 ISP 不按兆字节收费，你仍然会关心克隆、推送和拉取所需的时间。Git 的目标是快速，而处理大量相似但不完全相同的数据，对其进行压缩，然后再通过网络传输，这个过程会很慢。  

### 3.2 pack和idx
.pack 文件包含实际的 Git 对象，而 .idx 文件包含用于快速定位 .pack 文件中对象的索引。

### 3.3**非增量式差异**

即 **不使用差异表示、直接存储完整对象内容** 的方式。在 packfile 中，这类对象被称为 **非增量对象（non-delta object）**，是最基础、最直接、独立可解码的一类对象。

### 3.4 **增量式差异（Deltification）的定义**

Git 在打包对象（packfile）时，为了减少储存空间，会选择“只存储与某个基础对象的差异”，而不是重复保存完整内容。  
这种只保存变化部分的机制，即为增量式差异（delta object）。

增量式差异对象内部 **不是人类可读的文本 diff**，而是 Git 自定义的一组指令，用来描述：
- 从基础对象拷贝哪些字节
- 插入哪些新字节
- 最后组合成目标对象

- 在 `git verify-pack` 输出中，很容易识别出增量对象——它们末尾带有额外的 SHA 值。

基础对象可以是：
- 完整对象（commit/tree/blob/tag）
- 另一个 delta（形成 delta chain）
	- **基础对象也可以进行 Delt 化，从而允许多层 Delt 化**，进一步减小总大小。对于 Delt 化对象，倒数第二个字段（紧接基础对象名称之前）指示对象的深度
### 3.5 IDX 文件

[Git-Parsing packfiles  IDX files  IDX 文件](../deltification%20概念/Git-Parsing%20packfiles%20%20IDX%20files%20%20IDX%20文件.md)

### 3.6 增量对象

[Git-OBJ_REF_DELTA-基本概念](../Reference/Git-OBJ_REF_DELTA-基本概念.md)
[git-OBJ_OFS_DELTA （偏移量增量对象）](../Reference/git-OBJ_OFS_DELTA%20（偏移量增量对象）.md)


偏移量表示：

> 从 _当前 delta 对象的位置_ 向后（往文件前方）移动多少字节才能找到基础对象。

### 3.7 应用增量

复制和添加指令应用增量，复制指令甚至省去了连续为0的字节。



## 4. 与其他卡片的关联  
- 前置卡片：
- 后续卡片：
- 相似主题：

## 5. 应用/启发  
- 可以如何应用在工作、学习、生活中  
- 引发的思考与问题  

## 6. 待办/进一步探索  
 
  
