---
tags:
  - permanent
---
## 1. 核心观点  

pkt-line 是一个可变长度的二进制字符串。该行的前四个字节（pkt-len）表示该行的总长度（以十六进制表示）。pkt-len 包含用于存储长度十六进制表示的四个字节。

## 2. 背景/出处  
- 来源：https://git-scm.com/docs/gitprotocol-common
- 引文/摘要：  
  - …  
  - …  

## 3. 展开说明  

### pkt-line Format  包行格式

大部分（但不是全部）有效载荷都是围绕 pkt-lines 描述的。
**pkt-line 是一个可变长度的二进制字符串。该行的前四个字节（pkt-len）表示该行的总长度（以十六进制表示）。pkt-len 包含用于存储长度十六进制表示的四个字节。**
pkt 行可能包含二进制数据，因此实现者必须确保 pkt 行解析/格式化例程是 8 位干净的。

非二进制行应以换行符 (LF) 结尾，如果存在换行符，则必须将其计入总长度。接收方必须以相同的方式处理包含非二进制数据的数据包行，无论其是否包含尾随换行符（如果存在则将其移除，如果缺少则不报错）。

pkt-line 数据组件的最大长度为 65516 字节。实现不得发送长度超过 65520 字节（65516 字节有效载荷 + 4 字节长度数据）的 pkt-line。

实现过程中不应发送空的数据包行（“0004”）。

长度字段为 0（“0000”）的 pkt 行称为 flush-pkt，是一种特殊情况，必须与空 pkt 行（“0004”）区别对待。

```
  pkt-line     =  data-pkt / flush-pkt

  data-pkt     =  pkt-len pkt-payload
  pkt-len      =  4*(HEXDIG)
  pkt-payload  =  (pkt-len - 4)*(OCTET)

  flush-pkt    = "0000"
```
- **pkt-len** 用 **4 个十六进制字符**表示长度
	- `4*(HEXDIG)` → 4 个十六进制字符
	- **每个 HEX 字符占 1 个字节**（ASCII 编码）
	- 4 个 HEX 字符 → 4 个 **字节**
- pkt-payload 长度 = pkt-len 减去 4（减掉长度字段）
	- **OCTET** → 任意字节（0~255）





## 4. 与其他卡片的关联  


- 前置卡片：
- 后续卡片：
	- 【ref】[智能协议测试](智能协议测试.md)
	- [Git-URL Format  URL 格式](Git-URL%20Format%20%20URL%20格式.md)
- 相似主题：

## 5. 应用/启发  
- 可以如何应用在工作、学习、生活中  
- 引发的思考与问题  

## 6. 待办/进一步探索  
 
  
